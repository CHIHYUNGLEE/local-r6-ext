function AutoDprtUserNameComplete(c,a,b){this.component=a;this.parent=$(c);this.style=b||{};this.className=this.style.className||"AutoDprtUserNameComplete";this.listCount=this.style.count||AutoDprtUserNameComplete.DEFAULT_COUNT;this.preValue="";this.canvas=$("<div>").addClass(this.className).appendTo("body");this.iframe=$('<iframe class="iframe"></iframe>').css("opacity","0.0").appendTo(this.canvas);this.widget=$("<div>").addClass("widget").css("visibility","hidden").appendTo(this.canvas);this.unList=$("<ul>").addClass("unlist").appendTo(this.widget);this.appendParentEvent();this.url=this.style.url||AutoDprtUserNameComplete.SEARCH_URL;this.loadFlag=false}AutoDprtUserNameComplete.prototype.setPosition=function(){var a=3;var c=this.parent.offset().top+this.parent.height()+a;var b=this.parent.offset().left;this.canvas.css({left:b,top:c+10,"z-index":1000})};AutoDprtUserNameComplete.prototype.loadData=function(a){this.loadFlag=false;this.clear();if(this.timeout){clearTimeout(this.timeout)}if(!a){return}var b=this;this.setPosition();this.timeout=setTimeout(function(){$.ajax({url:JSV.getContextPath(b.url),context:b,dataType:"json",data:{key:a,count:b.listCount},async:false,success:function(e,c){for(var d=0;d<e.array.length;d++){this.createItem(e.array[d],a)}this.showLayer()},error:function(c){JSV.alert(JSV.getLang("AutoDprtUserNameComplete","error"))}})},300)};AutoDprtUserNameComplete.prototype.clear=function(){this.unList.empty();this.preText=null;this.canvas.hide()};AutoDprtUserNameComplete.prototype.createItem=function(jsonObj,key){this.widget.css("visibility","visible");var html=jsonObj.name;var RegExp=eval("/("+key+")/gi");var emphasis="<strong>$1</strong>";if(jsonObj.key==1){html=html.replace(RegExp,emphasis)+" ["+jsonObj.detail+"]";tmp=$("<a>").attr("key",jsonObj.key).attr("title",jsonObj.name).attr("id",jsonObj.id).attr("detail",jsonObj.detail).attr("displayName",jsonObj.displayName).addClass("linker")}else{if(jsonObj.key==2){html=html.replace(RegExp,emphasis)+" ["+jsonObj.parent+"]";tmp=$("<a>").attr("key",jsonObj.key).attr("title",jsonObj.name).attr("parent",jsonObj.parent).attr("id",jsonObj.id).attr("rootid",jsonObj.rootid).attr("path",jsonObj.path).addClass("linker")}}var textArea=$("<nobr>").html(html);var tmp;var viewer=this.component;$("<li>").addClass("item").append(tmp.bind("click",this,function(e){var check=0;for(var i=0;i<viewer.getValue().length;i++){if(parseInt(viewer.getValue()[i].id)==parseInt($(this).attr("id"))){check++}}if(check==0){var obj=new Object();obj.id=$(this).attr("id");obj.name=$(this).attr("title");obj.displayName=$(this).attr("displayName");viewer.getValue().push(obj);viewer.update(JSV.getParameter("id"),viewer.getValue())}else{JSV.alert(JSV.getLang("AutoDprtUserNameComplete","duplicated"))}e.data.bindDisplay();e.data.clear()}).unbind("mouseover.AutoDprtUserNameComplete").bind("mouseover.AutoDprtUserNameComplete",this,function(e){e.data.parent.unbind("blur.AutoDprtUserNameComplete");$(this).addClass("selected")}).unbind("mouseout.AutoDprtUserNameComplete").bind("mouseout.AutoDprtUserNameComplete",this,function(e){e.data.bindDisplay();$(this).removeClass("selected")}).append(textArea)).appendTo(this.unList)};AutoDprtUserNameComplete.prototype.doSelect=function(a){this.setItemData(a);JSV.notify(null,this,"autoComplete")};AutoDprtUserNameComplete.prototype.moveNext=function(){var a;if(this.unList.children().size()==0){return}if($(this.unList).find("li.selected").size()==0){a=$(this.unList).children(":first");a.addClass("selected")}else{a=$(this.unList).find("li.selected").removeClass("selected");if(a.next().get(0)==undefined){a=$(this.unList).children(":first").addClass("selected")}else{a=a.next().addClass("selected")}}this.setItemData(a);a.get(0).focus()};AutoDprtUserNameComplete.prototype.setItemData=function(a){var b=a.children(":first");this.parent.val(b.attr("title"));this.parent.attr("id",b.attr("id"));if(b.attr("key")==1){this.parent.attr("isDprt",false);this.parent.attr("title",b.attr("detail"));this.parent.attr("displayName",b.attr("displayName"));this.parent.attr("name",b.attr("title"))}else{this.parent.attr("isDprt",true);this.parent.attr("title",b.attr("title"));this.parent.attr("name",b.attr("title"))}};AutoDprtUserNameComplete.prototype.movePrev=function(){var a;if(this.unList.children().size()==0){return}if($(this.unList).find("li.selected").size()==0){a=$(this.unList).children(":last");a.addClass("selected")}else{a=$(this.unList).find("li.selected").removeClass("selected");if(a.prev().get(0)==undefined){a=$(this.unList).children(":last").addClass("selected")}else{a=a.prev().addClass("selected")}}this.setItemData(a);a.get(0).focus()};AutoDprtUserNameComplete.prototype.firstSelect=function(){var a;a=$(this.unList).children(":first");this.setItemData(a)};AutoDprtUserNameComplete.prototype.appendParentEvent=function(){var a=this.parent;var b=this.component;this.parent.unbind("keyup.AutoDprtUserNameComplete").bind("keyup.AutoDprtUserNameComplete",this,function(d){if(d.keyCode==AutoDprtUserNameComplete.BUTTON_UP||d.keyCode==AutoDprtUserNameComplete.BUTTON_DOWN||d.keyCode==AutoDprtUserNameComplete.BUTTON_ENTER){return}var c=$.trim(d.data.parent.val());if(d.data.preText&&(d.data.preText==c)){return}d.data.loadData(c);d.data.preText=c}).unbind("keydown.AutoDprtUserNameComplete").bind("keydown.AutoDprtUserNameComplete",this,function(g){if(g.keyCode==AutoDprtUserNameComplete.BUTTON_UP){g.data.movePrev()}else{if(g.keyCode==AutoDprtUserNameComplete.BUTTON_DOWN){g.data.moveNext()}else{if((g.keyCode==AutoDprtUserNameComplete.BUTTON_ENTER||(!g.shiftKey&&g.keyCode==AutoDprtUserNameComplete.BUTTON_COMMA)||g.keyCode==AutoDprtUserNameComplete.BUTTON_TAB)&&g.data.loadFlag==true){if(g.data.timeout){clearTimeout(g.data.timeout)}if(g.data.unList.children().size()>0){g.data.firstSelect()}else{if(!a.attr("id")){g.data.firstSelect()}}var c=0;for(var d=0;d<b.getValue().length;d++){if(parseInt(b.getValue()[d].id)==parseInt(a.attr("id"))){c++}}if(c==0){if(a.attr("id")){var f=new Object();f.id=a.attr("id");f.name=a.attr("name");f.displayName=a.attr("displayName");b.getValue().push(f);b.update(JSV.getParameter("id"),b.getValue())}else{JSV.alert(JSV.getLang("AutoDprtUserNameComplete","selectError"));g.data.clear()}}else{JSV.alert(JSV.getLang("AutoDprtUserNameComplete","duplicated"));g.data.clear()}g.data.clear()}}}});this.bindDisplay()};AutoDprtUserNameComplete.prototype.showLayer=function(){var b=this.unList.children().size();if(b>0){var a=parseInt(this.unList.children(":first").css("height"));a=(a*b)+5;this.iframe.height((a>237)?238:a);this.canvas.show()}this.loadFlag=true};AutoDprtUserNameComplete.prototype.bindDisplay=function(){this.parent.unbind("blur.AutoDprtUserNameComplete").bind("blur.AutoDprtUserNameComplete",this,function(a){a.data.canvas.hide()}).unbind("focus.AutoDprtUserNameComplete").bind("focus.AutoDprtUserNameComplete",this,function(a){a.data.showLayer()})};AutoDprtUserNameComplete.SEARCH_URL="/jsl/WorkUser.SearchDprtUserName.json";AutoDprtUserNameComplete.BUTTON_TAB=9;AutoDprtUserNameComplete.BUTTON_UP=38;AutoDprtUserNameComplete.BUTTON_DOWN=40;AutoDprtUserNameComplete.BUTTON_ENTER=13;AutoDprtUserNameComplete.BUTTON_COMMA=188;AutoDprtUserNameComplete.DEFAULT_COUNT=10;function CheckBoxTextAreaEditor(b,a){this.style=a||{};this.className=this.style.className||"CheckBoxTextAreaEditor";this.wrap=$("<div>").addClass(this.className).appendTo(b).get(0);this.widget=$("<div>").addClass("txtGroup on").appendTo(this.wrap);var c=$("<form>").appendTo(this.widget);this.isCheck=new BooleanFieldEditor(c,this.style);this.label=$("<label>").append(JSV.getLang("CheckBoxTextAreaEditor","label")).appendTo(c);this.textArea=new TextAreaEditor(this.widget,this.style);$(this.isCheck.checkbox).bind("click",this.textArea,function(f){var d=f.data;if(this.checked){d.widget.show()}else{d.widget.hide()}});this.textArea.widget.hide()}CheckBoxTextAreaEditor.prototype.setValue=function(a){if(a){this.textArea.setValue(a);this.textArea.widget.show();this.isCheck.setValue("true");$(this.isCheck.checkBox).trigger("click")}else{this.textArea.setValue("");this.textArea.widget.hide()}};CheckBoxTextAreaEditor.prototype.getValue=function(a){if(this.isCheck.getValue()){return this.textArea.getValue()}else{return null}};function DivListViewer(b,a){this.style=a||{};this.className=this.style.className||"DivListViewer";this.optionClassName=this.style.optionClassName||"option";this.widget=$("<div>").addClass(this.className).appendTo(b).get(0);this.$widgetUl=$("<ul>").addClass("ListUl").appendTo(this.widget).bind("click",this,function(c){if(c.data.onclick){c.data.onclick(c.data.getSelected())}}).bind("dblclick",this,function(c){if(c.data.ondblclick){c.data.ondblclick(c.data.getSelected())}}).bind("change",this,function(c){if(c.data.onchange){c.data.onchange(c.data.getSelected())}});this.widgetUl=this.$widgetUl.get(0)}DivListViewer.prototype.setLabelProvider=function(a){this.labelProvider=a};DivListViewer.prototype.setContentProvider=function(a){this.contentProvider=a};DivListViewer.prototype.setValue=function(a){if(this.labelProvider==null){this.setLabelProvider(new DivListViewerLabelProvider())}if(this.contentProvider==null){this.setContentProvider(new DivListViewerContentProvider())}if(this.contentProvider.inputChanged){this.contentProvider.inputChanged(this,this.value,a)}this.value=a;this.refresh()};DivListViewer.prototype.refresh=function(){var c=this.contentProvider.getElements(this.value);if(!c){c=[]}if(c.array){c=c.array}var a=c.length;this.$widgetUl.find("li").remove();for(var b=0;b<a;b++){this.add(c[b])}};DivListViewer.prototype.add=function(c,a){var d=this.labelProvider.getText(c);var b=$("<li>").addClass(this.optionClassName).text(d);b.data("obj",c);b.bind("click",this,function(f){$(this).addClass("selected");$(this).siblings().each(function(e){$(this).removeClass("selected")})});b.appendTo(this.widgetUl)};DivListViewer.prototype.select=function(a){this.$widgetUl.find("li").each(function(b){if($(this).data("obj")==a){$(this).click()}})};DivListViewer.prototype.getSelected=function(){var a=this.$widgetUl.find("li.selected");if(a.length>0){return a.data("obj")}return null};DivListViewer.prototype.size=function(){return this.$widgetUl.find("li").length};function DivListViewerContentProvider(){}DivListViewerContentProvider.prototype.getElements=function(a){return a};function DocFileViewer(parent,style){this.style=style||{};this.className=this.style.className||"DocFileViewer";this.add=this.style.add||JSV.getLang("DocFileViewer","fileAdd");this.edit=this.style.edit||JSV.getLang("DocFileViewer","fileEdit");this.del=this.style.del||JSV.getLang("DocFileViewer","fileDel");this.hist=this.style.hist||JSV.getLang("DocFileViewer","fileHistory");this.upload=this.style.hist||JSV.getLang("DocFileViewer","fileUpload");this.setInfoShow=this.style.setInfoShow?eval(this.style.setInfoShow):false;this.seq=JSV.SEQUENCE++;this.fileSeqId=1;this.xhrObjs={};this.fileCount=0;this.count=0;this.davKey=this.style.davKey||"";this.writeMode=this.style.writeMode?eval(this.style.writeMode):false;this.template=this.style.template?eval(this.style.template):false;this.cancelChk=this.style.cancelChk||JSV.getLang("DocFileViewer","cancelChk");this.cancelChkErr=this.style.cancelChkErr||JSV.getLang("DocFileViewer","cancelChkErr");this.folderPath="\\";this.previewUrl=this.style.previewUrl;this.attachUrl=this.style.attach;this.inlineUrl=this.style.inline;this.inlinePath="/jsl/inline/WorkReportFileVersioning.DownloadByUser?id=@{fileId}";this.attachPath="/jsl/attach/WorkReportFileVersioning.DownloadByUser?id=@{fileId}";this.totalSize=(this.style.totalSize&&Math.floor(this.style.totalSize)>0)?FileFieldEditor.GetKByte(this.style.totalSize):FileFieldEditor.getByte("2G");this.fileSize=(this.style.fileSize&&Math.floor(this.style.fileSize)>0)?FileFieldEditor.GetKByte(this.style.fileSize):0;this.notSupported=this.style.notSupport||"";this.totalFileSize=0;this.disable=false;this.useHTML5=window.File&&window.FileList&&window.FileReader;this.parentActionName=(this.template)?"WorkReportFileVersioning":"WorkAttachmentVersioning";this.fileType=(this.template)?"report":"attachment";this.parentWidget=$("<div></div>").appendTo(parent).addClass("DocFile");this.widget=$('<div>					<div class="title"></div>			</div>').addClass(this.className).appendTo(this.parentWidget);var hideDiv=$("<div>").addClass("hide").appendTo(this.widget);this.headerArea=$('<span class="left_title"></span>').text(this.style.label).appendTo(this.widget.find(".title")).get(0);this.fileNum=this.widget.find("div.title span.file_num");this.ul=$("<ul>").addClass("file_list").appendTo(this.widget);this.dataName="data.attachments";if(this.template){this.dataName="data.reportFiles"}if(this.template){var chooseTemp=new KButton(this.widget.find("div.title"),JSV.getLang("DocFileViewer","reportSelect"));chooseTemp.component=this;chooseTemp.onclick=function(e){if(this.component.writeMode){JSV.alert(JSV.getLang("DocFileViewer","IsNotAvailable"));return false}DocFileViewer.component=this.component;DocFileViewer.itemId=this.component.itemId;DocFileViewer.showMenu(this.getWidget(),e);return false}}if(this.writeMode){var $this=this;var $addFileParent=this.widget.find("div.title");if($this.useHTML5){var addFile=new KButton(this.widget.find("div.title"),{text:this.add,className:"H24"});addFile.comp=this;addFile.onclick=function(){DocFileViewer.component=this.comp;var file;if(this.comp.widget.find("div.title >  input[type=file]").length>0){file=this.comp.widget.find("div.title >  input[type=file]")}else{file=$("<input>").attr({type:"file",multiple:"multiple"}).appendTo(this.comp.widget.find("div.title")).hide().change(function(e){DocFileViewer.component.selectHandler(e.target.files)}).click(function(e){e.stopPropagation()})}if(JSV.browser.msie10){var fileInputClone=file.clone(true);fileInputClone.appendTo(this.comp.widget.find("div.title")).hide();file.remove();fileInputClone.click()}else{file.val("").click()}}}else{var fileBtnWidget=$("<a>").addClass("KButton").appendTo($addFileParent);var fileStyle={btnImage:"/img/btn/doc/btn25_swf.gif",btnText:this.add,fileSize:DocFileViewer.getMByte(this.fileSize),totalSize:DocFileViewer.getMByte(this.totalSize),notSupport:this.notSupported,sessionKey:"${sessionKey}",useSwfUploader:"true"};var swfFile=new FileUploadEditor(fileBtnWidget,fileStyle);swfFile.select=function(file){var fileItem={method:"editor",type:1,path:"com.kcube.jsv.file.",filename:file.name,size:file.size};this.swfUploader.addFileParam(file.id,"upload",JSV.toJSON(fileItem));this.StartUpload()};swfFile.success=function(file,serverData){var result=serverData.split("|");var fileResponse={method:"editor",type:result[0],path:result[1],filename:file.name,size:file.size};$this.value.push(fileResponse);$this.setValue($this.value);$this.totalFileSize=$this.totalFileSize+fileResponse.size;if($this.onTotalFileSizeChange&&$.isFunction($this.onTotalFileSizeChange)){$this.onTotalFileSizeChange($this.totalFileSize)}$this.setInfo()};swfFile.progress=function(file,nPerc){}}}else{var addFile=new KButton(this.widget.find("div.title"),{text:this.add,className:"H24"});addFile.comp=this;addFile.onclick=function(){DocFileViewer.component=this.comp;var obj={title:this.comp.add,method:"add",id:this.comp.itemId,fileType:this.comp.fileType,comp:this.comp};this.comp.openFileManager(obj)}}if(this.useHTML5){var $this=this;var fileDiv=$("<div>").addClass("file_add").appendTo(this.parentWidget).hide();this.fileDiv=fileDiv;var fileCon=$("<div>").addClass("file_add_Area").appendTo(fileDiv);$("<span>").addClass("file_text").append(JSV.getLang("DocFileViewer","helpMsg")).appendTo(fileCon);var emptyDiv=$("<div>").addClass("emptyLayer").appendTo(this.parentWidget);this.emptyDiv=emptyDiv;this.fileDragEventEnable()}if(this.setInfoShow){this.setInfo()}else{this.setFileLimitInfo()}JQueryUI.load($.proxy(this,"initDialog"))}DocFileViewer.prototype.setInfo=function(){if(this.setInfoShow){var a=FileFieldEditor.setByte(this.totalFileSize)+"/"+FileFieldEditor.setByte(this.totalSize);$(this.headerArea).text(this.style.label+" ("+a+") ")}};DocFileViewer.prototype.setFileLimitInfo=function(){var a="";if(this.fileSize>0){a+=JSV.getLang("DocFileViewer","fileLimitLabel")+FileFieldEditor.setByte(this.fileSize)+" / "}a+=JSV.getLang("DocFileViewer","docLimitLabel")+FileFieldEditor.setByte(this.totalSize);$(this.headerArea).text(this.style.label+" ("+a+") ")};DocFileViewer.getMByte=function(a){return(a)?a/1024/1024:0};DocFileViewer.prototype.getValue=function(){return this.value};DocFileViewer.prototype.setAdditionTemplate=function(value){var returnFunction;var $this=this;returnFunction=function(newFileName){var itemId=JSV.getParameter("id");var tmpFile={path:value.path,filename:newFileName,type:value.type,size:value.size,method:"copy"};var item={id:itemId,method:"copy",reportFiles:[tmpFile]};$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkReportFileVersioning.DoFileUpdate.json")),type:"POST",dataType:"json",async:false,data:{item:JSV.toJSON(item),method:"copy"},async:false,success:function(data,status){if(data.error){$this.onError(data);JSV.setLayerModalReturnValue("error");return}$this.setValue(eval($this.dataName));JSV.layerDialogClose()},error:function(xhr){JSV.alert(JSV.getLang("DocFileViewer","addError"))}})};var fObj={width:640,height:400,title:JSV.getLang("DocFileViewer","title"),resizable:false};JSV.showLayerModalDialog(JSV.getContextPath(JSV.getModuleUrl("/work/workFileNameDialog.jsp")),{fileName:value.filename},fObj,returnFunction)};DocFileViewer.prototype.setValue=function(f){var e=this.ul;$(e).empty();$(this.widget).find(".fileLayer").remove();var k=$("<div>").addClass("fileLayer").appendTo(this.widget);var l=$("<div>").addClass("layerContent").appendTo(k);var c=$("<div>").addClass("fileMsg").addClass("fileMsg_upload").appendTo(l);var d=$("<div>").addClass("a").appendTo(c);var b=$("<img>",{src:"img/icon_file.png"}).addClass("icon_file").appendTo(d);var h=this.template?"ReportFileDivMsg":"AttachmentFileDivMsg";var g=$("<span>").addClass("msgUpload").append(JSV.getLang(h,"filemsg"));if(this.useHTML5){g.append(JSV.getLang(h,"filemsg1"))}g.append(JSV.getLang(h,"filemsg2"));g.appendTo(d);$("<span>").addClass("msgDisableUpload").append(JSV.getLang(h,"filemsg")).appendTo(d);this.itemId=JSV.getParameter("id");if(f&&f.length>0){this.value=f;this.fileNum.text(f.length);k.remove();for(var a=0;a<this.value.length;a++){this.createFile(e,this.value[a].checkOut,this.value[a],a)}}else{this.value=[];this.fileNum.text(0);k.css({position:"relative",width:"100%",height:"120px"}).show()}};DocFileViewer.createMoveDiv=true;DocFileViewer.menuButtonClicked=false;DocFileViewer.showMenu=function(a,b){var d=JSV.loadJSON(JSV.getModuleUrl("/jsl/ReportTemplateUser.ListByMenu.json")).array;if(d&&d.length==0){JSV.alert(JSV.getLang("DocFileViewer","zeroReportTemplate"));return false}if(DocFileViewer.createMoveDiv){$("<div>").attr("id","DocFileViewer_moveDiv").addClass("DocFileViewer_moveDiv").appendTo("body");DocFileViewer.createMoveDiv=false}if(DocFileViewer.menuButtonClicked==true){DocFileViewer.menuButtonClicked=false;$("#DocFileViewer_moveDiv").fadeOut()}else{DocFileViewer.menuButtonClicked=true;DocFileViewer.showSubMenu($("#DocFileViewer_moveDiv").empty().get(0),d,DocFileViewer.component);var c=$(a);var e=c.offset().top+23;if(b.clientY+$("#DocFileViewer_moveDiv").height()+17>document.body.clientHeight){e-=($("#DocFileViewer_moveDiv").height()+25)}$("#DocFileViewer_moveDiv").css("top",e).css("left",function(){var f=$(this).width();var g=c.offset().left;if(g+f>document.body.clientWidth){return g+c.width()-f-5}return g}).show();$(document).unbind("click.docFileViewer").one("click.docFileViewer",function(f){DocFileViewer.menuButtonClicked=false;$("#DocFileViewer_moveDiv").fadeOut();return false})}};DocFileViewer.isNumber=function(a){return !isNaN(parseInt(a,10))};DocFileViewer.showSubMenu=function(b,c,a){if(c.length==0){return}$(c).each(function(d){var e=$("<div>").addClass("submenu").appendTo(b).unbind("click.DocFileViewer.showSubMenu").bind("click.DocFileViewer.showSubMenu",this,function(f){var g=f.data;$("#DocFileViewer_moveDiv").fadeOut();a.setAdditionTemplate(g)}).unbind("mouseover.DocFileViewer.showSubMenu").bind("mouseover.DocFileViewer.showSubMenu",this,function(f){$(this).addClass("hover")}).unbind("mouseout.DocFileViewer.showSubMenu").bind("mouseout.DocFileViewer.showSubMenu",this,function(f){$(this).removeClass("hover")});$("<a>").addClass("text").text(this.title).appendTo(e)})};DocFileViewer.prototype.doFileUpdate=function(file,method){var $this=this;var obj=new Object();obj.id=JSV.getParameter("id");obj.reportFiles=[file];$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/"+this.parentActionName+".DoFileUpdate.json")),dataType:"json",data:{item:JSV.toJSON(obj),method:(method)?method:"edit"},async:false,type:"POST",success:function(data){if(data.error){$this.onError(data);return}if(data!=null){$this.setValue(eval($this.dataName))}},error:function(xhr){JSV.alert(JSV.getLang("DocFileViewer","addError"))}})};DocFileViewer.prototype.tempFilePut=function(d){var c=this.ul;$(this.widget).find(".fileLayer").remove();var g=$("<div>").addClass("fileLayer").appendTo(this.widget);var h=$("<div>").addClass("layerContent").appendTo(g);var a=$("<div>").addClass("fileMsg").addClass("fileMsg_upload").appendTo(h);var f=$("<div>").addClass("a").appendTo(a);var b=$("<img>",{src:"img/icon_file.png"}).addClass("icon_file").appendTo(f);var e=this.template?"ReportFileDivMsg":"AttachmentFileDivMsg";$("<span>").addClass("msgUpload").append(JSV.getLang(e,"filemsg")).append(JSV.getLang(e,"filemsg1")).append($("<span>").append(JSV.getLang(e,"filemsg2"))).append(JSV.getLang(e,"filemsg3")).append($("<span>").append(JSV.getLang(e,"filemsg4"))).append(JSV.getLang(e,"filemsg5")).appendTo(f);$("<span>").addClass("msgDisableUpload").append(JSV.getLang(e,"filemsg")).appendTo(f);if(d){g.remove();this.createTempFile(c,d)}};DocFileViewer.prototype.createTempFile=function(d,e){var f=this;var a=$("<li>").addClass("file_item").appendTo(d);$("<i>").addClass("i_file_L").css("background-image","url("+JSV.getContextPath(FileViewer.DIR+"big/"+FileViewer.getIconName(e.newFileName))+")").appendTo(a);var h=$("<div>").addClass("row").appendTo(a);var b=$("<a>").addClass("file_link").appendTo(h);if(this.writeMode==false){this.manageAnchor(b,e,false)}$("<span>").addClass("file_name").text(e.newFileName).appendTo(b);$("<span>").addClass("file_size").text("("+FileViewer.getSize(e.size)+")").appendTo(b);var g=$("<div>").addClass("row").appendTo(a);var c=$("<div>").addClass("btn_area").appendTo(a)};DocFileViewer.prototype.createFile=function(parent,checkOut,value,index){var $this=this;var li=$("<li>").addClass("file_item").appendTo(parent);$("<i>").addClass("i_file_L").css("background-image","url("+JSV.getContextPath(FileViewer.DIR+"big/"+FileViewer.getIconName(value.filename))+")").appendTo(li);var nameRow=$("<div>").addClass("row").appendTo(li);var fileA=$("<a>").addClass("file_link").appendTo(nameRow);if(!this.writeMode){this.manageAnchor(fileA,value,false)}$("<span>").addClass("file_name").text(value.filename).appendTo(fileA);$("<span>").addClass("file_size").text("("+FileViewer.getSize(value.size)+")").appendTo(fileA);if(!this.writeMode){var fnDiv=$("<div>").addClass("file_fn").appendTo(nameRow);var openA=$("<a>").addClass("open").text(JSV.getLang("FileViewer","open")).appendTo(fnDiv);this.manageAnchor(openA,value,true);$("<span>").addClass("bar").text("|").appendTo(fnDiv);var saveA=$("<a>").addClass("save").text(JSV.getLang("FileViewer","save")).appendTo(fnDiv);this.manageAnchor(saveA,value,false)}if(this.davKey!=""){if(!checkOut&&!this.writeMode){if(JSV.isWebDAVFile(value.filename)){$("<span>").addClass("bar").text("|").appendTo(fnDiv);$('<a href="javascript:void(0);"></a>').addClass("save").text(JSV.getLang("FileViewer","edit")).appendTo(fnDiv).bind("click",this,function(e){JSV.loadWebDAVFile($this.davKey,value.id,value.filename)})}}}var infoRow=$("<div>").addClass("row").appendTo(li);if(!this.writeMode){$("<span>").addClass("file_ver").html('Ver. <span class="num">'+value.vrsn+"</span>").appendTo(infoRow);$("<span>").addClass("file_time").html("<span>"+DateFormat.format(new Date(value.rgstDate),JSV.getLang("DateFormat","fullType1"))+"</span>").appendTo(infoRow)}if(!this.writeMode&&checkOut){$("<span>").addClass("file_revise").append($("<img>").addClass("icon_lock").attr("src","img/lock_s.gif")).append($("<span>").append(AnchorEmp.generateAnchor(value.checker.id,value.checker.name))).append(JSV.getLang("DocFileViewer","checkOutString")).appendTo(infoRow)}var btnArea=$("<div>").addClass("btn_area").appendTo(li);if(!checkOut&&!this.writeMode){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.edit).html('<i class="i_file_item i_file_item_edit"></i>').appendTo(btnArea).bind("click",{comp:this,li:li},function(e){DocFileViewer.filename=value.filename;var obj={title:e.data.comp.edit,method:"edit",id:e.data.comp.itemId,fileId:value.id,size:value.size,fileVer:value.vrsn,fileType:e.data.comp.fileType,li:e.data.li,comp:e.data.comp};e.data.comp.setCheckOut(checkOut,obj)})}if(!checkOut&&!this.writeMode){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.del).html('<i class="i_file_item i_file_item_del"></i>').appendTo(btnArea).bind("click",{comp:this,li:li},function(e){DocFileViewer.filename=value.filename;var obj={title:e.data.comp.del,method:"delete",id:e.data.comp.itemId,fileId:value.id,size:value.size,fileVer:value.vrsn,fileType:e.data.comp.fileType,li:e.data.li,comp:e.data.comp};e.data.comp.setCheckOut(checkOut,obj)})}else{if(this.writeMode){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.del).html('<i class="i_file_item i_file_item_del"></i>').appendTo(btnArea).bind("click",{comp:this,li:li},function(e){e.data.comp.removeValue(index)})}}if(value.checker&&value.currentUser){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",JSV.getLang("DocFileViewer","editX")).html('<i class="i_file_item i_file_item_edit_X"></i>').appendTo(btnArea).bind("click",{comp:this,li:li},function(e){$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/"+$this.parentActionName+".CacncelCheckOut.json")),dataType:"json",data:{fileId:value.id},success:function(data,status){$this.setValue(eval($this.dataName))},error:function(){JSV.alert(this.cancelChkErr);JSV.doGET(JSV.getModuleUrl("usr.read.jsp?id="+$this.itemId))}})})}if(!this.writeMode){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.hist).html('<i class="i_file_item i_file_item_history"></i>').appendTo(btnArea).bind("click",this,function(e){DocFileViewer.filename=value.filename;var url=JSV.getContextPath("/work/file.history.jsp");var fObj={width:640,height:"auto",title:e.data.hist,resizable:false};JSV.showLayerModalDialog(JSV.getModuleUrl(url),{id:e.data.itemId,fileId:value.id,fileType:e.data.fileType},fObj)})}if(!this.writeMode&&this.previewUrl&&FileViewer.checkPreview(value.filename)){$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",JSV.getLang("DocFileViewer","preview")).html('<i class="i_file_item i_file_item_preview"></i>').appendTo(btnArea).bind("click",this,function(e){var obj=new Object();var previewUrl=JSV.getContextPath(JSV.merge(JSV.getModuleUrl(e.data.previewUrl),value));var attachUrl=JSV.merge(e.data.attachUrl,value);obj.previewUrl=previewUrl;obj.filename=value.filename;obj.attachUrl=attachUrl;FileViewer.preview(obj)})}};DocFileViewer.prototype.removeValue=function(a){this.value[a].method="delete";this.totalFileSize-=this.value[a].size;if(this.onTotalFileSizeChange&&$.isFunction(this.onTotalFileSizeChange)){this.onTotalFileSizeChange(this.totalFileSize)}this.setInfo();this.value[a].size;this.value=this.getValidValue(this.value);this.setValue(this.value)};DocFileViewer.prototype.getValidValue=function(b){var c=new Array();for(var a=0;a<b.length;a++){if(!b[a].method||b[a].method!="delete"){c.push(b[a])}}return c};DocFileViewer.prototype.selectHandler=function(b){for(var a=0;a<b.length;a++){b[a].id=this.fileSeqId++;this.sendFile(b[a],a,b.length)}};DocFileViewer.prototype.initDialog=function(){this.dialogDiv=$('<div class="layerFileupLoad">		<div class="fileUploadList">			<table border="0" cellspacing="0" cellpadding="0" id="fileUploadTable">				<colgroup>					<col width="251"/>					<col width="89"/>					<col width="*"/>				</colgroup>				<tr>					<th>'+JSV.getLang("DocFileViewer","fileName")+"</th>					<th>"+JSV.getLang("DocFileViewer","fileSize")+"</th>					<th>"+JSV.getLang("DocFileViewer","fileUploadStatus")+'</th>				</tr>				<tr style="height:7px;">				</tr>			</table>		</div>	</div>').attr({title:JSV.getLang("DocFileViewer","fileUpload"),id:"fileUploadDialog"+this.seq}).appendTo(this.widget);var a=this;this.fileDialog=$("#fileUploadDialog"+this.seq).dialog({width:560,height:350,modal:true,resizable:false,autoOpen:false,dialogClass:"DocFileViewer LayerModalDialog FileModal",beforeClose:function(c){for(var b in a.xhrObjs){if(a.xhrObjs.hasOwnProperty(b)&&a.xhrObjs[b]){a.xhrObjs[b].abort()}}a.count=0;a.fileCount=0;$("#fileUploadTable tr.uploadTr").remove()}})};DocFileViewer.prototype.dialogOpen=function(){this.fileDialog.dialog("open")};DocFileViewer.prototype.dialogClose=function(){this.fileDialog.dialog("close")};DocFileViewer.prototype.addProgress=function(c,e){if(!this.fileDialog.dialog("isOpen")){this.dialogOpen()}var d=$("<tr>").addClass("uploadTr").appendTo(this.dialogDiv.find("#fileUploadTable"));$("<td>").addClass("fileName").html('<img src="'+JSV.getContextPath(FileViewer.DIR+FileViewer.getIconName(c.name))+'"/>'+c.name).appendTo(d);$("<td>").addClass("fileSize").html(FileViewer.getSize(c.size)).appendTo(d);var b=$("<td>").addClass("status").appendTo(d);var a=$("<div>").addClass("progress").appendTo(b);$("<div>").addClass("percent").width(0).html("&nbsp;").appendTo(a);$("<span>").addClass("statusText").appendTo(b);if(e){d.attr("id","fileUpdTr"+e)}return d};DocFileViewer.prototype.setProgress=function(c,a){var b=c.find("div.percent");b.width(a+"%");if(a==100){b.addClass("done")}c.find("span.statusText").text(a==100?JSV.getLang("DocFileViewer","complete"):a+"%")};DocFileViewer.prototype.sendFile=function sendFile(file,idx,fileLength){if(!FileFieldEditor.CheckExt(file.name,this.notSupported)){return}if(file.size<=0){JSV.alert("["+file.name+"] "+JSV.getLang("SwfUploadObject","zero_byte_file")+JSV.getLang("SwfUploadObject","error2"));return}if(this.fileSize>0&&file.size>=this.fileSize){JSV.alert(JSV.getLang("SwfUploadObject","file_exceeds_size_limit")+JSV.getLang("SwfUploadObject","error2"));return}if(this.totalSize<(this.totalFileSize+file.size)||this.totalSize=="0"){JSV.alert(JSV.getLang("FileCompositeFieldEditor","warning")+"\n"+JSV.getLang("SwfUploadObject","sizeError")+FileFieldEditor.setByte(this.totalSize)+"\n"+JSV.getLang("SwfUploadObject","sizeError2")+FileFieldEditor.setByte(file.size)+"\n"+JSV.getLang("SwfUploadObject","sizeError3")+FileFieldEditor.setByte(this.totalFileSize)+"\n"+JSV.getLang("SwfUploadObject","sizeError4")+FileFieldEditor.setByte(this.totalSize-this.totalFileSize));return}else{this.totalFileSize=this.totalFileSize+file.size;if(this.onTotalFileSizeChange&&$.isFunction(this.onTotalFileSizeChange)){this.onTotalFileSizeChange(this.totalFileSize)}this.setInfo()}var fileItem={method:"editor",type:1,path:"com.kcube.jsv.file.",filename:file.name,size:file.size};this.fileCount++;var formData=new FormData();formData.append("upload",JSV.toJSON(fileItem));formData.append("com.kcube.jsv.file.",file);var tr=this.addProgress(file,file.id);var $this=this;var successCallback=function(file){var obj=new Object();obj.id=JSV.getParameter("id");if(DocFileViewer.comp.template==false){obj.attachments=[file]}else{obj.reportFiles=[file]}$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/"+DocFileViewer.comp.parentActionName+".DoFileUpdate.json")),dataType:"json",data:{item:JSV.toJSON(obj),method:"add"},async:false,type:"POST",success:function(data){if(data.error){$this.onError(data);return}if(data!=null){$this.setValue(eval($this.dataName))}},error:function(xhr){JSV.alert(JSV.getLang("DocFileViewer","addError"))}})};if(this.writeMode==true){successCallback=function(file){$this.value.push(file);$this.setValue($this.value)}}var fileResponse=null;var _this=this;$.ajax({xhr:function(){var xhrobj=$.ajaxSettings.xhr();_this.xhrObjs[file.id]=xhrobj;xhrobj.upload.addEventListener("progress",function(e){var nPerc=0;var position=e.loaded||e.position;var total=e.total;if(e.lengthComputable){nPerc=Math.ceil(position/total*100)}_this.setProgress(tr,nPerc)},false);return xhrobj},url:JSV.getContextPath(FileUploadObject.UPLOAD_URL),dataType:"html",data:formData,cache:false,contentType:false,processData:false,type:"POST",success:function(data){_this.xhrObjs[file.id]=null;_this.setProgress(tr,100);if(++_this.count==_this.fileCount){_this.count=0;_this.fileCount=0;_this.dialogClose()}var results=data.split("|");fileResponse={method:"editor",type:results[0],path:results[1],filename:file.name,size:file.size};successCallback(fileResponse)}})};DocFileViewer.prototype.manageAnchor=function(b,d,e){var c=JSV.getContextPath(JSV.getModuleUrl(JSV.merge(JSV.browser.msie?this.attachUrl:e?this.inlineUrl:this.attachUrl,d)));if(JSV.browser.msie){if(e){b.click(function(){var a=$("#DocFileViewerFrame");if(a.length>0){a.attr("src",c)}else{$("<iframe>").attr({id:"DocFileViewerFrame",width:0,height:0,frameborder:0,src:c}).appendTo("body")}})}else{b.click(function(){c+="&isFF=true";b.attr("href",c)})}}else{if(JSV.browser.firefox){c+="&isFF=true"}b.attr("href",c);if(e){b.attr("target","_blank")}}};DocFileViewer.prototype.setCheckOut=function(chkUser,obj){$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/"+this.parentActionName+".CheckOut.json")),async:false,context:this,dataType:"json",data:{fileId:obj.fileId,tmpFilePath:(obj.result)?obj.result:""},success:function(data,status){JSV.alert(JSV.getLang("DocFileViewer","checkInMsg"));this.setValue(eval(this.dataName));this.openFileManager(obj)},error:function(){JSV.alert(this.cancelChk)}})};DocFileViewer.prototype.openFileManager=function(b){var a=JSV.getContextPath(JSV.getModuleUrl("/work/file.versionup.jsp"));var c={width:435,height:"auto",title:b.title,resizable:false};JSV.showLayerModalDialog(JSV.getModuleUrl(a),b,c,function(d){JSV.layerDialogClose()})};DocFileViewer.prototype.setDisable=function(){this.widget.find("div.title > .KButton").hide();this.widget.find(".btn_area").hide();this.widget.find(".icon_file, span.msgUpload").hide();this.widget.find("span.msgDisableUpload").show();if(this.useHTML5){this.fileDragEventDisable()}this.disable=true};DocFileViewer.prototype.setEnable=function(){this.widget.find("div.title > .KButton").show();this.widget.find(".btn_area").show();this.widget.find(".icon_file, span.msgUpload").show();this.widget.find("span.msgDisableUpload").hide();if(this.useHTML5){this.fileDragEventEnable()}this.disable=false};DocFileViewer.prototype.oncomplete=function(){if(this.change){this.change()}};DocFileViewer.prototype.widgetDragOver=function(a){if(this.value.length>0){this.fileDiv.show()}this.emptyDiv.show();this.ignoreDrag(a)};DocFileViewer.prototype.widgetDragEnter=function(a){if(this.value.length>0){this.fileDiv.css({left:(this.ul)[0].offsetLeft,top:(this.ul)[0].offsetTop,height:(this.ul)[0].offsetHeight}).show()}this.emptyDiv.css({left:$(this.widget).get(0).offsetLeft,top:$(this.widget).get(0).offsetTop,width:$(this.widget).get(0).offsetWidth,height:$(this.widget).get(0).offsetHeight}).show();this.ignoreDrag(a)};DocFileViewer.prototype.emptyDrop=function(b){b.preventDefault();var a=b.originalEvent.files||b.originalEvent.dataTransfer.files;if(a&&a.length>0){DocFileViewer.comp=this;this.selectHandler(a)}this.emptyDiv.hide();this.fileDiv.hide();$(this.widget).find("fileLayer").remove()};DocFileViewer.prototype.emptyDragLeave=function(a){this.emptyDiv.hide();this.fileDiv.hide()};DocFileViewer.prototype.ignoreDrag=function(a){a.preventDefault()};DocFileViewer.prototype.fileDragEventEnable=function(){var a=this;this.emptyDiv.unbind("drop.emptyDiv").unbind("dragover.emptyDiv").unbind("dragleave.emptyDiv").bind({"dragover.emptyDiv":function(b){b.preventDefault()},"drop.emptyDiv":function(b){a.emptyDrop(b)},"dragleave.emptyDiv":function(b){a.emptyDragLeave(b)}});$(this.widget).unbind("dragenter").unbind("dragover").bind({"dragover.fileWidget":function(b){a.widgetDragOver(b)},"dragenter.fileWidget":function(b){a.widgetDragEnter(b)}})};DocFileViewer.prototype.fileDragEventDisable=function(){this.parentWidget.find(".emptyLayer").unbind("drop.emptyDiv").unbind("dragover.emptyDiv").unbind("dragleave.emptyDiv");this.widget.unbind("dragenter").unbind("dragover")};DocFileViewer.prototype.onError=function(a){if(a.error.indexOf("WorkUploadDeniedException")>-1){JSV.alert(JSV.getLang("DocFileViewer","uploadDenied"))}else{if(a.error.indexOf("DrmFilePermissionDenied")>-1){JSV.alert(JSV.getLang("DocFileViewer","addFileDrmError"))}else{JSV.alert(JSV.getLang("DocFileViewer","addError"))}}};function DprtCompositeEditor(b,a){FolderCompositeEditor.call(this,b,$.extend(a,{}))}DprtCompositeEditor.prototype=$.extend({},FolderCompositeEditor.prototype,{setValue:function(a){if(this.editor){this.editor.setValue({id:a[DprtCompositeEditor.DRPT.id],path:[JSV.getLocaleStr(a[DprtCompositeEditor.DRPT.name])]})}},getValue:function(){var a=this.editor.getValue();if(a&&a.id&&a.path){return[a.id,a.path[a.path.length-1]]}return[,]},validate:function(a){var b=this.editor.getValue();if(b&&b.id&&b.path){return null}else{return a.message}}});DprtCompositeEditor.DRPT={id:"chargeDprtId",name:"chargeDprtName"};DprtCompositeEditor.prototype.constructor=DprtCompositeEditor;function FeedPortlet(b,a){this.parent=b;this.count=10;this.minId;this.isMore=true;this.isLoadReady=true;this.isFirstLoad=true;this.style=a||{};this.historyType=this.style.historyType||"document";this.className=this.style.className||"FeedPortlet";this.action=FeedPortlet.HISTORY_LIST_ACTIONS[this.historyType];this.contentViewer=$("<div>").addClass(this.className).appendTo(this.parent);this.listUl=$("<ul>").addClass("workFeed").bind("slimscroll",this,function(c,d){if(d=="bottom"&&c.data.isMore){c.data.loadList();$(c.data.parent).resize()}}).appendTo(this.contentViewer);$(this.listUl).find("li").remove();this.loadList();$(this.parent).unbind("resize.FeedPortlet").bind("resize.FeedPortlet",this,function(d){var c=d.data;if(JSV.browser.msie6){if(c.feedResize){window.clearTimeout(c.feedResize)}c.feedResize=window.setTimeout(function(){c.resize()},200)}else{c.resize()}});this.resize()}FeedPortlet.prototype.resize=function(){$(this.parent).css("height",document.body.clientHeight-110);this.height=document.body.clientHeight-110;var a=0;this.listUl.find("li").each(function(){a+=$(this).outerHeight()});if(a<this.height){this.height=a-10}this.listUl.slimScroll({height:this.height,width:273,alwaysVisible:false,size:"8px",color:"#C9C9C9"}).css("height",this.height).parent().css({height:this.height})};FeedPortlet.prototype.loadList=function(){var a={count:this.count,minId:this.minId};if(this.historyType=="document"){a.itemId=this.style.itemId}if(this.isLoadReady){this.isLoadReady=false;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/"+this.action+".json")),context:this,async:false,data:a,dataType:"json",success:function(c,b){this.isLoadReady=true;if(c.array&&c.array.length>0){this.setValue(c.array);if(c.array.length<this.count){this.isMore=false}}else{this.isMore=false;this.noData()}}})}};FeedPortlet.prototype.noData=function(){if(this.listUl.find("li").length==0){var a=$("<div>").addClass("content_No_Wrap").appendTo(this.contentViewer);$("<img>").attr("src","img/icon_time60.png").appendTo(a);$("<span>").addClass("txt").html(JSV.getLang("FeedPortlet","noData")).appendTo(a)}};FeedPortlet.prototype.setValue=function(e){for(var f=0;f<e.length;f++){var a=$("<li>").appendTo(this.listUl);var d=$("<div>").addClass("photo").appendTo(a).css({height:"0px",width:"0px"});$("<span>").addClass("photo_frame").appendTo(d);$("<img>").attr("src",JSV.getContextPath("/jsl/inline/ImageAction.Download?path="+e[f].userId+"&type="+JSV.EMPTHUMB_TYPE)).on("error",function(){$(this).attr("src",JSV.getContextPath(EmpImageViewer.DEFAULT_IMAGE))}).appendTo(d);var c=$(AnchorEmp.generateAnchor(e[f].userId,"")).appendTo(d);d.bind("click",c,function(i){i.stopPropagation();i.data.click()});var h=$("<div>").addClass("content").appendTo(a);if(this.historyType!="document"){$("<a>").addClass("content_title").attr("title",e[f].title).text(e[f].title).bind("click",e[f],function(i){ShowWorkPopup(i.data.itemId)}).appendTo(h)}var b=FeedPortlet.dataReplace(this.getActionMessage(e[f]));var g=$("<p>").addClass("register").html(b).appendTo(h);g.find(".name").append(AnchorEmp.generateAnchor(e[f].userId,e[f].userName));g.find(".refName").addClass("name").append(AnchorEmp.generateAnchor(e[f].refUserId,e[f].refUserName));g.find(".file").append(this.makeFileAnchor(e[f]));g.find(".rfrnName").append(this.makeRfrnAnchor(e[f]));$("<p>").addClass("time").text(DateTextWriter.text(parseInt(e[f].instDate),JSV.getLang("DateFormat","dateType1"))).appendTo(h);this.minId=e[f].historyId}};FeedPortlet.prototype.makeFileAnchor=function(b){var e=JSV.getLang("FeedPortlet",b.event);var d=JSV.getContextPath(JSV.getModuleUrl(this.descriptor.url+b.fileId));var c=$("<a>").addClass("btn_file").text("'"+b.fileName+"'").bind("click",function(a){d+="&isFF=true";c.attr("href",d)});if(b.event.indexOf("delete")>-1){c=$("<span>").addClass("btn_file").text("'"+b.fileName+"'")}return c};FeedPortlet.prototype.makeRfrnAnchor=function(b){this.descriptor=JSV.getLang("FeedPortlet",b.event);var d=this.descriptor.url;var c=$("<a>").addClass("btn_file").text(b.fileName).bind("click",function(f){var a=JSV.getContextPath(JSV.getModuleUrl(d+b.fileId));if(b.event.indexOf("file")>-1||b.event.indexOf("download")>-1){a+="&isFF=true";c.attr("href",a)}else{if(b.event.indexOf("url")>-1){window.open(b.refUrl,"_blank")}}});if(b.event.indexOf("delete")>-1){c=$("<span>").addClass("btn_file").text(b.fileName)}return c};FeedPortlet.prototype.getActionMessage=function(a){var b;this.descriptor=JSV.getLang("FeedPortlet",a.event);b=this.descriptor.action;return b};FeedPortlet.dataReplace=function(c){var a=c;for(var b=0;b<FeedPortlet.REPLACE.length;b++){if(c.indexOf(FeedPortlet.REPLACE[b].find)>-1){a=a.replace(FeedPortlet.REPLACE[b].regExp,FeedPortlet.REPLACE[b].replaceStr)}}return a};FeedPortlet.HISTORY_LIST_ACTIONS={document:"WorkItemHistoryUser.DocListByUser",recent:"WorkItemHistoryUser.DocRecentListByUser"};FeedPortlet.REPLACE=[{find:"@{user",regExp:new RegExp("\\@\\{user\\}"),replaceStr:'<span class="name"></span>'},{find:"@{refUser",regExp:new RegExp("\\@\\{refUser\\}"),replaceStr:'<span class="refName"></span>'},{find:"@{fileName",regExp:new RegExp("\\@\\{fileName\\}"),replaceStr:'<span class="file"></span>'},{find:"@{rfrnName",regExp:new RegExp("\\@\\{rfrnName\\}"),replaceStr:'<span class="rfrnName"></span>'}];function ShowWorkPopup(b){var a="menubar=no, toolbar=no, location=no, scrollbars=no, resizable=yes";var c=JSV.getContextPath(JSV.getModuleUrl("/sys/jsv/doc/popup.jsp?targetUrl=/work/usr.popup.read.jsp?id="+b));OpenWindowCenter.normal(740,600,c,"PopUpFolderViewer"+b,a)}FileFieldEditor.USE_ACTIVEX=false;function GanttChartViewer(b,a){this.style=a||{};this.parent=b;this.$parent=$(b);this.depth=this.style.depth||""}GanttChartViewer.prototype.load=function(d){var f=this;var c=JSV.loadJSON(JSV.mergeXml(JSV.getModuleUrl(this.style.action),d)).array;if(c&&c.length>0){ItemViewer.showTR(this.parent);var g=[];for(var e=0;e<c.length;e++){var a=[];var k={};k.from=c[e].startDate;k.to=c[e].endDate;k.label=c[e].title;k.desc=c[e].title;var h=DateUtil.getPreviousDate();if(parseInt(c[e].endDate)<h){k.customClass="ganttRed"}a.push(k);var b={};b.name=c[e].title;b.depth=c[e][f.depth];b.values=a;g.push(b)}$(f.parent).gantt({source:g,itemsPerPage:500,months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dow:["일","월","화","수","목","금","토"],scale:"days",minScale:"days",waitText:"잠시만 기다려주십시오...",navigate:"scroll",onRender:function(){}})}else{if(this.$parent.is("td")){ItemViewer.hideTR(this.parent)}else{this.$parent.hide()}}};GanttChartViewer.prototype.destory=function(){this.$parent.empty()};function HelperThumbViewer(parent,style){this.style=style||{};this.className=this.style.className||"HelperThumbViewer";this.title=this.style.title||"title";this.onlyView=eval(this.style.onlyView)||true;this.imgWidth=parseInt(this.style.imgWidth||44);this.imgHeight=parseInt(this.style.imgHeight||44);this.no_image=this.style.no_image||EmpImageViewer.DEFAULT_IMAGE;this.imgRate=parseInt(this.imgWidth)/parseInt(this.imgHeight);this.align=this.style.align||"left";this.$ColArray=new Array();this.$removeArray=new Array();this.$removeValues=new Array();this.lastIdx=0;this.fileCnt=0;this.disable=false;this.$userSpanList=[];this.widget=$("<div>").addClass(this.className).appendTo(parent).get(0);this.$photoWrap=$("<div>").addClass("photoWrap").css("display","block;").appendTo(this.widget);this.$photoMore=$("<div>").addClass("photo_moreWrap").appendTo(this.widget);this.photoA=$('<a href="javascript:void(0)";>').appendTo(this.$photoMore).click(function(){$(this).parent().toggleClass("on")});$("<span>").addClass("icon_more").appendTo(this.photoA);this.$moreLayer=$("<div>").addClass("more_layer").appendTo(this.$photoMore);this.$moreLayerUl=$("<ul>").appendTo(this.$moreLayer);this.$moreLayerUl.slimScroll({height:"200px",alwaysVisible:true});this.$photoItems=$("<div>").addClass("photo_items").appendTo(this.widget);this.$itemA=$("<a>").addClass("btn_items").appendTo(this.$photoItems);$("<span>").addClass("icon_add_ellipse").appendTo(this.$itemA);this.$photoItems.component=this;this.$photoItems.bind("click",this,function(e){e.data.popupShow("usr.addHelpers.jsp?id=@{id}")});var widget=this.$photoMore;var clzName=widget.attr("class");$("body").click(function(e){if(!$("."+clzName).has(e.target).length){widget.attr("class",clzName)}})}HelperThumbViewer.prototype.setDisable=function(){this.$photoItems.hide();this.disable=true};HelperThumbViewer.prototype.setEnable=function(){this.$photoItems.show();this.disable=false};HelperThumbViewer.prototype.setValue=function(g){this.$photoWrap.empty();this.$moreLayerUl.empty();this.$photoMore.hide();this.$userSpanList=[];if(g){var f=$(this.widget).width();var b=40;for(var e=0;e<g.length;e++){var c=g[e];var d=$("<span>").addClass("name").attr({title:JSV.getLocaleStr(c.displayName),helperUserId:c.id}).text(JSV.getLocaleStr(c.name)).unbind("click.Helper").bind("click.Helper",function(i){var h=$(this).attr("helperUserId");AnchorEmp.showDetail(h);return false});d.appendTo(this.$photoWrap);b=b+(d.width()+32);if(b<=f){d.appendTo(this.$photoWrap)}else{var a=$("<li>").appendTo(this.$moreLayerUl);d.appendTo(a);this.$photoMore.show()}this.$userSpanList.push(d)}}this.userListResize();if(this.change){this.change()}};HelperThumbViewer.prototype.userListResize=function(){$(this.widget).unbind("resize.HelperThumbView");if(this.$userSpanList&&this.$userSpanList.length>0){this.$moreLayerUl.empty();this.$photoMore.hide();var e=$(this.widget).width();var b=40;for(var d=0;d<this.$userSpanList.length;d++){var c=this.$userSpanList[d];c.unbind("click.Helper").bind("click.Helper",function(g){var f=$(this).attr("helperUserId");AnchorEmp.showDetail(f);return false}).appendTo(this.$photoWrap);b=b+(c.width()+32);if(b<=e){c.appendTo(this.$photoWrap)}else{var a=$("<li>").appendTo(this.$moreLayerUl);c.appendTo(a);this.$photoMore.show();b=b+30}}}$(this.widget).bind("resize.HelperThumbView",this,function(f){f.data.userListResize()})};HelperThumbViewer.prototype.popupShow=function(d,e){var m=12;var p=250;if($(window).height()<650){var f=$(window).width()/1.1;var n=($(window).width()/1.45)-(f+m)/1.4}else{var f=$(window).width()/1.3;var n=($(window).width()/1.5)-(f+m)/1.4}var a=$("body");if($(a).find(".fixedTaskLayer").length>0){$(a).find(".fixedTaskLayer").remove()}var g=$("<div></div>").addClass("fixedTaskLayer");g.appendTo(a);var c=$("<div>").addClass("subfixedBg").appendTo(g);var i=$("<div>").addClass("subfixedLayerArea").appendTo(g);i.css("left",n+"px");i.css("width",f+24+"px");i.css("top","50px");i.appendTo(g);var l=$("<div>").addClass("subfixedTaskLayerHeader");l.appendTo(i);$("<h1>").addClass("layerTitle").text(JSV.getLang("HelperThumbViewer","helperPopupTitle")).appendTo(l);var h=$("<div>",{id:"subTaskContent"}).addClass("subfixedTaskLayerContent");h.css("width",f+"px");h.css("height",p+"px");h.appendTo(i);this.layerWidget=$(h).get(0);var o=$("<span>").addClass("subfixedLayerClose");o.appendTo(l);o.click(function(){$(".fixedTaskLayer",document).hide()});var k=h;var b="PORTLET_ID="+HelperThumbViewer.WORKHELPERS_PTLID;setTimeout(function(){k.load(JSV.getContextPath(JSV.getModuleUrl(d),b),function(r,q,s){})},2)};HelperThumbViewer.empShowMenu=function(g,a,f,c){var d=AnchorEmp.ROLES[f];if(AnchorEmp.createMoveDiv){$("<div>").attr("id","AnchorEmp_moveDiv").addClass("AnchorEmp_moveDiv").appendTo("body");AnchorEmp.createMoveDiv=false}if(AnchorEmp.selectedAnchor==a){AnchorEmp.selectedAnchor=null;$("#AnchorEmp_moveDiv").fadeOut()}else{AnchorEmp.selectedAnchor=a;AnchorEmp.showSubMenu($("#AnchorEmp_moveDiv").empty().get(0),g,d);var b=$(a);var e=b.offset().top+32;if(c.clientY+$("#AnchorEmp_moveDiv").height()+17>document.body.clientHeight){e-=($("#AnchorEmp_moveDiv").height()+25)}$("#AnchorEmp_moveDiv").css("top",e).css("left",function(){var h=$(this).width();var i=b.offset().left;if(i+h>document.body.clientWidth){return i+b.width()-h-5}return i}).show();$(document).unbind("click.anchorEmp").one("click.anchorEmp",function(h){AnchorEmp.selectedAnchor=null;$("#AnchorEmp_moveDiv").fadeOut();return false})}};HelperThumbViewer.WORKHELPERS_PTLID="WORKHELPEREDITOR";function ProcessHistoryViewer(b,a){this.style=a||{};this.listCnt=this.style.listCnt||5;this.listUrl=this.style.listUrl||null;this.pageNum=1;this.className=this.style.className||"ProcessHistoryViewer";this.widget=$("<div>").addClass(this.className).appendTo(b);this.Wrap=$("<div>").addClass("approvalWrap").appendTo(this.widget);this.header=$("<div>").addClass("headerWrap").appendTo(this.Wrap);this.content=$("<div>").addClass("contentWrap").appendTo(this.Wrap);var c=this.content;this.headerLeft=$("<div>").addClass("headerLeftMenu").appendTo(this.header).bind("click",this,function(f){var d=f.data.headerFoldingBtn;if(d.hasClass("btn_open")){d.removeClass("btn_open").addClass("btn_close");c.hide()}else{d.removeClass("btn_close").addClass("btn_open");c.show()}});this.headerFoldingBtn=$("<a>").addClass("btn_close").appendTo(this.headerLeft).text(JSV.getLang("ProcessHistoryViewer","title"));this.contentGroup=$("<div>").addClass("contentGroup").appendTo(this.content);this.contentUl=$("<ul>").appendTo(this.contentGroup);this.bar=$("<div>").addClass("bar").appendTo(this.content);this.btnMore=$("<div>").addClass("btn_moreWrap").appendTo(this.content);this.content.hide()}ProcessHistoryViewer.prototype.setValue=function(q){var b;if(q){b=q}else{var p=this.pageNum+"."+this.listCnt+"..";b=JSV.loadJSON(JSV.getModuleUrl(this.listUrl+"&ts="+p)).processList}if(!this.moreA){this.moreA=$("<a>").addClass("btn_more").appendTo(this.btnMore);var k=this;this.moreA.click(function(i){k.morelist()})}if(b&&b.length>0){this.moreA.show();this.content.show();this.headerFoldingBtn.removeClass("btn_close").addClass("btn_open")}else{this.moreA.hide()}var w=b?b:[];for(var s=0;s<w.length;s++){var n=$("<li>").appendTo(this.contentUl);var e=$("<div>").addClass("listGroup").appendTo(n);var t=$("<div>").addClass("list_Type").appendTo(e);var a=$("<div>").addClass("type").appendTo(t);var m=$("<span>").addClass("type_txt").appendTo(a);$("<span>").addClass("type_right_bar").appendTo(a);$("<span>").addClass("type_ellipse").appendTo(a);var c=$("<div>").addClass("list_Content").appendTo(e);var y=$("<div>").addClass("infoWrap").appendTo(c);var l=$("<div>").addClass("info_Left").appendTo(y);var g=$("<div>").addClass("info").appendTo(l);var o=$("<a>").addClass("btn_name").appendTo(g);o.data("userId",w[s].checker.id);o.click(function(i){AnchorEmp.showDetail($(this).data("userId"))});$("<span>").addClass("name").text(JSV.getLocaleStr(w[s].checker.displayName)).appendTo(o);var f=$("<div>").addClass("info_Right").appendTo(y);var x=$("<div>").addClass("dateWrap").appendTo(c);var z=$("<div>").addClass("date_Left").appendTo(x);if(w[s].reqDate){$("<span>").addClass("txt").text(JSV.getLang("ProcessHistoryViewer","reqDate")).appendTo(z);$("<span>").addClass("day").text(DateFormat.format(new Date(w[s].reqDate),"yyyy.MM.dd HH:mm:ss")).appendTo(z)}var u=$("<div>").addClass("date_Right").appendTo(x);if(w[s].eventDate){$("<span>").addClass("day").text(DateFormat.format(new Date(w[s].eventDate),"yyyy.MM.dd HH:mm:ss")).appendTo(u)}var h=$("<div>").addClass("boxWrap").appendTo(c);if(w[s].processComments&&w[s].processComments.length>0){for(var r=0;r<w[s].processComments.length;r++){if(r>0){boxContent=$("<div>").addClass("boxWrap").appendTo(c);$("<span>").addClass("txt").text(w[s].processComments[r].comment).appendTo(boxContent)}else{$("<span>").addClass("txt").text(w[s].processComments[r].comment).appendTo(h)}}}var v=ProcessHistoryViewer.TYPEMAP[w[s].processType];e.addClass(v);a.addClass(v);m.text(JSV.getLang("ProcessHistoryViewer",v));if(w[s].read==1&&(w[s].status==1000||w[s].status==2000)){w[s].status=9000}var d=ProcessHistoryViewer.STATUSMAP[w[s].status];if(w[s].status==3000){e.addClass("supplementation")}$("<span>").addClass("txt").text(JSV.getLang("ProcessHistoryViewer",d)).appendTo(f)}};ProcessHistoryViewer.prototype.morelist=function(){this.pageNum=this.pageNum+1;var b=this.pageNum+"."+this.listCnt+"..";var a=JSV.loadJSON(JSV.getModuleUrl(this.listUrl+"&ts="+b)).processList;if(a.length>0){this.setValue(a)}else{JSV.alert(JSV.getLang("ProcessHistoryViewer","noData"))}};ProcessHistoryViewer.TYPEMAP={1000:"review",2000:"approbation",3000:"collect"};ProcessHistoryViewer.STATUSMAP={1000:"reviewing",1500:"review",2000:"approbating",2500:"approbation",2700:"selfapprove",3000:"supplementation",3300:"supplementComp",3500:"supplementAppr",4000:"needOffmit",9000:"read",9999:"retrieved"};function ProcessSimpleReport(b,a){this.style=a||{};this.listCnt=this.style.listCnt||5;this.listUrl=this.style.listUrl||null;this.pageNum=1;this.className=this.style.className||"ProcessSimpleReport";this.widget=$("<div>").addClass(this.className).appendTo(b);this.Wrap=$("<div>").addClass("reportWrap").appendTo(this.widget);this.header=$("<div>").addClass("headerWrap").appendTo(this.Wrap);this.content=$("<div>").addClass("contentWrap").appendTo(this.Wrap);var e=this.content;this.headerLeft=$("<div>").addClass("headerLeftMenu").appendTo(this.header).bind("click",this,function(g){var f=g.data.headerFoldingBtn;if(f.hasClass("btn_open")){f.removeClass("btn_open").addClass("btn_close");e.hide()}else{f.removeClass("btn_close").addClass("btn_open");e.show()}});this.headerFoldingBtn=$("<a>").addClass("btn_open").appendTo(this.headerLeft).text(JSV.getLang("ProcessSimpleReport","title"));var c=$("<div>").addClass("content").appendTo(this.content);var d=$("<div>").addClass("txtAreaWrap").appendTo(c);this.textFd=new TextAreaEditor(d,{className:"txtArea",readOnly:"true"})}ProcessSimpleReport.prototype.setValue=function(a){this.textFd.setValue(a);if(a){this.headerFoldingBtn.removeClass("btn_close").addClass("btn_open");this.content.show()}else{this.headerFoldingBtn.removeClass("btn_open").addClass("btn_close");this.content.hide()}};function ProcessStatusBoxColumn(parent,style){this.parent=parent;this.style=style?style:{};this.className=this.style.className?this.style.className:"StatusBoxColumn";this.options=ComboViewer.createOptions(this.style);this.styleOptions=ComboViewer.createOptions({options:this.style.styleOptions});this.addition=eval(this.style.addition)||null;parent.appendChild(this)}ProcessStatusBoxColumn.prototype.setValue=function(b,e,d){$(e).attr("align",this.style.align?this.style.align:"center");var a=b[this.style.attribute];if(b.retrieve&&b.retrieve==1){a=9999}var c=$("<div>").addClass(this.className).addClass(this.styleOptions[a]).text(this.options[a]).appendTo(e);if(this.style.width){$(e).width(this.style.width)}if($.isFunction(this.addition)){this.addition.apply(this,[b,e,d,c])}};function ProcessStatusViewer(b,a){this.style=a||null;this.histUrl=this.style.listUrl;this.listCnt=this.style.listCnt||5;this.pageNum=1;this.btnArea=$("<div>").addClass("ProcessStatusViewer").addClass("btn_area").appendTo(b);this.widget=$("<div>").addClass("CooperateTable").appendTo(b);this.table=$('<table cellpadding="0" cellspacing="0" border="0">').addClass("cooperate_table").appendTo(this.widget);this.tr=$("<tr>").appendTo(this.table);this.disable=false;this.parent=b;$.data(ProcessStatusViewer,"component",this);this.init()}ProcessStatusViewer.prototype.changeCall=function(a){if(this.onchange){this.onchange(a)}};ProcessStatusViewer.prototype.init=function(){this.tds=new Array();for(var b=0;b<4;b++){var h=this.makeTd();h.data("id",JSV.getLang("ProcessStatusViewer","tdId"+b));var f=$("<h3>").addClass("title").append(JSV.getLang("ProcessStatusViewer","title"+b));var g=$('<div class="bar">');if(b==0){h.addClass("order");g.append($('<span class="edge"></span>'))}if(b==3){h.addClass("last");h.addClass("complete");h.css({background:"white","border-right":"none"});g.append($('<span class="edge"></span>'))}g.append($('<span class="icon"></span>'));h.append(f).append(g);var a=$('<div class="name"></div>');var e=$("<div>").attr("id",JSV.getLang("ProcessStatusViewer","id"+b));var c=$("<div>").attr("id",JSV.getLang("ProcessStatusViewer","id"+b)+"More");var d=$('<p class="more"></p>').append(JSV.getLang("ProcessStatusViewer","more"));h.data("name",a);h.data("namePreview",e);h.data("nameMore",c);h.data("moreBtn",d);a.append(e);a.append(c);a.append(d);h.append(a);this.tds.push(h)}this.createReport(this.parent);this.createHistory(this.parent);this.role=WorkItem.getRole(JSV.getParameter("id"))};ProcessStatusViewer.prototype.makeTd=function(){var a=$("<td>").addClass("coming").appendTo(this.tr);return a};ProcessStatusViewer.prototype.setStatus=function(a){if(this.change){this.change(a)}if(WorkStatusFieldEditor.WORKING==a){$(this.getTd("writer")).addClass("ing").removeClass("coming").siblings().removeClass("ing").addClass("coming")}else{if(WorkStatusFieldEditor.APPROVAL==a||WorkStatusFieldEditor.NEEDSUPPLEMENT==a){$(this.getTd("approver")).addClass("ing").removeClass("coming").siblings().removeClass("ing").addClass("coming")}else{if(WorkStatusFieldEditor.REVIEW==a||WorkStatusFieldEditor.REVIEWCMPLT==a){$(this.getTd("reviewers")).addClass("ing").removeClass("coming").siblings().removeClass("ing").addClass("coming")}else{if(WorkStatusFieldEditor.COMPLETE==a||WorkStatusFieldEditor.APRVAL_COMPLETE==a){$(this.getTd("cmlpt")).addClass("ing").removeClass("coming").siblings().removeClass("ing").addClass("coming")}}}}};ProcessStatusViewer.prototype.setButtons=function(c,a){var d=this;this.btnArea.empty();$('<span class="left_title"></span>').append(JSV.getLang("ProcessStatusViewer","mainTitle")).appendTo(this.btnArea);var e=this.role;if(e.isActor){if(a==WorkStatusFieldEditor.WORKING){var b=new KButton(this.btnArea,JSV.getLang("ProcessStatusViewer","settingBtn"));b.onclick=function(){d.popupShow("/work/prcs/WorkProcessEditorDialog.jsp?id=@{id}")}}}};ProcessStatusViewer.prototype.setActors=function(d,a){var b=a.getProperty("actor");var c=JSV.clone(a.getProperty("helpers"));c.push(b);this.setWriter(c);if(d){this.setReviewers(d);this.setApprover(d)}};ProcessStatusViewer.prototype.setValue=function(c,b){this.id=JSV.getParameter("id");this.comp=b;this.value=c;var a=b.getProperty("status");this.setStatus(a);this.setActors(c,b);this.setButtons(c,a);this.reportVw.setValue(c.reportSketch)};ProcessStatusViewer.prototype.clear=function(){this.btnArea.empty();this.tr.empty();$(this.parent).find(".ProcessHistoryViewer").remove();$(this.parent).find(".ProcessSimpleReport").remove()};ProcessStatusViewer.prototype.getTd=function(b){for(var a=0;a<this.tds.length;a++){if(this.tds[a].data("id")==b){return this.tds[a]}}return null};ProcessStatusViewer.prototype.isAvailableReview=function(){};ProcessStatusViewer.prototype.isAvailableApprove=function(){};ProcessStatusViewer.prototype.setReviewers=function(e){if(e.reviewers&&e.reviewers.length>0){this.reviewers=e.reviewers;var h=this.getTd("reviewers");var g=h.data("namePreview");var d=h.data("nameMore");var f=h.data("moreBtn");var a=false;for(var c=0;c<this.reviewers.length;c++){var b=AnchorEmp.generateAnchor(this.reviewers[c].id,JSV.getLocaleStr(this.reviewers[c].name));if(c<3){g.append($("<p>").append(b))}if(c>=3){a=true;d.isopen=false;d.append($("<p>").append(b))}}if(a==true){f.show();d.hide();f.bind("click",function(i){if(d.isopen==false){d.show();f.html(JSV.getLang("ProcessStatusViewer","close"))}else{d.hide();f.html(JSV.getLang("ProcessStatusViewer","more"))}d.isopen=!d.isopen})}}};ProcessStatusViewer.prototype.setApprover=function(b){if(b.approver&&b.approver!=""){this.approver=b.approver;var d=this.getTd("approver");var c=d.data("namePreview");var a=AnchorEmp.generateAnchor(this.approver.id,JSV.getLocaleStr(this.approver.name));c.append($("<p>").append(a))}};ProcessStatusViewer.prototype.setWriter=function(k){if(k&&k.length>0){var d=k;var b=this.getTd("writer");var c=b.data("namePreview");var f=b.data("nameMore");var a=b.data("moreBtn");var h=false;for(var g=0;g<d.length;g++){var e=AnchorEmp.generateAnchor(d[g].id,JSV.getLocaleStr(d[g].name));if(g<3){c.append($("<p>").append(e))}if(g>=3){h=true;f.isopen=false;f.append($("<p>").append(e))}}if(h==true){a.show();f.hide();a.bind("click",function(i){if(f.isopen==false){f.show();a.html(JSV.getLang("ProcessStatusViewer","close"))}else{f.hide();a.html(JSV.getLang("ProcessStatusViewer","more"))}f.isopen=!f.isopen})}}};ProcessStatusViewer.prototype.popupShow=function(c){var k=12;if($(window).height()<650){var e=$(window).width()/1.1;var o=$(window).height()/2.2;var l=($(window).width()/1.45)-(e+k)/1.4}else{var e=$(window).width()/1.3;var o=$(window).height()/2.2;var l=($(window).width()/1.5)-(e+k)/1.4}var a=$("body");if($(a).find(".fixedTaskLayer").length>0){$(a).find(".fixedTaskLayer").remove()}var f=$("<div></div>").addClass("fixedTaskLayer");f.appendTo(a);var d=$("<div>").addClass("subfixedBg").appendTo(f);var h=$("<div>").addClass("subfixedLayerArea").appendTo(f);h.css("left",l+"px");h.css("width",e+24+"px");h.css("top","50px");h.appendTo(f);var i=$("<div>").addClass("subfixedTaskLayerHeader");i.appendTo(h);$("<h1>").addClass("layerTitle").text(JSV.getLang("ProcessStatusViewer","settingTitle")).appendTo(i);var g=$("<div>",{id:"subTaskContent"}).addClass("subfixedTaskLayerContent");g.css("width",e+"px");g.css("height",o+"px");g.appendTo(h);this.layerWidget=$(g).get(0);var n=$("<span>").addClass("subfixedLayerClose");n.appendTo(i);n.click(function(){$(".fixedTaskLayer",document).hide()});var m=g;var b="PORTLET_ID="+ProcessStatusViewer.WORKPROCESS_PTLID;setTimeout(function(){m.load(JSV.getContextPath(JSV.getModuleUrl(c),b),function(q,p,r){})},2)};ProcessStatusViewer.prototype.getProperty=function(a){return JSV.getProperty(this.value,a)};ProcessStatusViewer.prototype.createHistory=function(a){this.hist=new ProcessHistoryViewer(a,this.style);this.hist.setValue()};ProcessStatusViewer.prototype.createReport=function(a){this.reportVw=new ProcessSimpleReport(a,this.style)};ProcessStatusViewer.prototype.notify=function(a){this.setStatus(a);this.setButtons(this.value,a)};ProcessStatusViewer.prototype.setDisable=function(a){this.btnArea.find(".KButton").hide();this.disable=true};ProcessStatusViewer.prototype.setEnable=function(a){this.btnArea.find(".KButton").show();this.disable=false};function ShareViewer(c,b){this.style=b||{};this.titleLabel=this.style.titleLabel||"";this.className=this.style.className||"ShareViewer";this.widget=$("<div>").addClass(this.className).appendTo(c).bind("click",this,function(f){if($(".share_layer").children().length>0){$(this).toggleClass("on")}});var a=this.className;var d=this.widget;$("body").click(function(f){if(!$("."+a).has(f.target).length){d.attr("class",a)}});this.btnA=$('<a href="javascript:void(0)">').addClass("btn_user").appendTo(this.widget);$("<img>").attr("title",JSV.getLang("ShareViewer","addShare")).addClass("icon_user").attr("src","img/icon_user.png").appendTo(this.btnA);this.inspan=$("<span>").addClass("txt_area").appendTo(this.btnA);this.shareLayer=$("<div>").addClass("share_layer").appendTo(this.widget);this.count=10;this.isLoadReady=true;this.isMore=true;this.disable=false;this.delAs=new Array()}ShareViewer.prototype.setDisable=function(){for(var a=0;a<this.delAs.length;a++){this.delAs[a].hide()}this.disable=true};ShareViewer.prototype.setEnable=function(){for(var a=0;a<this.delAs.length;a++){this.delAs[a].show()}this.disable=false};ShareViewer.prototype.setValue=function(b){this.isLoadReady=true;this.info=b;var c=b;this.inspan.empty();this.shareLayer.empty();if(c.length&&c.length>0){var a=$("<span>").addClass("name").text(JSV.getLocaleStr(c[0].name)).appendTo(this.inspan);a.after(JSV.getLang("ShareViewer","message01"));$("<span>").addClass("sharing").text(c.length-1+JSV.getLang("ShareViewer","message02")).appendTo(this.inspan);this.ul=$("<ul>").appendTo(this.shareLayer);this.ul.slimScroll({height:"200px",alwaysVisible:true})}else{$("<span>").text(JSV.getLang("ShareViewer","noShare")).appendTo(this.inspan)}this.add(c);if(this.change){this.change()}};ShareViewer.prototype.getValue=function(){return this.info};ShareViewer.prototype.addSrch=function(){var b=this.info;this.attDiv=$("<div>").addClass("attendee_1_contents").attr("id","attendee_1_contents").prependTo(this.shareLayer);var d=this.attDiv;var c=$("<div>").addClass("searchN_wrap").appendTo(d);var a=$("<div>").addClass("searchN").appendTo(c);$("<span>").addClass("btn_search").attr("title",JSV.getLang("ShareViewer","addShare")).appendTo(c).click(function(){ShareViewer.showPopup(b)});this.inputArea=$("<input>").addClass("inputName").attr("type","text").attr("placeholder",JSV.getLang("ShareViewer","placeholder")).appendTo(a).bind("keydown",this,function(f){if(f.data.onkeydown){f.data.onkeydown(f)}if(f.keyCode==13){return false}if(f.keyCode==9){return false}}).bind("keyup",this,function(f){if(f.data.onkeyup){f.data.onkeyup(f)}if(f.keyCode==13){return false}}).bind("focus",this,function(g){if((g.data.isEdit!=null)&&(this!=g.data.isEdit)){var f=$.Event("keydown");f.keyCode=13;$(g.data.isEdit).trigger(f)}}).bind("blur",this,function(f){if(f.data.isfirst&&!f.data.style.autoComplete){f.data.setInputValue(this.value);f.data.isfirst=false}}).bind("click",this,function(f){if(f.data.onclick){f.data.onclick(f)}});JSV.register(new AutoDprtUserNameComplete(this.inputArea,this,this.style),this,"autoComplete")};ShareViewer.prototype.add=function(b){for(var a=0;a<b.length;a++){this.addItem(b[a],b)}};ShareViewer.prototype.addItem=function(g,b){var f=this;var i=$("<li>").appendTo(this.ul);i.data("userId",g.id);var a=$("<div>").addClass("photo_area").appendTo(i).bind("click",this,function(l){var k=$(this).parent().data("userId");AnchorEmp.showDetail(k)});var e=$("<a>").addClass("name").attr("title",JSV.getLocaleStr(g.displayName)).appendTo(i).bind("click",this,function(l){var k=$(this).parent().data("userId");AnchorEmp.showDetail(k)});var d=$("<span>").addClass("photo_frame").appendTo(a);$("<span>").text(JSV.getLocaleStr(g.name)).appendTo(e);var h=$("<div>").addClass("btn_deleteArea").appendTo(i);var c=$('<a href="javascript:void(0)">').addClass("btn_delete").appendTo(h);this.delAs.push(c);c.click(function(k){var l=$(this).closest("li").data("userId");JSV.confirm(JSV.getLang("ShareViewer","del"),function(m){if(m){for(j=0;j<b.length;j++){if(b[j].id===l){b.splice(j,1);break}}f.update(JSV.getParameter("id"),b)}})})};ShareViewer.prototype.resize=function(){this.height=$(this.contentLi).height()-12;var a=0;this.listUl.find("li").each(function(){a+=$(this).outerHeight()});if(a<this.height){this.height=a-10}this.listUl.slimScroll({height:this.height,width:183,alwaysVisible:false,size:"8px",color:"#C9C9C9"}).css("height",this.height).parent().css({height:this.height})};ShareViewer.prototype.update=function(c,b){var a=this;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkActor.UpdateSharersByArray.jsl")),type:"POST",data:{id:c,item:JSV.toJSON(b)},success:function(d){a.setValue(b);if(a.change){a.change()}},error:function(d){JSV.alert(JSV.getLang("ShareViewer","err"))}})};ShareViewer.showPopup=function(m,h,d,g,k){var l=this.info;var o=JSV.getModuleUrl("/work/WorkEmpsFieldEditorDialog.jsp");var c="id="+JSV.getParameter("id");var e="sharePopup";var i="width=800,height=730,scrollbars=no,status=no,toolbar=no,menubar=no,location=no,resizable=no";var b=JSV.getContextPath(o,c);window.open(b,e,i)};ShareViewer.prototype.popupShow=function(d,e){var m=12;if($(window).height()<650){var f=$(window).width()/1.1;var p=$(window).height()/1.8;var n=($(window).width()/1.45)-(f+m)/1.4}else{var f=$(window).width()/1.3;var p=$(window).height()/1.8;var n=($(window).width()/1.5)-(f+m)/1.4}var a=$("body");if($(a).find(".fixedTaskLayer").length>0){$(a).find(".fixedTaskLayer").remove()}var g=$("<div></div>").addClass("fixedTaskLayer");g.appendTo(a);var c=$("<div>").addClass("subfixedBg").appendTo(g);var i=$("<div>").addClass("subfixedLayerArea").appendTo(g);i.css("left",n+"px");i.css("width",f+24+"px");i.css("top","50px");i.appendTo(g);var l=$("<div>").addClass("subfixedTaskLayerHeader");l.appendTo(i);$("<h1>").addClass("layerTitle").text(JSV.getLang("ShareViewer","helperPopupTitle")).appendTo(l);var h=$("<div>",{id:"subTaskContent"}).addClass("subfixedTaskLayerContent");h.css("width",f+"px");h.css("height",p+"px");h.appendTo(i);this.layerWidget=$(h).get(0);var o=$("<span>").addClass("subfixedLayerClose");o.appendTo(l);o.click(function(){$(".fixedTaskLayer",document).hide()});var k=h;var b="PORTLET_ID="+ShareViewer.WORKSHARERS_PTLID;setTimeout(function(){k.load(JSV.getContextPath(JSV.getModuleUrl(d),b),function(r,q,s){})},2)};ShareViewer.WORKSHARERS_PTLID="WORKSHAREEDITOR";function WorkChatFileListViewer(b){this.style=b||{};this.className=this.style.className||"WorkChatFileListViewer";this.attach=this.style.attach||"/jsl/attach/WorkChatItemUser.DownloadByUser?id=@{fileId}";this.language=(JSV.getLocale()=="ko")?"ko":"en";this.activex=(this.style.activex=="false"||!FileFieldEditor.USE_ACTIVEX)?false:true;var a=this.viewers.length;this.viewers[a]=this;this.jsref="WorkChatFileListViewer.prototype.viewers["+a+"]";this.init()}WorkChatFileListViewer.prototype.viewers=[];WorkChatFileListViewer.prototype.init=function(){if(JSV.browser.msie&&this.activex){if(WorkChatFileListViewer.utilObj==null){if(JSV.browser.msieEqualOrOver9){var a=$('<object classid="'+FileViewer.classid+'" 						CodeBase="'+FileViewer.codeBase+"#version="+FileViewer.version+'" 						onreadystatechange='+this.jsref+'.onreadystatechange(this.readyState); 						width="1" height="1">							<param name="Enc" value="'+FileViewer.key+'"/>							<param name="UseUnicode" value="true"/>							<param name="UseFileSizeQueryString" value="true"/>							<param name="Language" value="'+this.language+'"/>							<param name="UseResume" value="true"/>							<param name="ShowFileOpen" value="true"/>							<param name="ProgramTitle" value="'+this.title+'"/>							<param name="Prod" value="'+FileViewer.prod+'"/>						</object>').get(0)}else{var a=document.createElement('<object classid="'+FileViewer.classid+'" 							CodeBase="'+FileViewer.codeBase+"#version="+FileViewer.version+'" 							onreadystatechange='+this.jsref+'.onreadystatechange(this.readyState); 							width="1" height="1"></object>');FileViewer.appendParam(a,{Enc:FileViewer.key,UseUnicode:"true",UseFileSizeQueryString:"true",Language:this.language,UseResume:"true",ShowFileOpen:"true",ProgramTitle:this.title,Prod:FileViewer.prod})}document.body.appendChild(a);WorkChatFileListViewer.utilObj=a}}else{WorkChatFileListViewer.initialized=true}};WorkChatFileListViewer.prototype.onreadystatechange=function(a){if(a==4){WorkChatFileListViewer.initialized=true}};WorkChatFileListViewer.prototype.setValue=function(c,b,a){this.createFile(c,b,a)};WorkChatFileListViewer.prototype.createFile=function(o,a,k){var m=a;var p=k;var n=m.attr("isMine");var h=p.attr("isMine");var i=m.show();var f=p.show();if(o.thumbPath&&o.thumbPath!=""){var d=i.find("div."+this.className+"_Thumb");var k=f.find("div."+this.className+"_View");if(d.length==0&&k.length==0){d=$("<div>").addClass(this.className+"_Thumb").appendTo(i);k=$("<div>").addClass(this.className+"_View").appendTo(f)}if(n&&h){$(d).toggleClass(this.className+"_Thumb_mine");$(k).toggleClass(this.className+"_View_mine")}var l=f.data("rep");var b=$("<div>").addClass("thumbnail").attr("title",o.filename).appendTo(d);var e=$('<a href="javascript:void(0);" hidefocus="true"></a>').addClass("thumbLink").appendTo(b).bind("mouseover",function(q){$(this).addClass("thumbOver");q.stopPropagation()}).bind("mouseout",function(q){$(this).removeClass("thumbOver");q.stopPropagation()}).bind("click",o,function(q){WorkChatFileListViewer.showPicture(k,o,l)});$("<img>").addClass("imgThumbnail").attr({src:WorkChatFileListViewer.imageUrl(o.thumbCode,o.thumbPath)}).appendTo(e);var g=$("<div>").addClass("overWrapper").appendTo(e);$("<div>").addClass("overBg").appendTo(g);$("<img>").addClass("zoomIcon").attr("src",JSV.getContextPath("/work/img/icon_zoom.gif")).appendTo(g)}else{var c=JSV.getLocationPath(JSV.getModuleUrl(JSV.merge(this.attach,o)));var d=i.find("div."+this.className);if(d.length==0){d=$("<div>").addClass(this.className).prependTo(i)}if(n&&h){var b=$("<div>").addClass("fileList").appendTo(d);b.css("float","right")}else{var b=$("<div>").addClass("fileList").appendTo(d)}$("<img>").addClass("fileIcon").attr("src",JSV.getContextPath(FileViewer.DIR+FileViewer.getIconName(o.filename))).appendTo(b);var e=$("<a>").addClass("linkList").attr("title",o.filename).appendTo(b);if(JSV.browser.msie&&this.activex){e.bind("click",o,function(q){WorkChatFileListViewer.download(q.data,c);return false})}else{if(JSV.browser.mozilla){c+="&isFF=true"}e.attr("href",c)}$("<span>").addClass("fileNameText").text(o.filename).appendTo(e);$("<span>").addClass("fileSizeText").text("("+FileViewer.getSize(o.filesize)+")").appendTo(e)}};WorkChatFileListViewer.download=function(a,b){WorkChatFileListViewer.utilObj.RemoveAllFiles();if(a.filename){WorkChatFileListViewer.utilObj.AppendFile(b,a.filename,a.filesize)}if(WorkChatFileListViewer.utilObj.GetCount>0){WorkChatFileListViewer.utilObj.ShowFileOpen=true;return WorkChatFileListViewer.utilObj.StartPlusDownload()}else{JSV.alert(JSV.getLang("FileViewer","warning"));return}};WorkChatFileListViewer.showPicture=function(f,d,e){if(f.css("display")=="block"){var a=f.find("img");if(d.path==a.attr("path")){f.slideUp("fast")}else{var c=WorkChatFileListViewer.imageUrl(d.type,d.path);a.attr({src:c,path:d.path,title:d.filename}).parent().data("url",c);WorkChatFileListViewer.ResizeImg(a,d,e)}}else{var a=f.find("img");if(a.length>0){if(d.path!=a.attr("path")){var c=WorkChatFileListViewer.imageUrl(d.type,d.path);a.attr({src:c,path:d.path,title:d.filename}).parent().data("url",c);WorkChatFileListViewer.ResizeImg(a,d,e)}f.slideDown("fast")}else{var c=WorkChatFileListViewer.imageUrl(d.type,d.path);var b=$('<a href="javascript:void(0);" hidefocus="true"></a>').data("url",c).appendTo(f).bind("click",function(k){var g="";var l="originImageViewer";var i="width=500px,height=500px,top=50,left=10,directories=no,menubar=no,toolbar=no,location=no,titlebar=no,resizable=yes,scrollbars=yes,status=no";window.open(g,l,i);var h=new ItemForm(null,{target:"originImageViewer"});h.put("imgSrc",$(this).data("url"));h.submit("/sys/jsv/doc/OriginImagePopUpViewer.jsp");return false});var a=$("<img>").attr({src:c,path:d.path,title:d.name}).appendTo(b);WorkChatFileListViewer.ResizeImg(a,d,e);f.slideDown("fast")}}};WorkChatFileListViewer.ResizeImg=function(c,f,g){var e=g?180:250;var d=parseInt(f.width);if(d>e){var b=d/e;var a=parseInt(f.height)/b;c.width(e).height(parseInt(a))}else{c.width(d).height(parseInt(f.height))}};WorkChatFileListViewer.imageUrl=function(a,b){return JSV.getContextPath("/jsl/inline/ImageAction.Download/?type="+a+"&path="+b)};function WorkChatListViewer(b,a){this.style=a||{};this.parent=b;this.skin=this.style.skin||"blue";this.tagText=this.style.tagText||null;this.linkTarget=this.style.linkTarget||"_blank";this.className=this.style.className||"WorkChatListViewer";this.moreText=this.style.moreText||JSV.getLang("WorkChatListViewer","moreText");this.topText=this.style.topText||JSV.getLang("WorkChatListViewer","topText");this.userId=this.style.userId;this.role=this.style.role;this.sessionKey=this.style.sessionKey;this.maxLength=this.style.maxLength||"150";this.mParam={name:"Date",key:"rgstDate"};this.firstRow=true;this.firstValue=null;this.widget=$("<div>").addClass(this.className).appendTo(this.parent);this.listArea=$("<div>").addClass("listArea").appendTo(this.widget);this.nonContentArea=$('<div class="non_contents" style="display:none;">					<div class="non_txt"><span class="icon"></span><span class="txt">'+JSV.getLang("WorkChatListViewer","nonContentMsg")+"</span></div>	</div>").appendTo(this.widget);this.morePlace=this.style.morePlace;this.fileView=new WorkChatFileListViewer();this.setTime()}WorkChatListViewer.prototype.setTime=function(){$(".user_comment_center").find(".dateText").each(function(){DateTextWriter.reloadTime();$(this).text(DateTextWriter.text($(this).attr("value"),"YY.MM.dd HH:mm"))});var a=this;setTimeout(function(){a.setTime()},60000)};WorkChatListViewer.prototype.nodeCreatItem=function(a){if(a){DateTextWriter.reloadTime();this.createItem(a).appendTo(this.listArea.show()).slideDown()}};WorkChatListViewer.prototype.setItemValues=function(b,f,d,a,c,g){this.url=b;if(f){this.mParam=f}if(!a){a=null}var e={url:this.url,mType:"min",cnt:d||WorkChatListViewer.ItemCount,more:true,order:a,chatId:c,itemId:g};this.drawList(e)};WorkChatListViewer.prototype.clearList=function(){this.listArea.empty();this.listArea.hide()};WorkChatListViewer.prototype.drawList=function(c){var a="";if(c.order&&c.order!=null){a="d"+c.order}var e="";if(this.tagText&&c.more){e="tag_"+this.tagText.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">");JSV.removeState("tag")}var d={ts:"1."+c.cnt+"."+a+"."+e};var b=c.mType+this.mParam.name;if(c[b]){d[b]=c[b]}d.chatId=c.chatId;d.itemId=c.itemId;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl(c.url)),context:this,dataType:"json",data:d,async:false,success:function(l,f){var m=l.array;var k=m.length;if(k>0){this.listArea.show();this.lastItemId=m[0].id}else{if(k===0&&!this.lastItemId){this.listArea.hide();this.nonContentArea.show()}}for(var g=0;g<k;g++){if(!c.more){m[g].isNew=true;if(g==k-1){this.firstRow=true;this.firstValue=null}}if($("#chatItem"+m[g].id).length>0){if(c.more){continue}else{$("#chatItem"+m[g].id).remove()}}var h=this.createItem(m[g]);if(c.itemId){h.appendTo(this.listArea)}else{h.prependTo(this.listArea)}if(JSV.getParameter("itemId")&&m[g].opnCnt&&m[g].opnCnt>0){$("#chatItemRep"+m[g].id).click()}}if(k==c.cnt){c[b]=m[k-1][this.mParam.key];this.createMore(c)}else{if(this.moreArea&&!c.itemId){this.moreBtn.unbind("click");this.moreBtn.bind("click",function(i){JSV.alert(JSV.getLang("WorkChatListViewer","noMoreData"))})}}},error:function(f){Notify(JSV.getLang("WorkChatListViewer","error"),ChatVar.Notify.ALERT)}})};WorkChatListViewer.prototype.createMore=function(b){if(!this.moreArea){var a=$(this.morePlace).addClass("morePlace");this.moreArea=true;this.moreBtn=$("<a>",{href:"javascript:void(0);"}).addClass("moreBtn").bind("click",this,function(c){c.stopPropagation();DateTextWriter.reloadTime();c.data.drawList($(this).data("val"));$(c.data.parent).slimScroll({scrollTo:0})}).append($("<span>").addClass("txt").text(this.moreText)).appendTo(a)}this.moreBtn.data("val",b)};WorkChatListViewer.prototype.createItem=function(k){var c=k.userId;var i=k.id;var p=$("<div>").addClass("listPlace");if(k.msgType==1000||k.msgType==2000||k.msgType==3000){var l=$("<div>").addClass("user_comment").appendTo(p);var s=$("<div>").addClass("user_comment_top").appendTo(l);var r=$("<div>").addClass("user_comment_top_right").appendTo(s);var b=$("<div>").addClass("user_comment_center").appendTo(l);var o=$("<div>").addClass("user_comment_btm").appendTo(l);var g=$("<div>").addClass("user_comment_btm_right").appendTo(o);if(this.userId!=c){$("<span>").addClass("arr").appendTo(l)}var n=$("<div>").appendTo(b);if(this.userId!=c){p.addClass("receive");n.addClass("text_location");l.css("float","left");var t=$("<span>").addClass("nameDefText").appendTo(n);var f=AnchorEmp.generateAnchor(c,(JSV.getLocaleStr(k.userName)||"")+" :");$(f).removeClass("AnchorEmp_generateAnchor").addClass(this.skin+"Text");$(t).append(f)}else{l.css("float","right");n.addClass("text_location")}var q=$("<div>").addClass("fileLocation").appendTo(n);var h=$("<span>").appendTo(n);h.addClass("listText");h.html(k.content);var d=$("<div>").addClass("regidate").css("clear","both").appendTo(l);$("<span>").addClass("dateText").attr("value",k.rgstDate).text(DateTextWriter.text(k.rgstDate,"YY.MM.dd HH:mm")).appendTo(d);var m=$("<span>").addClass("btnLayer").appendTo(d);var e=$("<span>").addClass("btnArea").appendTo(m);var a=$("<div>").addClass("fileLocation").data("layer",m).appendTo(p);if(this.userId==c){q.attr({id:"chatThumbFile"+i,isMine:true});a.attr({id:"chatViewFile"+i,isMine:true})}else{q.attr("id","chatThumbFile"+i);a.attr("id","chatViewFile"+i)}if(k.msgType==2000||k.msgType==3000){this.fileView.setValue(k,q,a)}}else{$("<div>").css("text-align","center").text(k.content).appendTo(p)}return p};WorkChatListViewer.prototype.scrollTo=function(a){if(a){this.parent.scrollTop=a}else{this.parent.scrollTop=this.parent.scrollHeight}};WorkChatListViewer.ItemCount=20;WorkChatListViewer.CommentCount=20;function WorkChatNotify(f,d,c){var e=$("#divChatMessage"),g,b=c||3500,a;if(e.is(":hidden")){e.slideDown(300)}e.css("top",(JSV.browser.msie)?document.documentElement.scrollTop:document.body.scrollTop);window.onscroll=function(){e.css("top",(JSV.browser.msie)?document.documentElement.scrollTop:document.body.scrollTop)};switch(d){case WorkChatVar.Notify.ALERT:a="alarmAlert";break;default:a="alarmText";break}if($(e).find(".alarmPlace").length<11){g=$("<div>").addClass("alarmPlace").css("display","block").appendTo(e).append($("<span/>").addClass(a).text(f)).append($("<a/>",{href:"#",hidefocus:"true"}).addClass("alarmClose").click(function(){g.slideUp(300,function(){g.remove()});return false}));if(JSV.browser.msie6){setTimeout(function(){g.slideDown(300)},1)}else{g.slideDown(300)}setTimeout(function(){g.children("a.alarmClose").trigger("click")},b)}}function WorkChatWriter(b,a){this.style=a||{};this.role=this.style.role||{};this.domain=this.style.domain||{};this.isReply=this.style.isReply||false;this.className=this.style.className||"WorkChatWriter";this.isQna=this.style.isQna||false;this.slideSpeed=100;this.chatId=this.style.chatId||JSV.getParameter("chatId");this.submitUrl=JSV.getContextPath(WorkChatVar.ChatWriteURL);this.widget=$('<div>         		    <div class="guideInput hideArea" style="display:none;">				   	 <div class="guideText"></div>				    </div>					<div class="fileAppendLayer" style="display:none;">				   </div>                   <div class="mainInputArea">                      <div class="inputLocation"></div>                      <a class="mainInputBtn" href="javascript:void(0);" hidefocus="true">                         <span class="send">'+JSV.getLang("WorkChatWriter","send")+'</span>                         <div class="indicator"></div>                     </a>                  </div>                  <div class="appendLayer">                     <div class="appendArea">                        <a class="append file" href="javascript:void(0);" hidefocus="true" onmouseover="this.className=\'append appendOver\'" onmouseout="this.className=\'append\'">							<div class="altWrapper">								<div class="altBg">									<span class="altText">'+JSV.getLang("WorkChatWriter","attachment")+'</span>								</div>							</div>							<div class="uploader"></div>						</a>                        <a class="append link" href="javascript:void(0);" hidefocus="true" onmouseover="this.className=\'append appendOver\'" onmouseout="this.className=\'append\'">							<div class="altWrapper">								<div class="altBg">										<span class="altText">										</span>								</div>							</div>							<div class="fileLayer"></div>						</a>                  </div>               </div>').addClass(this.className).appendTo(b);this.constructor();this.composeArea();this.init()}WorkChatWriter.prototype.populate=function(a){this.writer.ta.widget.focus();this.writer.ta.widget.click();if(a.content){this.writer.setValue(a.content)}this.writer.notifyCount()};WorkChatWriter.prototype.constructor=function(){this.maxCount=this.style.maxCount||150};WorkChatWriter.prototype.composeArea=function(){this.indicator=this.widget.find(".indicator");this.Area={};this.Area.header=this.widget.find(".guideInput");this.Area.editor=this.widget.find(".mainInputArea");this.Area.comment=this.Area.header.find(".guideText");this.Area.writer=this.Area.editor.find(".inputLocation");this.Area.wrButton=this.Area.editor.find(".mainInputBtn");this.Area.ext=this.widget.find(".appendLayer");this.Area.exFile=this.Area.ext.find(".fileLayer");this.Area.exFile2=this.widget.find(".fileAppendLayer");this.Area.exButton=this.Area.ext.find(".appendArea")};WorkChatWriter.prototype.init=function(){this.createHeader();this.createEditor();this.widget.bind("click",function(a){a.stopPropagation()})};WorkChatWriter.prototype.createHeader=function(){var _header,_comment;with(this.Area){_header=header;_comment=comment}var fileOnlyBtn=new KButton(_comment,JSV.getLang("WorkChatWriter","fileOnlyBtn"));fileOnlyBtn.editor=this;fileOnlyBtn.onclick=function(e){e.data.component.editor.fileOnlyBtnOnClick()};this.counter=new this.Counter(_header,this.maxCount)};WorkChatWriter.prototype.fileOnlyBtnOnClick=function(){var a="menubar=no, toolbar=no, location=no, scrollbars=no, resizable=yes";var b=JSV.getContextPath(JSV.getModuleUrl("/sys/jsv/doc/popup.jsp?targetUrl=/work/usr.list.chatFile.jsp?chatId="+this.chatId+"&titleText="+JSV.getLang("WorkChatWriter","fileOnlyTitle")));OpenWindowCenter.normal(740,600,b,"PopUpWorkChatFile"+this.chatId,a)};WorkChatWriter.prototype.createEditor=function(){var _writer,_button;with(this.Area){_writer=writer;_button=wrButton}this.writer=new this.Writer(_writer,this);this.button=new this.Button(_button,this);this.writer.setContentManager(new WorkChatWriterContentManager());JSV.register(this.writer,this.counter,"update");JSV.register(this.counter,this.button,"update");JSV.register(this.writer,this,"slide");JSV.register(this.writer,this,"submit");JSV.register(this.button,this,"submit")};WorkChatWriter.prototype.createExtension=function(){var _ext,panel,_panel,_button;with(this.Area){_ext=ext;_button=exButton}var uploader=new FileUploadEditor(_button.children(".file").children(".uploader"),{btnImage:"img/btn_addFiles.gif",btnStyle:"22.22.0.0",sessionKey:this.style.sessionKey,directUpload:"true",uploadAction:"/jsl/WorkChatItemUser.AttrUpload.jsl",fileSize:this.style.fileSize||0,totalSize:this.style.totalSize||0,notSupport:this.style.notSupport||"",chatId:this.chatId});uploader.component=this;uploader.select=function(file){this.formData=new FormData();var model;if(file&&file.id){model={method:"editor",type:1,path:"com.kcube.jsv.file.",filename:file.name,size:file.size};this.addFileParam("upload",JSV.toJSON(model),file.id);this.addFileParam("chatId",this.style.chatId,file.id);this.addFileParam(JSV.MODNAMES.CLASSID,JSV.getClassId(),file.id);this.addFileParam(JSV.MODNAMES.MODULEID,JSV.getModuleId(),file.id);this.addFileParam(JSV.MODNAMES.SPACEID,JSV.getSpaceId(),file.id);this.addFileParam(JSV.MODNAMES.MENUID,JSV.getMenuId(),file.id)}else{JSV.alert(JSV.getLang("WorkChatWriter","uploaderror"))}};uploader.progress=function(file,nPerc){};uploader.success=function(file,serverData){if(serverData.indexOf("DrmFilePermissionDenied")>-1){JSV.alert(JSV.getLang("WorkChatWriter","addFileDrmError"))}};var comp=this;uploader.SelectFile=function(){var _this=this;if(SwfUploadObject.isLoading){comp.openFileManager()}else{var fileInput=(_ext.find("input[type=file]"))?_ext.find("input[type=file]"):$("<input>",{type:"file",id:"fileInput"}).appendTo(_ext).hide();fileInput.change(function(e){var file=e.target.files[0];if(_this.select){_this.select(file)}});fileInput.one("click",function(e){e.stopPropagation()});if(JSV.browser.msie10){var fileInputClone=fileInput.clone(true);fileInput.remove();fileInput=fileInputClone.appendTo(_ext);fileInput.click()}else{fileInput.val("").click()}}};_ext.unbind("click.SelectFile").bind("click.SelectFile",function(e){e.stopPropagation();e.preventDefault();uploader.SelectFile();return false})};WorkChatWriter.prototype.openFileManager=function(){var a=JSV.getContextPath(JSV.getModuleUrl("/work/file.chatUpload.jsp"));var b={width:435,height:"auto",title:JSV.getLang("WorkChatWriter","fileAdd"),resizable:false};JSV.showLayerModalDialog(JSV.getModuleUrl(a),{comp:this},b,function(c){JSV.layerDialogClose()})};WorkChatWriter.prototype.focus=function(){if(this.writer){this.writer.ta.focus();this.slide(true);var a=$(window);if(this.writer.ta.widget.offset().top-a.scrollTop()+100>a.height()){a.scrollTop(a.scrollTop()+100)}}};WorkChatWriter.prototype.getValue=function(){var a={content:this.writer.getHTML()};return $.each(a,function(b,c){if(c==null){delete a[b]}})};WorkChatWriter.prototype.submit=function(){var a=null;if(a=this.validate()){$.ajax({url:JSV.getModuleUrl(this.submitUrl),dataType:"json",type:"POST",data:{item:JSV.toJSON(a),chatId:this.chatId},context:this,success:function(c,b){if(this.onWriteError&&c&&c.errorCode){this.onWriteError(c)}else{if(c&&c.blockedWord){WorkChatNotify(JSV.getLang("ChatWriter","prohibitWord2").replace(/(\${blockedWord})/g,c.blockedWord),WorkChatVar.Notify.ALERT)}else{this.onAfterSubmit();if(this.onAfterWrite){this.onAfterWrite(c)}}}},error:function(b){WorkChatNotify(JSV.getLang("WorkChatWriter","error"),WorkChatVar.Notify.ALERT)}})}};WorkChatWriter.prototype.onAfterSubmit=function(){this.writer.init()};WorkChatWriter.prototype.validate=function(){var a=this.getValue();if(this.counter.isOver){WorkChatNotify(JSV.getLang("WorkChatWriter","overCount"),WorkChatVar.Notify.ALERT);return null}if(!$.trim(a.content)){if(a.content==""){this.writer.init();return null}else{WorkChatNotify(JSV.getLang("WorkChatWriter","noContent"),WorkChatVar.Notify.ALERT);this.writer.init();return null}}else{return a}};WorkChatWriter.prototype.slide=function(c){var a=this.Area.ext,b=this.slideSpeed;if(c){a.slideDown(b)}else{a.slideUp(b,function(){$(this).children(":not(.appendArea)").hide()})}};WorkChatWriter.prototype.Counter=function(a,b){this.widget=$('<span class="numberLocation">                  <span class="curNumber"></span><span class="endNumber">/'+b+"</span>               </span>").appendTo(a);this.count=this.widget.find(".curNumber");this.isOver=false;this.update=function(c){if(c>b){this.count.addClass("overNumber");this.isOver=true}else{this.count.removeClass("overNumber");this.isOver=false}this.count.text(c);JSV.notify((c!=0&&!this.isOver),this,"update");if(c==0){JSV.notify(true,this,"zero")}};this.init=function(){this.update(0)};this.init()};WorkChatWriter.prototype.Writer=function(b,a){var c=3;this.component=a;this.max=this.component.maxCount;this.ta=new TextAreaEditor(b,{rows:c,maxLength:"150"});this.component.createExtension();this.ta.widget.addClass("mainInputText");this.ta.widget.bind("keypress",this,function(d){if(d.keyCode==13){d.data.submit();return false}}).bind("keyup",this,function(d){d.data.notifyCount()}).bind("click",this,function(d){}).bind("select",this,function(d){d.data.composeRange()}).bind("focus",this,function(d){d.data.sIdx=null;d.data.eIdx=null;JSV.notify(null,d.data,"onfocus")}).bind("scroll",this,function(d){this.rows=this.rows+2});this.setValue=function(d){this.ta.widget.val(d);JSV.notify(d,this,"write")};this.getValue=function(){return this.ta.getValue()};this.getHTML=function(){return this.contentManager.getHTML()};this.submit=function(){this.setValue(this.getValue().replace(/\n/g,"<br>"));JSV.notify(null,this,"submit")};this.getCount=function(){return this.contentManager.getLength()};this.notifyCount=function(){JSV.notify(this.getValue(),this,"write");JSV.notify(this.getHTML(),this,"preview");JSV.notify(this.getCount(),this,"update")};this.notifySlide=function(d){JSV.notify(d,this,"slide")};this.init=function(){this.setValue("");this.notifyCount();this.ta.widget.attr("rows",c)};this.setContentManager=function(d){this.contentManager=d;JSV.register(this,this.contentManager,"write")};this.composeRange=function(){var f=this.ta.widget.get(0);if(f.selectionStart!==undefined){this.sIdx=f.selectionStart;this.eIdx=f.selectionEnd}else{if(JSV.browser.msie&&document.selection){var d=document.selection.createRange(),g=d.text;if(g.length){var e=d.duplicate();e.moveToElementText(f);e.setEndPoint("EndToEnd",d);this.sIdx=e.text.length-d.text.length;this.eIdx=this.sIdx+g.length}}}};this.getSelectedIdxes=function(){if(this.sIdx!=null&&this.eIdx!=null){return[this.sIdx,this.eIdx]}else{return null}}};WorkChatWriter.prototype.Button=function(c,b){var d=JSV.getContextPath("img/mainInputBtn_hover.gif");var a=JSV.getContextPath("img/mainInputBtn.gif");this.widget=c.bind("click",function(e){WorkChatNotify(JSV.getLang("WorkChatWriter","noContent"),WorkChatVar.Notify.ALERT);e.stopPropagation()});this.update=function(e,f){if(e){this.widget.css({cursor:"pointer","background-image":'url("'+a+'")'}).unbind("click").bind("click",this,function(g){JSV.notify(null,g.data,"submit")})}else{this.widget.css({cursor:"default","background-image":'url("'+d+'")'}).unbind("click").bind("click",this,function(g){if(f.isOver){WorkChatNotify(JSV.getLang("WorkChatWriter","overCount"),WorkChatVar.Notify.ALERT)}else{WorkChatNotify(JSV.getLang("WorkChatWriter","noContent"),WorkChatVar.Notify.ALERT)}})}}};WorkChatWriter.prototype.Panel=function(b,a){this.widget=$('<div class="fileArea"></div>').appendTo(b);this.add=function(e,c){var d=$('<div class="files">           <a href="javascript:void(0);" hidefocus="true" class="fileName">               <img width="16" height="16" class="fileIcon"/>               <span class="fileNameText"><span class="text"></span><span class="fileSizeText"></span></span>           </a>           <a href="javascript:void(0);" hidefocus="true" class="fileDel"></a>       </div>').appendTo(this.widget);if(e=="attachment"){d.find(".fileName").css("cursor","default");d.find(".fileIcon").attr("src",FileViewer.getIcon(c.filename).src);d.find(".text").html(c.filename);d.find(".fileSizeText").text("("+FileFieldEditor.setByte(c.size)+")");d.find(".fileDel").hide();$("<div/>").addClass("graph").hide().appendTo(d).css("background-image","url("+JSV.getContextPath("img/multifile_blank.gif")+")").append($("<div/>").addClass("progress").append($("<img/>",{src:JSV.getContextPath("img/multifile_fill.gif")})))}else{d.find(".fileName").click(function(){RfrnHtmlViewer.showRfrn(c.menuId,c.moduleId,c.spaceId,c.classId,c.query);return false});d.find(".fileIcon").attr("src","img/icon_item.gif");d.find(".text").html(c.title);d.find(".fileSizeText").text(c.title)}d.addClass(e);d.attr(e+"id",c.id);d.data("data",c);d.find(".fileDel").click(this,function(f){if(f.data.widget.children().length==1){f.data.init()}else{d.remove()}})};this.getElement=function(c,d){return this.widget.children("["+c+'id="'+d+'"]')};this.getReferences=function(){var d="reference",c=[];c.nodeName=d;this.widget.children("."+d).each(function(){c.push($(this).data("data"))});return c.length>0?c:null};this.getAttachments=function(){var d="attachment",c=[];c.nodeName=d;this.widget.children("."+d).each(function(){var e=$.extend(true,{},$(this).data("data"));if(e.status=="success"){delete e.status;delete e.id;c.push(e)}});return c.length>0?c:null};this.init=function(){this.widget.children().remove();this.widget.parent().hide()}};WorkChatWriterContentManager=function(){this.widget=$("<span>").hide().appendTo(document.body);this.convert=function(a){a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");return a.replace(/\"(.*?)\":(http[s]?:\/\/[^\s]*)(\s|$)/g,'<a href="$2" title="$1" class="linked">$1</a>')};this.getLength=function(){return this.widget.text().length};this.getHTML=function(){return this.widget.html()};this.setValue=function(a){this.widget.html(this.convert(a))};this.write=function(a,b){this.setValue(a)}};var WorkChatVar={Notify:{INFO:0,ALERT:1},ChatWriteURL:"/jsl/WorkChatItemUser.DoRegister.json",ImageDownloadURL:"/jsl/inline/ImageAction.Download?path=@{path}&type=@{type}"};function WorkElementController(b,a){this.style=a?a:{};this.className=this.style.className?this.style.className:"WorkElementController";$(b).addClass(this.className);this.widget=$('<div class="choiceArea"></div>').appendTo(b);var c=$("<div>").addClass("choiceHeader").appendTo(this.widget);$("<h3>").addClass("title").text(this.style.headerTitle||"").appendTo(c);$("<span>").addClass("help_txt").append(JSV.getLang("WorkElementController","helpMsg")).appendTo(c);this.controllerContent=$("<div>").addClass("choiceContent").appendTo(this.widget)}WorkElementController.prototype.init=function(c,b){this.itemTemplate=c;this.elements=b;this.ctrBtns=new Array();for(var a=0;a<this.elements.length;a++){this.ctrBtns.push(this.createController(this.elements[a],this.elements.length-1,a))}};WorkElementController.prototype.setValue=function(a){var b=a?JSV.toJsonObj(a):[];for(var d=0;d<b.length;d++){if(!b[d].visible){for(var c=0;c<this.ctrBtns.length;c++){if(this.ctrBtns[c].id==b[d].id){this.ctrBtns[c].onclick();this.ctrBtns[c].isShow=false;break}}}}};WorkElementController.prototype.createController=function(f,b,c){var e=false;if(b==c){e=true}if(!this.ctrUl){this.ctrUl=$("<ul>").addClass("choice_list").appendTo(this.controllerContent).get(0)}var i=$("<li>").addClass("listLi").addClass("on").appendTo(this.ctrUl);if(e==true){i.addClass("noMargin")}var g=$("<h4>").addClass("list_Title").text(f.title).appendTo(i);var d=$("<ul>").addClass("tabWrap").appendTo(i).bind("selectstart",function(k){return false}).bind("dragstart",function(k){return false});var h=$("<li>").addClass("tab").appendTo(d);var a=$("<span>").addClass("tab_BG").css("cursor","pointer").html("&nbsp;").appendTo(h);a.component=this;a.isShow=true;a.id=f.id;a.onclick=function(l){var k=a.component.itemTemplate?a.component.itemTemplate.getChild(f.id):null;if(a.isShow){if(k){if(k&&k.widget.length){ItemViewer.hideTR(k.widget.get(0))}else{ItemViewer.hideTR(k.widget)}}i.removeClass("on")}else{if(k){if(k.widget.length){ItemViewer.showTR(k.widget.get(0))}else{ItemViewer.showTR(k.widget)}}i.addClass("on")}a.isShow=!a.isShow};a.bind("click",a.onclick);return a};WorkElementController.prototype.setMetadata=function(a){this.templateMeta=a};WorkElementController.prototype.getValue=function(){var a=new Array();this.templateMeta=this.templateMeta?this.templateMeta:this.itemTemplate?this.itemTemplate.viewer.metadata:[];for(var c=0;c<this.ctrBtns.length;c++){for(var b=0;b<this.templateMeta.length;b++){if(this.templateMeta[b].id&&(this.templateMeta[b].id==this.ctrBtns[c].id)){var d={id:this.templateMeta[b].id,name:this.templateMeta[b].name,visible:this.ctrBtns[c].isShow};a.push(d);break}}}return JSV.toJSON(a)};WorkElementController.viewVisibleController=function(e,a){var d=e;var b=a?JSV.toJsonObj(a):[];for(var c=0;c<b.length;c++){if(!(d.getChild(b[c].id))){continue}if(b[c].visible){if(d.getChild(b[c].id).widget.length){ItemViewer.showTR(d.getChild(b[c].id).widget.get(0))}else{ItemViewer.showTR(d.getChild(b[c].id).widget)}}else{if(d.getChild(b[c].id).widget.length){ItemViewer.hideTR(d.getChild(b[c].id).widget.get(0))}else{ItemViewer.hideTR(d.getChild(b[c].id).widget)}}}};WorkElementController.showDialogLayer=function(a,d){var b=JSV.getContextPath(JSV.getModuleUrl("/work/workElementControllerDialog.jsp"));var c={title:a.title,width:340,height:400,resizable:false};JSV.showLayerModalDialog(b,a,c,d)};function WorkExpireDateEditor(b,a){this.style=a||{};this.parent=b;this.className=this.style.className||"WorkExpireDateEditor";this.widget=$("<div>").addClass(this.className).appendTo(this.parent);this.combSpan=$("<span>").addClass("comb").appendTo(this.widget);this.dateSpan=$("<span>").addClass("date").appendTo(this.widget);var c=this;this.type=new ComboFieldEditor(this.combSpan,{options:this.style.options});this.type.onchange=function(d){if(d==-1){c.dateSpan.show()}else{c.dateSpan.hide()}};this.date=new DateFieldEditor(this.dateSpan,this.style);this.date.setValue(new Date().getTime())}WorkExpireDateEditor.prototype.setValue=function(a){if(a){this.type.setValue(a.exprMonth);this.type.onchange(a.exprMonth);if(a.exprDate){this.date.setValue(a.exprDate)}}else{this.type.setValue(0);this.type.onchange(0)}};WorkExpireDateEditor.prototype.getValue=function(){var a=[];var b=this.type.getValue();a.push(b);if(b==-1){a.push(this.date.getValue())}return a};function WorkHelperColumn(b,a){this.style=a||{};this.displayNameCnt=parseInt(this.style.displayNameCnt||5,10);this.className=this.style.className||"WorkHelperColumn";b.appendChild(this)}WorkHelperColumn.prototype.setValue=function(c,g,d){var a=$("<nobr>",{"class":this.className}).appendTo(g);var e=$(g);var f=c[this.style.id||"id"];var b=title=_name=JSV.getLocaleStr(c[this.style.name||"actorName"]);if(c.isHelper){b+="...";title="";a.css("cursor","pointer").data({name:_name,id:f}).bind("click",this,function(l){var k=$(this);var i=$(this).data("id");var h=$(this).data("name");if(WorkHelperColumn.itemid&&WorkHelperColumn.itemid==i){l.data.changed=false;l.data.toggleList()}else{if(k.data("array")){l.data.changed=true;l.data.actorName=h;l.data.actors=k.data("array");WorkHelperColumn.itemid=f;l.data.reloadList(e.children("nobr:first"))}else{$.getJSON(JSV.getContextPath(JSV.getModuleUrl(WorkHelperColumn.ACTORLIST+"?id="+f)),function(n,m){if(m=="success"){l.data.changed=true;l.data.actorName=h;l.data.actors=n.array;WorkHelperColumn.itemid=f;l.data.createList(e.children("nobr:first"));k.data("array",n.array)}})}}l.stopPropagation()})}a.append(AnchorEmp.generateAnchor(c.actorUserId,c.actorName));e.attr("align",this.style.align||"center")};WorkHelperColumn.prototype.createList=function(a){this.createLayer();this.reloadList(a)};WorkHelperColumn.prototype.reloadList=function(a){this.addActors();this.setPosition(a);this.toggleList()};WorkHelperColumn.prototype.createLayer=function(){var a=$("#WorkHelperColumn_moveDiv");this.layer=layer=(a.length==0)?$("<div>",{id:"WorkHelperColumn_moveDiv","class":"WorkHelperColumn_moveDiv"}).appendTo("body"):a;this.layer.bind("click",function(b){b.stopPropagation()})};WorkHelperColumn.prototype.setPosition=function(b){var a=b.offset();var d=a.top+b.height()+3;var c=a.left;this.layer.css({top:d,left:c})};WorkHelperColumn.prototype.addActors=function(){var c=this.layer.empty();var b=this.actorName;var a=0;$($.grep(this.actors,function(d){return JSV.getLocaleStr(d.name)!=b})).each(function(d){$("<div>").addClass("actors").append(AnchorEmp.generateAnchor(this.id,this.name)).appendTo(c);a++})};WorkHelperColumn.prototype.toggleList=function(){var a=this.layer;if(a.is(":visible")&&!this.changed){this.hideList()}else{a.show();$(document).one("click.WorkHelperColumn",this,function(b){b.data.hideList()})}};WorkHelperColumn.prototype.hideList=function(){this.layer.fadeOut()};WorkHelperColumn.ACTORLIST="/jsl/WorkUser.GetHelpers.json";var WorkItem={getRole:function(b){var a=(typeof b==="object")?b:JSV.loadJSON("/jsl/WorkUser.GetRole.json?id="+b);return{isActor:a.isActor,isHelper:a.isHelper,scrtLevel:a.scrtLevel,currentOwner:a.currentOwner,status:a.status,isSelfApprove:a.isSelfApprove}}};function WorkOrgSelectFieldEditor(b,a){OrgSelectFieldEditor.call(this,b,$.extend(a,{}));this.label=this.style.label||JSV.getLang("WorkOrgSelectFieldEditor","user");this.maxUserCount=this.style.maxUserCount||-1;this.duplicateLabel=this.style.duplicateLabel||JSV.getLang("WorkOrgSelectFieldEditor","defaultDuplicateLabel");this.value=[];this.actorId=null;JSV.register(this,this,"notify")}WorkOrgSelectFieldEditor.prototype=$.extend({},OrgSelectFieldEditor.prototype,{setValue:function(c){if(c){var a=this.isValueArray(c);if(this.textList.childNodes.length>1){$(this.textList).find("span."+this.className+"_textSpan").remove();if(this.oldValue&&this.oldValue.length>0){if(a){for(var b=0;b<this.oldValue.length;b++){if(c.indexOf(this.oldValue[b],EmpsFieldEditor.equals)==-1){JSV.notify(this.oldValue[b],this,"userDelete")}}}}}if(a){this.checkMaxCount(c,a);for(var b=0;b<c.length;b++){this.setInputValueData(c[b])}if(c.length>0){this.noDataField.hide();this.dataField.show()}}else{if(c.name!=""){this.setInputValueData(c);this.noDataField.hide();this.dataField.show()}}JSV.notify(this.value,this)}},getValue:function(){var b=[];b.nodeName="scrt";var c=$(this.textList).find("span."+this.className+"_textSpan");outer:for(var f=0;f<c.length;f++){var l=$(c[f]);var e=l.data();var h=l.text().replace(/,/g,"").trim()||l.find("input").val().replace(/,/g,"").trim();if(h!=""){for(var d=0;d<b.length;d++){if(e.xid&&b[d].xid==e.xid||e.id&&b[d].id==e.id){continue outer}}var g=e.title||e.displayName;var k=e.text||e.name;b.push({title:g,xid:e.xid,text:k,code:e.code,id:e.id,name:k,displayName:g})}}if(this.maxUserCount==1){var a={length:0};if(b&&b.length>0){a=b[0];a.length=1}return a}else{return b}},autoComplete:function(b,c){var a=b.xid||"";var e=b.id||"";if(a){if(this.isDuplicateData(b)){this.inputBox.value="";return}}else{if(e){if(this.isDuplicateData(b)){this.inputBox.value="";return}}else{var d=b.text;if(this.isDuplicate(d)){this.inputBox.value="";return}}}this.setInputValueData(b);JSV.notify(b,this,"notify")},setInputValueData:function(g){if(g){var d=this.isValueArray(g);if(!d){this.checkMaxCount(this.value,d)}var k=false;for(var b=0;b<this.value.length;b++){if(this.value[b].id==g.id){k=true}}if(!k){this.value.push(g)}var e=this;var c=JSV.clone(this.value);if(this.maxUserCount>0&&c.length>this.maxUserCount){this.onDelclick();this.value=c.slice(-this.maxUserCount);for(var b=0;b<this.value.length;b++){var f=JSV.getLocaleStr(this.value[b].title)||JSV.getLocaleStr(this.value[b].displayName);var h=f.indexOf("[")>-1?f.substring(0,f.indexOf("[")):f;var l=this.textList.lastChild;var a=$("<span>").addClass(this.className+"_textSpan").addClass("name").text(h).data(this.value[b]).attr("title",h).appendTo(this.textList);$("<a>").addClass("btn_delete").appendTo(a).on("click",function(n){JSV.notify($(this).parent().data(),e,"userDelete");for(var m=0;m<e.value.length;m++){if(e.value[m].id==$(this).parent().data().id){e.value.splice(m,1)}}$(this).parent().remove()});$(l).appendTo(this.textList)}}else{var f=JSV.getLocaleStr(g.title)||JSV.getLocaleStr(g.displayName);var h=f.indexOf("[")>-1?f.substring(0,f.indexOf("[")):f;var l=this.textList.lastChild;var a=$("<span>").addClass(this.className+"_textSpan").addClass("name").text(h).data(g).attr("title",h).appendTo(this.textList);$("<a>").addClass("btn_delete").appendTo(a).on("click",function(n){JSV.notify($(this).parent().data(),e,"userDelete");for(var m=0;m<e.value.length;m++){if(e.value[m].id==$(this).parent().data().id){e.value.splice(m,1)}}$(this).parent().remove()});$(l).appendTo(this.textList)}this.inputBox.value="";this.setFocus();JSV.notify(g,this,"notify");JSV.notify(g,this,"inputValueData")}},onclick:function(){var a=typeof this.style.showPopupComponent;var b=this;if(this.style.showPopupComponent=="EmpsFieldEditor"){EmpsFieldEditor.editor=this;this.oldValue=this.getValue();EmpsFieldEditor.onok=function(d){var c=JSV.clone(d);b.setValue(c)};EmpsFieldEditor.showPopup(this.getValue(),null,null,false)}else{if(this.style.showPopupComponent=="GroupMembersFieldEditorByXid"){GroupMenuScrtFieldEditor.showDialog($.extend(true,[],this.getValue()),"",this.style.groupId,this.style,function(c){if(c){b.setValue(c)}})}else{if(this.style.showPopupComponent=="EmpFieldEditor"){EmpFieldEditor.editor=this;this.oldValue=this.getValue();EmpFieldEditor.onok=function(d){var c=JSV.clone(d);b.setValue(c)};EmpFieldEditor.showPopup(this.getValue(),null)}else{if(a==="object"&&this.showPopupComponent instanceof WorkSecurityFieldEditor){this.showPopupComponent.onclick();this.showPopupComponent.setSecurity(this.getValue());this.showPopupComponent.setData=function(d){var c=JSV.clone(d);b.showPopupComponent.setSecurity(c);b.setValue(c)}}else{if(this.type==OrgSelectFieldEditor.USER){SecurityListFieldEditor.showDialog(this,"myGroup=no&group=no",false)}else{SecurityPortalListFieldEditor.showDialog(this,"type="+this.type+"&isUser="+this.isUser)}}}}}},onDelclick:function(){this.value=[];JSV.notify("allDelete",this,"userDelete");this.widget.find("span."+this.className+"_textSpan").remove();this.widget.find("input.input_txt").val("")},notify:function(b,c){if(c instanceof WorkSecurityFieldEditor){if(b[0]==WorkSecurityFieldEditor.SECURE_ACTOR){ItemViewer.hideTR(this.parent)}else{ItemViewer.showTR(this.parent)}}else{if(c instanceof EmpFieldEditor){this.actorId=c.user.id}for(var a=0;a<this.value.length;a++){if(this.value[a].id&&this.actorId==this.value[a].id){JSV.alert(JSV.getLang("WorkOrgSelectFieldEditor","duplicateMsg"));this.value.splice(a,1);$(this.textList).find("span."+this.className+"_textSpan").eq(a).remove()}}}},isValueArray:function(a){if(a.constructor.toString().indexOf("function Array()")>=0){return true}else{return false}},checkMaxCount:function(b,a){if(b){if(a){if(this.maxUserCount>0&&b.length>this.maxUserCount){var c=JSV.getLang("WorkOrgSelectFieldEditor","helpMsg")+this.maxUserCount+JSV.getLang("WorkOrgSelectFieldEditor","helpMsg2");JSV.alert(this.label+c);this.inputBox.value=""}}else{if(this.maxUserCount>0&&b.length>=this.maxUserCount){var c=JSV.getLang("WorkOrgSelectFieldEditor","helpMsg")+this.maxUserCount+JSV.getLang("WorkOrgSelectFieldEditor","helpMsg2");JSV.alert(this.label+c);this.inputBox.value=""}}}}});function WorkPlanEditor(parent,style){this.style=style||{};this.className=this.style.className||"WorkPlanEditor";this.widget=$("<div>",{id:"WorkPlanEditor","class":this.className}).appendTo(parent);this.readMode=(null!=this.style.readMode)?eval(this.style.readMode):false;this.url=this.style.url||"/work/plan/usr.list.jsp";$(parent).css("padding","0px")}WorkPlanEditor.prototype.loadPlan=function(h,c){this.widget.empty();var b=this.widget.height();var d=this.url;var a=h?h:"@{id}";var f="&selectedId="+(c?c:"0");var e=this.readMode?"&readMode="+this.readMode:"";var g="PORTLET_ID="+WorkPlanEditor.WORKPLAN_PTLID+"&workId="+a+f+e;this.widget.load(JSV.getContextPath(JSV.getModuleUrl(d),g),function(k,i,l){if(this.style.height){this.widget.height(this.style.height||b)}$(this.widget).css("height","auto")})};WorkPlanEditor.prototype.setValue=function(a){this.loadPlan(a)};WorkPlanEditor.WORKPLAN_PTLID="WORKPLAN";WorkPlanEditor.WORKPLAN_WRITE_PTLID="WORKPLANWRITE";function WorkPlanPopup(b,a){this.parent=b;this.style=a||{};this.className=this.style.className||"WorkPlanPopup"}WorkPlanPopup.prototype.popupShow=function(d,m,f){var l=12;if($(window).height()<650){var g=$(window).width()/1.1;var p=$(window).height()/1.8;var n=($(window).width()/1.45)-(g+l)/1.4}else{var g=$(window).width()/1.3;var p=$(window).height()/1.8;var n=($(window).width()/1.5)-(g+l)/1.4}var a=$("body");if($(a).find(".fixedTaskLayer").length>0){$(a).find(".fixedTaskLayer").remove()}var e=$("<div></div>").addClass("fixedTaskLayer");e.appendTo(a);var c=$("<div>").addClass("subfixedBg").appendTo(e);var i=$("<div>").addClass("subfixedLayerArea").appendTo(e);i.css("left",n+"px");i.css("width",g+24+"px");i.css("top","50px");i.appendTo(e);var k=$("<div>").addClass("subfixedTaskLayerHeader");k.appendTo(i);if(m=="write"){$("<h1>").addClass("layerTitle").text(JSV.getLang("WorkPlanPopup","WorkPlanPopupWriteTitle")).appendTo(k)}else{if(m=="edit"){$("<h1>").addClass("layerTitle").text(JSV.getLang("WorkPlanPopup","WorkPlanPopupEditTitle")).appendTo(k)}else{$("<h1>").addClass("layerTitle").text(JSV.getLang("WorkPlanPopup","WorkPlanPopupViewTitle")).appendTo(k)}}var h=$("<div>",{id:"subTaskContent"}).addClass("subfixedTaskLayerContent");h.css("width",g+"px");h.css("height",p+"px");h.appendTo(i);this.layerWidget=$(h).get(0);var o=$("<span>").addClass("subfixedLayerClose");o.appendTo(k);o.click(function(){$(".fixedTaskLayer",document).hide()});var r=h;var b="PORTLET_ID="+WorkPlanEditor.WORKPLAN_WRITE_PTLID;setTimeout(function(){r.load(JSV.getContextPath(JSV.getModuleUrl(d),b),function(s,q,t){})},2)};function WorkProcessEditor(b,a){this.style=a||{};this.empsLabel=this.style.empsLabel?this.style.empsLabel:JSV.getLang("WorkProcessEditor","reviewer");this.empLabel=this.style.empLabel?this.style.empLabel:JSV.getLang("WorkProcessEditor","approver");this.textLabel=this.style.textLabel?this.style.textLabel:JSV.getLang("WorkProcessEditor","reportSketch");this.empsUserCount=this.style.empsUserCount;this.empUserCount=this.style.empUserCount;this.autoComplete=this.style.autoComplete?this.style.autoComplete:false;this.autoCompleteStyle=this.style.autoCompleteStyle?this.style.autoCompleteStyle:"";this.empsPopupComponent=this.style.empsPopupComponent?this.style.empsPopupComponent:"";this.empPopupComponent=this.style.empPopupComponent?this.style.empPopupComponent:"";this.empsWidget=$('<div class="right_content">');this.empWidget=$('<div class="right_content">');this.textWidget=$('<div class="right_content">');this.widget=$("<div>").addClass("examination_Wrap").appendTo(b);$("<div>").addClass("list_Wrap").append($("<ul>").addClass("listWrap")).appendTo(this.widget);this.ul=this.widget.find(".listWrap").get(0);this.$ul=$(this.ul);$('<li class="list_Group">').append($('<div class="left_title">').append($('<div class="titleWrap">').append($('<span class="title">'+this.empsLabel+"</span>")))).append(this.empsWidget).appendTo(this.$ul);$('<li class="list_Group">').append($('<div class="left_title">').append($('<div class="titleWrap">').append($('<span class="title">'+this.empLabel+"</span>")))).append(this.empWidget).appendTo(this.$ul);this.reportSketch=new CheckBoxTextAreaEditor(this.textWidget,a);$('<li class="list_Group">').append($('<div class="left_title">').append($('<div class="titleWrap">').append($('<span class="title">'+this.textLabel+"</span>")))).append(this.textWidget).appendTo(this.$ul);this.reviewers=new WorkOrgSelectFieldEditor(this.empsWidget,{label:this.empsLabel,maxUserCount:this.empsUserCount,autoComplete:this.autoComplete,autoCompleteStyle:this.autoCompleteStyle,showPopupComponent:this.empsPopupComponent});this.approver=new WorkOrgSelectFieldEditor(this.empWidget,{label:this.empLabel,maxUserCount:this.empUserCount,autoComplete:this.autoComplete,autoCompleteStyle:this.autoCompleteStyle,showPopupComponent:this.empPopupComponent})}WorkProcessEditor.prototype.setValue=function(a){if(a&&a.reviewers){this.reviewers.setValue(a.reviewers)}if(a&&a.approver){this.approver.setValue(a.approver)}if(a&&a.reportSketch){this.reportSketch.setValue(a.reportSketch)}};WorkProcessEditor.prototype.getValue=function(a){var b=new Object();b.reviewers=this.reviewers.getValue();b.approver=this.approver.getValue();b.reportSketch=this.reportSketch.getValue();return b};function WorkProgressBar(b,a){this.style=a||{};this.className=this.style.className||"WorkProgressBar";this.$widget=$("<div>").addClass(this.className+"Wrap").appendTo(b);this.$progressBar=$("<div>").addClass(this.className).appendTo(this.$widget);this.$lineFull=$("<span>").addClass("line full").appendTo(this.$progressBar);this.$lineDotted=$("<span>").addClass("line dotted").appendTo(this.$progressBar);this.$progressList=$("<ul>").addClass("progressList").appendTo(this.$progressBar);var c=this;this.$progressList.on("click",".list",function(d){var f=c.$progressList.find(".list.checked");if(f.length>0){f.removeClass("checked")}$(this).addClass("checked");c.$lineFull.css("left",this.style.left);c.value=$(this).attr("val");if(c.onclick){c.onclick(c.value)}d.stopPropagation()})}WorkProgressBar.prototype.getValue=function(){return this.value};WorkProgressBar.prototype.setValue=function(b){var a=this.$progressList.find(".list[val='"+b+"']");if(a.length>0){var c=this.$progressList.find(".list.checked");if(c.length>0){c.removeClass("checked")}a.addClass("checked");this.$lineFull.css("left",a.get(0).style.left);this.value=b}};WorkProgressBar.prototype.add=function(a){var b=$("<li>").addClass("list").attr("val",a.value).css("left",a.leftPercent+"%").appendTo(this.$progressList);$('<a href="javascript:void(0);" class="stat">			<span class="ico"><span>check</span></span>			<span class="txt">'+a.label+"</span>		</a>").appendTo(b)};WorkProgressBar.prototype.addList=function(b){var e=this;var d=b.split(",");var c=d.length;var a=100/(c-1);$.each(d,function(f,g){var h=g.split(":");e.add({value:h[0],label:h[1],leftPercent:a*f})})};function WorkReferenceComponent(parent,style){this.style=style||{};this.className=this.style.className||"WorkReferenceComponent";this.add=this.style.add;this.totalSize=(this.style.totalSize&&Math.floor(this.style.totalSize)>0)?FileFieldEditor.GetKByte(this.style.totalSize):FileFieldEditor.getByte("2G");this.fileSize=(this.style.fileSize&&Math.floor(this.style.fileSize)>0)?FileFieldEditor.GetKByte(this.style.fileSize):0;this.notSupported=this.style.notSupport||"";this.totalFileSize=0;this.seq=JSV.SEQUENCE++;this.fileSeqId=1;this.xhrObjs={};this.fileCount=0;this.count=0;this.disable=false;this.setInfoShow=this.style.setInfoShow?eval(this.style.setInfoShow):false;this.attachUrl=(this.style.attach)?this.style.attach:'/jsl/attach/WorkReferenceAction.DownloadByUser?id=@{id}"';this.inlineUrl=(this.style.inline)?this.style.inline:'/jsl/inline/WorkReferenceAction.DownloadByUser?id=@{id}"';this.write=(this.style.write)?eval(this.style.write):false;this.read=(this.style.read)?eval(this.style.read):false;this.value=new Array();this.useHTML5=window.File&&window.FileList&&window.FileReader;this.folderPath="\\";this.widget=$('<div>					<div class="title"></div>			</div>').addClass(this.className);this.parentWidget=$("<div></div>").addClass("WorkReference").appendTo(parent);this.widget.appendTo(this.parentWidget);this.headerArea=$('<span class="left_title"></span>').text(this.style.label).appendTo(this.widget.find(".title")).get(0);this.ul=$("<ul>").addClass("file_list").appendTo(this.widget);var chooseTemp=new KButton(this.widget.find("div.title"),JSV.getLang("WorkReferenceComponent","select"));chooseTemp.component=this;chooseTemp.onclick=function(e){WorkReferenceComponent.itemId=this.component.docId;WorkReferenceComponent.comp=this.component;WorkReferenceComponent.showMenu(this.getWidget(),e);return false};if(this.useHTML5){var fileDiv=$("<div>").addClass("fileLayer").appendTo(this.parentWidget);this.fileDiv=fileDiv;var fileCon=$("<div>").addClass("layerContent").appendTo(fileDiv);var fileWrap=$("<div>").addClass("fileMsg").addClass("fileMsg_upload").appendTo(fileCon);var fileP=$("<div>").addClass("a").appendTo(fileWrap);$("<span>").addClass("file_text").append(JSV.getLang("WorkReferenceComponent","helpMsg")).appendTo(fileP);var emptyDiv=$("<div>").addClass("emptyLayer").appendTo(this.parentWidget);this.emptyDiv=emptyDiv;this.fileDragEventEnable()}if(this.setInfoShow){this.setInfo()}else{this.setFileLimitInfo()}JQueryUI.load($.proxy(this,"initDialog"))}WorkReferenceComponent.createMoveDiv=true;WorkReferenceComponent.menuButtonClicked=false;WorkReferenceMenuItem={FILE:{text:JSV.getLang("WorkReferenceComponent","file"),action:"WorkReferenceComponent.openFileUpload"},FAVORITE:{text:JSV.getLang("WorkReferenceComponent","fvrt"),action:"WorkReferenceComponent.selectFvrt"},URL:{text:JSV.getLang("WorkReferenceComponent","url"),action:"WorkReferenceComponent.writeURL"}};WorkReferenceMenu={menus:[WorkReferenceMenuItem.FILE,WorkReferenceMenuItem.URL]};WorkReferenceComponent.showMenu=function(a,b){var d=WorkReferenceMenu.menus;if(WorkReferenceComponent.createMoveDiv){$("<div>").attr("id","WorkReferenceMenu_moveDiv").addClass("WorkReferenceMenu_moveDiv").appendTo("body");WorkReferenceComponent.createMoveDiv=false}if(WorkReferenceComponent.menuButtonClicked==true){WorkReferenceComponent.menuButtonClicked=false;$("#WorkReferenceMenu_moveDiv").fadeOut()}else{WorkReferenceComponent.menuButtonClicked=true;WorkReferenceComponent.showSubMenu($("#WorkReferenceMenu_moveDiv").empty().get(0),d,WorkReferenceComponent.comp,b);var c=$(a);var e=c.offset().top+23;if(b.clientY+$("#WorkReferenceMenu_moveDiv").height()+17>document.body.clientHeight){e-=($("#WorkReferenceMenu_moveDiv").height()+25)}$("#WorkReferenceMenu_moveDiv").css("top",e).css("left",function(){var f=$(this).width();var g=c.offset().left;if(g+f>document.body.clientWidth){return g+c.width()-f-5}return g}).show();$(document).unbind("click.WorkReferenceMenu").one("click.WorkReferenceMenu",function(f){WorkReferenceComponent.menuButtonClicked=false;$("#WorkReferenceMenu_moveDiv").fadeOut();return false});$(document).unbind("scroll").one("scroll",function(f){$(document).trigger("click.WorkReferenceMenu");return false})}};WorkReferenceComponent.showSubMenu=function(parent,menus,component,parentEvent){if(menus.length==0){return}$(menus).each(function(i){var submenu=$("<div>").addClass("submenu").appendTo(parent).unbind("click.WorkReferenceMenu.showSubMenu").bind("click.WorkReferenceMenu.showSubMenu",this,function(event){var action=eval(event.data.action);action(component,parentEvent,this);$("#WorkReferenceMenu_moveDiv").fadeOut()}).unbind("mouseover.WorkReferenceMenu.showSubMenu").bind("mouseover.WorkReferenceMenu.showSubMenu",this,function(e){$(this).addClass("hover")}).unbind("mouseout.WorkReferenceMenu.showSubMenu").bind("mouseout.WorkReferenceMenu.showSubMenu",this,function(e){$(this).removeClass("hover")});$("<a>").addClass("text").text(this.text).appendTo(submenu)})};WorkReferenceComponent.openFileUpload=function(b,d,a){if(b.useHTML5){var c=$("<input>").attr({type:"file",multiple:"multiple"}).appendTo(a).hide().change(function(f){b.selectHandler(f.target.files)}).click(function(f){f.stopPropagation()});c.val("").click()}else{b.openFileManager()}};WorkReferenceComponent.writeURL=function(c,d,b){var a=function(f){if(f){var e=new Object();e.name=f.name;e.rfrnCode=WorkReferenceComponent.URLTYPE;e.rfrnQuery=f.query;e.method="editor";c.value.push(e);c.setValue(c.value)}};if(c.read==true){a=function(h){if(h){var e=new Object();e.name=h.name;e.rfrnCode=WorkReferenceComponent.URLTYPE;e.rfrnQuery=h.query;e.method="editor";var g=new Object();g.id=JSV.getParameter("id");g.workReferences=[e];var f;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkReferenceAction.DoReferenceUpdate.json")),dataType:"json",data:{item:JSV.toJSON(g)},async:false,type:"POST",success:function(i){if(i.error){c.onError(i);return}if(i!=null){c.setValue(i.workReferences);c.oncomplete()}},error:function(i){JSV.alert(JSV.getLang("WorkReferenceComponent","addError"))}})}}}WorkReferenceComponent.getAddUrl(WorkReferenceComponent.URLTYPE,a)};WorkReferenceComponent.getAddUrl=function(a,b){UrlDialog.showDialog(JSV.getLang("WorkReferenceComponent","headerURL"),JSV.getLang("WorkReferenceComponent","messageDialog"),null,a,b)};WorkReferenceComponent.selectFvrt=function(b,c,a){WorkReferenceComponent.comp=b;WorkReferenceComponent.onok=function(e){var d=JSV.clone(e);WorkReferenceComponent.comp.saveFvrt(d)};WorkReferenceComponent.showPopup()};WorkReferenceComponent.addFvrt=function(a){var b=new Object();b.id=a.id;b.name=a.title;b.rfrnCode=WorkReferenceComponent.FVRTTYPE;b.rfrnQuery=a.fvrtQuery;b.origin=a.origin;b.method="editor";return b};WorkReferenceComponent.prototype.setInfo=function(){if(this.setInfoShow){var a=FileFieldEditor.setByte(this.totalFileSize)+"/"+FileFieldEditor.setByte(this.totalSize);$(this.headerArea).text(this.style.label+" ("+a+") ")}};WorkReferenceComponent.prototype.setFileLimitInfo=function(){var a="";if(this.fileSize>0){a+=JSV.getLang("WorkReferenceComponent","fileLimitLabel")+FileFieldEditor.setByte(this.fileSize)+" / "}a+=JSV.getLang("WorkReferenceComponent","docLimitLabel")+FileFieldEditor.setByte(this.totalSize);$(this.headerArea).text(this.style.label+" ("+a+") ")};WorkReferenceComponent.prototype.openFileManager=function(){var a=JSV.getContextPath(JSV.getModuleUrl("/work/file.upload.jsp"));var b={width:435,height:"auto",title:JSV.getLang("WorkReferenceComponent","fileAdd"),resizable:false};JSV.showLayerModalDialog(JSV.getModuleUrl(a),{comp:this},b,function(c){JSV.layerDialogClose()})};WorkReferenceComponent.prototype.getValidValue=function(b){var c=new Array();for(var a=0;a<b.length;a++){if(!b[a].method||b[a].method!="delete"){c.push(b[a])}}return c};WorkReferenceComponent.prototype.setValue=function(f,d){$(this.ul).empty();$(this.widget).find(".fileLayer").remove();var h=$("<div>").addClass("fileLayer").appendTo(this.widget);var k=$("<div>").addClass("layerContent").appendTo(h);var c=$("<div>").addClass("fileMsg").addClass("fileMsg_upload").appendTo(k);var e=$("<div>").addClass("a").appendTo(c);var b=$("<img>").addClass("icon_file").attr("src","img/icon_file.png").appendTo(e);var g=$("<span>").addClass("msgUpload").append(JSV.getLang("WorkReferenceComponent","filemsg"));if(this.useHTML5){g.append(JSV.getLang("WorkReferenceComponent","filemsg1"))}g.append(JSV.getLang("WorkReferenceComponent","filemsg2")).appendTo(e);$("<span>").addClass("msgDisableUpload").append(JSV.getLang("WorkReferenceComponent","filemsg")).appendTo(e);f=this.getValidValue(f);if(f){this.value=f;if(this.value.length>0){h.remove();for(var a=0;a<this.value.length;a++){this.createUl(this.ul,this.value[a],a)}}else{h.css({position:"relative",width:"100%",height:"120px"}).show()}}else{h.css({position:"relative",width:"100%",height:"120px"}).show()}};WorkReferenceComponent.prototype.createUl=function(k,i,e){var l=$("<li>").addClass("file_item").appendTo(k);l.data("comp",this);if(i.rfrnCode==WorkReferenceComponent.FILETYPE){$("<i>").addClass("i_file_L").css("background-image","url("+JSV.getContextPath(FileViewer.DIR+"big/"+FileViewer.getIconName(i.filename))+")").appendTo(l);var d=$("<div>").addClass("row").appendTo(l);var b=$("<a>").addClass("file_link").appendTo(d);this.manageAnchor(b,i,false);$("<span>").addClass("file_name").text(i.filename).appendTo(b);$("<span>").addClass("file_size").text("("+FileViewer.getSize(i.size)+")").appendTo(b);if(this.write==false){var f=$("<div>").addClass("file_fn").appendTo(d);var m=$("<a>").addClass("open").text(JSV.getLang("FileViewer","open")).appendTo(f);this.manageAnchor(m,i,true);$("<span>").addClass("bar").text("|").appendTo(f);var c=$("<a>").addClass("save").text(JSV.getLang("FileViewer","save")).appendTo(f);this.manageAnchor(c,i,false)}var h=$("<div>").addClass("row").appendTo(l);var g=$("<div>").addClass("btn_area").appendTo(l);$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.del).html('<i class="i_file_item i_file_item_del"></i>').appendTo(g).bind("click",l,function(n){JSV.confirm(JSV.getLang("WorkReferenceComponent","confirmDeleteMsg"),function(o){if(o){$(n.data).data("comp").valueRemove(n.data,e)}})})}else{if(i.rfrnCode==WorkReferenceComponent.URLTYPE){$("<i>").addClass("i_file_L").css("background-image","url("+JSV.getContextPath(FileViewer.DIR+"big/url.png)")).appendTo(l);var d=$("<div>").addClass("row").appendTo(l);var b=$("<a>").addClass("file_link").appendTo(d);$("<span>").addClass("file_name").text(i.name).css({"word-break":"break-all"}).appendTo(b);b.bind("click",function(n){window.open(i.rfrnQuery,"_blank")});var h=$("<div>").addClass("row").appendTo(l);$("<a>").addClass("link_address").attr("href",'javascript:window.open("'+i.rfrnQuery+'", "_blank");').css({"word-break":"break-all"}).text(i.rfrnQuery).appendTo(h);var g=$("<div>").addClass("btn_area").appendTo(l);$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.del).html('<i class="i_file_item i_file_item_del"></i>').appendTo(g).bind("click",l,function(n){JSV.confirm(JSV.getLang("WorkReferenceComponent","confirmDeleteMsg"),function(o){if(o){$(n.data).data("comp").valueRemove(n.data,e)}})})}else{if(i.rfrnCode==WorkReferenceComponent.FVRTTYPE){$("<i>").addClass("i_file_L").css("background-image","url("+JSV.getContextPath(FileViewer.DIR+"big/bookmark.gif)")).appendTo(l);var d=$("<div>").addClass("row").appendTo(l);var b=$("<a>").addClass("file_link").appendTo(d);var a=i.origin||"none";$("<span>").addClass("group").text("["+JSV.getLang("WorkReferenceComponent",a)+"]").appendTo(b);$("<span>").addClass("file_name").text(i.name).css({"word-break":"break-all"}).appendTo(b);b.bind("click",function(n){window.open(i.rfrnQuery,"_blank")});var h=$("<div>").addClass("row").appendTo(l);$("<a>").attr("href",'javascript:window.open("'+i.rfrnQuery+'", "_blank");').addClass("link_address").css({"word-break":"break-all"}).text(i.rfrnQuery).appendTo(h);var g=$("<div>").addClass("btn_area").appendTo(l);$('<a href="javascript:void(0);"></a>').addClass("btn_file_item").attr("title",this.del).html('<i class="i_file_item i_file_item_del"></i>').appendTo(g).bind("click",l,function(n){JSV.confirm(JSV.getLang("WorkReferenceComponent","confirmDeleteMsg"),function(o){if(o){$(n.data).data("comp").valueRemove(n.data,e)}})})}}}};WorkReferenceComponent.prototype.manageAnchor=function(b,d,e){var c=JSV.getContextPath(JSV.getModuleUrl(JSV.merge(JSV.browser.msie?this.attachUrl:e?this.inlineUrl:this.attachUrl,d)));if(JSV.browser.msie){if(e){b.click(function(){var a=$("#WorkReferenceComponent");if(a.length>0){a.attr("src",c)}else{$("<iframe>").attr({id:"WorkReferenceComponent",width:0,height:0,frameborder:0,src:c}).appendTo("body")}})}else{b.click(function(){c+="&isFF=true";b.attr("href",c)})}}else{if(JSV.browser.firefox){c+="&isFF=true"}b.attr("href",c);if(e){b.attr("target","_blank")}}};WorkReferenceComponent.prototype.valueRemove=function(b,a){this.value[a].method="delete";if(this.value[a].size&&this.value[a].type){this.totalFileSize-=this.value[a].size;if(this.onTotalFileSizeChange&&$.isFunction(this.onTotalFileSizeChange)){this.onTotalFileSizeChange(this.totalFileSize)}}this.setInfo();if(this.read==true){this.referenceUpdate(this.value[a])}else{this.setValue(this.value)}};WorkReferenceComponent.prototype.referenceUpdate=function(b){var d=new Object();d.id=JSV.getParameter("id");d.workReferences=[b];var a;var c=this;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkReferenceAction.DoReferenceUpdate.json")),dataType:"json",data:{item:JSV.toJSON(d)},async:false,type:"POST",success:function(e){if(e.error){c.onError(e);return}c.setValue(e.workReferences);c.oncomplete();return true},error:function(e){JSV.alert(JSV.getLang("WorkReferenceComponent","addError"));return false}})};WorkReferenceComponent.prototype.saveFvrt=function(b){var a=function(e){if(e&&e.length>0){for(var c=0;c<e.length;c++){var d=WorkReferenceComponent.addFvrt(e[c]);WorkReferenceComponent.comp.value.push(d)}}WorkReferenceComponent.comp.setValue(WorkReferenceComponent.comp.value)};if(WorkReferenceComponent.comp.read){a=function(f){var g=new Object();g.id=JSV.getParameter("id");var c=new Array();for(var d=0;d<f.length;d++){var e=WorkReferenceComponent.addFvrt(f[d]);c.push(e)}g.workReferences=c;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkReferenceAction.DoReferenceUpdate.json")),dataType:"json",data:{item:JSV.toJSON(g)},async:false,type:"POST",success:function(h){if(h.error){WorkReferenceComponent.comp.onError(h);return}if(h!=null){WorkReferenceComponent.comp.setValue(h.workReferences);WorkReferenceComponent.comp.oncomplete()}},error:function(h){JSV.alert(JSV.getLang("WorkReferenceComponent","addError"))}})}}a(b)};WorkReferenceComponent.prototype.selectHandler=function(b){for(var a=0;a<b.length;a++){b[a].id=this.fileSeqId++;this.sendFile(b[a],a,b.length)}};WorkReferenceComponent.prototype.getValue=function(){var a=new Array();for(var b in this.value){if(this.value[b].method&&this.value[b].method!="delete"){a.push(this.value[b])}}return a};WorkReferenceComponent.prototype.initDialog=function(){this.dialogDiv=$('<div class="layerFileupLoad">		<div class="fileUploadList">			<table border="0" cellspacing="0" cellpadding="0" id="fileUploadTable">				<colgroup>					<col width="251"/>					<col width="89"/>					<col width="*"/>				</colgroup>				<tr>					<th>'+JSV.getLang("WorkReferenceComponent","fileName")+"</th>					<th>"+JSV.getLang("WorkReferenceComponent","fileSize")+"</th>					<th>"+JSV.getLang("WorkReferenceComponent","fileUploadStatus")+'</th>				</tr>				<tr style="height:7px;">				</tr>			</table>		</div>	</div>').attr({title:JSV.getLang("WorkReferenceComponent","fileUpload"),id:"fileUploadDialog"+this.seq}).appendTo(this.widget);var a=this;this.fileDialog=$("#fileUploadDialog"+this.seq).dialog({width:560,height:350,modal:true,resizable:false,autoOpen:false,dialogClass:"DocFileViewer LayerModalDialog FileModal",beforeClose:function(c){for(var b in a.xhrObjs){if(a.xhrObjs.hasOwnProperty(b)&&a.xhrObjs[b]){a.xhrObjs[b].abort()}}a.count=0;a.fileCount=0;$("#fileUploadTable tr.uploadTr").remove()}})};WorkReferenceComponent.prototype.dialogOpen=function(){this.fileDialog.dialog("open")};WorkReferenceComponent.prototype.dialogClose=function(){this.fileDialog.dialog("close")};WorkReferenceComponent.prototype.addProgress=function(c,e){if(!this.fileDialog.dialog("isOpen")){this.dialogOpen()}var d=$("<tr>").addClass("uploadTr").appendTo(this.dialogDiv.find("#fileUploadTable"));$("<td>").addClass("fileName").html('<img src="'+JSV.getContextPath(FileViewer.DIR+FileViewer.getIconName(c.name))+'"/>'+c.name).appendTo(d);$("<td>").addClass("fileSize").html(FileViewer.getSize(c.size)).appendTo(d);var b=$("<td>").addClass("status").appendTo(d);var a=$("<div>").addClass("progress").appendTo(b);$("<div>").addClass("percent").width(0).html("&nbsp;").appendTo(a);$("<span>").addClass("statusText").appendTo(b);if(e){d.attr("id","fileUpdTr"+e)}return d};WorkReferenceComponent.prototype.setProgress=function(c,a){var b=c.find("div.percent");b.width(a+"%");if(a==100){b.addClass("done")}c.find("span.statusText").text(a==100?JSV.getLang("WorkReferenceComponent","complete"):a+"%")};WorkReferenceComponent.prototype.sendFile=function(d,h,i){if(!FileFieldEditor.CheckExt(d.name,this.notSupported)){return}if(d.size<=0){JSV.alert("["+d.name+"] "+JSV.getLang("SwfUploadObject","zero_byte_file")+JSV.getLang("SwfUploadObject","error2"));return}if(this.fileSize>0&&d.size>=this.fileSize){JSV.alert(JSV.getLang("SwfUploadObject","file_exceeds_size_limit")+JSV.getLang("SwfUploadObject","error2"));return}if(this.totalSize<(this.totalFileSize+d.size)||this.totalSize=="0"){JSV.alert(JSV.getLang("FileCompositeFieldEditor","warning")+"\n"+JSV.getLang("SwfUploadObject","sizeError")+FileFieldEditor.setByte(this.totalSize)+"\n"+JSV.getLang("SwfUploadObject","sizeError2")+FileFieldEditor.setByte(d.size)+"\n"+JSV.getLang("SwfUploadObject","sizeError3")+FileFieldEditor.setByte(this.totalFileSize)+"\n"+JSV.getLang("SwfUploadObject","sizeError4")+FileFieldEditor.setByte(this.totalSize-this.totalFileSize));return}else{this.totalFileSize=this.totalFileSize+d.size;if(this.onTotalFileSizeChange&&$.isFunction(this.onTotalFileSizeChange)){this.onTotalFileSizeChange(this.totalFileSize)}this.setInfo()}var e={method:"editor",type:1,path:"com.kcube.jsv.file.",filename:d.name,size:d.size};this.fileCount++;var c=new FormData();c.append("upload",JSV.toJSON(e));c.append("com.kcube.jsv.file.",d);var g=this.addProgress(d,d.id);var b=function(k){if(k!=null){WorkReferenceComponent.comp.value.push(k);WorkReferenceComponent.comp.setValue(WorkReferenceComponent.comp.value)}};if(WorkReferenceComponent.comp.read){b=function(k){var m=new Object();m.id=JSV.getParameter("id");k.rfrnCode=WorkReferenceComponent.FILETYPE;m.workReferences=[k];var l;$.ajax({url:JSV.getContextPath(JSV.getModuleUrl("/jsl/WorkReferenceAction.DoReferenceUpdate.json")),dataType:"json",data:{item:JSV.toJSON(m)},async:false,type:"POST",success:function(n){if(n.error){WorkReferenceComponent.comp.onError(n,k);return}if(n!=null){WorkReferenceComponent.comp.setValue(n.workReferences);WorkReferenceComponent.comp.oncomplete()}},error:function(n){JSV.alert(JSV.getLang("WorkReferenceComponent","addError"))}})}}var a=null;var f=this;$.ajax({xhr:function(){var k=$.ajaxSettings.xhr();f.xhrObjs[d.id]=k;k.upload.addEventListener("progress",function(o){var m=0;var l=o.loaded||o.position;var n=o.total;if(o.lengthComputable){m=Math.ceil(l/n*100)}f.setProgress(g,m)},false);return k},url:JSV.getContextPath(FileUploadObject.UPLOAD_URL),dataType:"html",data:c,cache:false,contentType:false,processData:false,type:"POST",success:function(l){f.xhrObjs[d.id]=null;f.setProgress(g,100);if(++f.count==f.fileCount){f.count=0;f.fileCount=0;f.dialogClose()}var k=l.split("|");a={method:"editor",type:k[0],path:k[1],rfrnCode:WorkReferenceComponent.FILETYPE,filename:d.name,size:d.size};b(a)}})};WorkReferenceComponent.prototype.onError=function(b,a){if(b.error.indexOf("WorkUploadDeniedException")>-1){JSV.alert(JSV.getLang("WorkReferenceComponent","uploadDenied"))}else{if(b.error.indexOf("DrmFilePermissionDenied")>-1){JSV.alert(JSV.getLang("WorkReferenceComponent","addFileDrmError"))}else{JSV.alert(JSV.getLang("WorkReferenceComponent","addError"))}}if(a&&a.size>0){this.totalFileSize=this.totalFileSize-a.size;if(this.onTotalFileSizeChange&&$.isFunction(this.onTotalFileSizeChange)){this.onTotalFileSizeChange(this.totalFileSize)}}return};WorkReferenceComponent.prototype.oncomplete=function(){if(this.change){this.change()}};WorkReferenceComponent.prototype.setDisable=function(){this.disable=true;this.widget.find("div.title > .KButton").hide();this.widget.find(".btn_area").hide();this.widget.find(".icon_file, span.msgUpload").hide();this.widget.find("span.msgDisableUpload").show();if(this.useHTML5){this.fileDragEventDisable()}};WorkReferenceComponent.prototype.setEnable=function(){this.disable=false;this.widget.find("div.title > .KButton").show();this.widget.find(".btn_area").show();this.widget.find(".icon_file, span.msgUpload").show();this.widget.find("span.msgDisableUpload").hide();if(this.useHTML5){this.fileDragEventEnable()}};WorkReferenceComponent.prototype.widgetDragOver=function(a){if(this.value.length>0){this.fileDiv.show()}this.emptyDiv.show();this.ignoreDrag(a)};WorkReferenceComponent.prototype.widgetDragEnter=function(a){if(this.value.length>0){this.fileDiv.css({left:(this.ul)[0].offsetLeft,top:(this.ul)[0].offsetTop,height:(this.ul)[0].offsetHeight}).show()}this.emptyDiv.css({left:$(this.widget).get(0).offsetLeft,top:$(this.widget).get(0).offsetTop,width:$(this.widget).get(0).offsetWidth,height:$(this.widget).get(0).offsetHeight}).show();this.ignoreDrag(a)};WorkReferenceComponent.prototype.emptyDrop=function(b){b.preventDefault();var a=b.originalEvent.files||b.originalEvent.dataTransfer.files;if(a&&a.length>0){WorkReferenceComponent.comp=this;this.selectHandler(a)}this.emptyDiv.hide();this.fileDiv.hide();$(this.widget).find("fileLayer").remove()};WorkReferenceComponent.prototype.emptyDragLeave=function(a){this.emptyDiv.hide();this.fileDiv.hide()};WorkReferenceComponent.prototype.ignoreDrag=function(a){a.preventDefault()};WorkReferenceComponent.prototype.fileDragEventEnable=function(){var a=this;this.emptyDiv.unbind("drop.emptyDiv").unbind("dragover.emptyDiv").unbind("dragleave.emptyDiv").bind({"dragover.emptyDiv":function(b){b.preventDefault()},"drop.emptyDiv":function(b){a.emptyDrop(b)},"dragleave.emptyDiv":function(b){a.emptyDragLeave(b)}});$(this.widget).unbind("dragenter").unbind("dragover").bind({"dragover.fileWidget":function(b){a.widgetDragOver(b)},"dragenter.fileWidget":function(b){a.widgetDragEnter(b)}})};WorkReferenceComponent.prototype.fileDragEventDisable=function(){this.parentWidget.find(".emptyLayer").unbind("drop.emptyDiv").unbind("dragover.emptyDiv").unbind("dragleave.emptyDiv");this.widget.unbind("dragenter").unbind("dragover")};function UrlDialog(){}UrlDialog.showDialog=function(i,d,h,c,g){var a={header:i,message:d,value:h,code:c};var b=JSV.getContextPath("/work/urlDialog.jsp");var e="dialogWidth:370px;dialogHeight:260px;scroll:no;status:no;resizable:no";if(JSV.browser.msie6){e="dialogWidth:370px;dialogHeight:270px;scroll:no;status:no;resizable:no;"}JSV.showModalDialog(b,[a],e,g)};WorkReferenceComponent.showPopup=function(){var c="WorkReferenceComponent";var b=JSV.getModuleUrl("/work/workFvrtSelectPopup.jsp");var d="width=550,height=740,scrollbars=no,status=no,toolbar=no,menubar=no,location=no,resizable=no";var a=JSV.getContextPath(b);window.open(a,c,d)};WorkReferenceComponent.isNumber=function(a){return !isNaN(parseInt(a,10))};WorkReferenceComponent.FILETYPE=1000;WorkReferenceComponent.URLTYPE=2000;WorkReferenceComponent.FVRTTYPE=3000;function WorkSecurityFieldEditor(c,b){this.style=b?b:{};this.className=this.style.className?this.style.className:"SecurityFieldEditor";this.widget=$('<div>				<div class="scrtRadioDiv">				</div>				<div class="checkBox">				</div>				<div class="scrtOrgDiv">				</div>			</div>').addClass(this.className).appendTo(c);this.scrtRadioDiv=this.widget.find(".scrtRadioDiv");this.checkBoxDiv=this.widget.find(".checkBox");this.scrtOrgDiv=this.widget.find(".scrtOrgDiv");if(this.style.options){this.level=new RadioGroupFieldEditor(this.scrtRadioDiv,this.style);this.level.component=this;this.level.onchange=function(){this.component.onchange()};this.level.isSecure=function(){var e=this.getValue();return(e&&parseInt(e)>=4000&&parseInt(e)%4000==0)};this.level.isCheckSecure=function(){var e=this.getValue();return(e&&parseInt(e)>=1000&&parseInt(e)/6000==1)}}var d={label:JSV.getLang("WorkOrgSelectFieldEditor","scope"),autoComplete:true,showPopupComponent:this,autoCompleteStyle:{searchUrl:"/jsl/EmployeeSelector.SelectUserByNameQuery.json",includeDprt:true,isId:false}};this.orgSelect=new WorkOrgSelectFieldEditor(this.scrtOrgDiv,d);if(this.style.checkBox){var a={options:JSV.getLang("WorkSecurityFieldEditor","checkBox")};this.checkBox=new CheckBoxGroupFieldEditor(this.checkBoxDiv,a)}if(this.style.options){$(this.scrtRadioDiv).empty();this.level=new RadioGroupFieldEditor(this.scrtRadioDiv,this.style);this.level.component=this;this.level.onchange=function(){this.component.onchange()};this.level.isSecure=function(){var e=this.getValue();return(e&&parseInt(e)<WorkSecurityFieldEditor.SECURE_ACTOR)};this.level.isCheckSecure=function(e){return(e&&parseInt(e)>WorkSecurityFieldEditor.SECURE_ACTOR)};this.level.isCheckBoxShow=function(){var e=this.getValue();return(e&&parseInt(e)>=WorkSecurityFieldEditor.SECURE_HELPER)};this.level.isSecurityRange=function(){var e=this.getValue();return(e&&parseInt(e)==WorkSecurityFieldEditor.SECURE_RANGE)}}this.checkBoxShow=false}WorkSecurityFieldEditor.prototype.setValue=function(a){if(this.level){if(this.level.isCheckSecure(a[0])){this.level.setValue(parseInt(a[0])-WorkSecurityFieldEditor.checkTerm);this.setCheckBox()}else{this.level.setValue(a[0])}this.setSecurity(a[1]);this.orgSelect.setValue(this.getSecurity());this.onchange()}else{this.setSecurity(a);this.orgSelect.setValue(this.getSecurity())}};WorkSecurityFieldEditor.prototype.getValue=function(){this.setSecurity(this.orgSelect.getValue());if(this.level){var a=this.level.getValue();if(this.getCheckBox()&&a>0){return[parseInt(a)+WorkSecurityFieldEditor.checkTerm,this.security]}else{return[a,[]]}}return this.security};WorkSecurityFieldEditor.prototype.onchange=function(){this.checkBoxDiv.css("display","none");if(this.level.isCheckBoxShow()){this.checkBox.checked(true)}if(this.level.isSecurityRange()){this.scrtOrgDiv.css("display","block")}else{this.scrtOrgDiv.css("display","none")}JSV.notify(this.getValue(),this)};WorkSecurityFieldEditor.prototype.getSecurity=function(){return(this.level&&this.level.getValue()>0)?this.security:null};WorkSecurityFieldEditor.prototype.setSecurity=function(b){this.security=[];if(this.level.getValue()==WorkSecurityFieldEditor.SECURE_RANGE&&b){for(var a=0;a<b.length;a++){if(b[a].computed=="false"||!b[a].computed){this.security.push(b[a])}}}};WorkSecurityFieldEditor.prototype.getCheckBox=function(){return this.level.isSecure()?(this.checkBox.getValue().length>0):false};WorkSecurityFieldEditor.prototype.setCheckBox=function(){this.checkBox.checked(true,0)};WorkSecurityFieldEditor.prototype.onclick=function(){WorkSecurityFieldEditor.showDialog(this,this.style.dialogOption)};SecurityFieldEditor.prototype.onhelp=function(){OpenWindowCenter.normal(this.style.help.width,this.style.help.height,JSV.getContextPath(this.style.help.url),"SecurityHelp")};WorkSecurityFieldEditor.prototype.validate=function(a){if(this.level){var b=this.level.getValue();if(b&&parseInt(b)>=1000){if(this.security.length>0){return null}else{return a.message}}else{if(b&&parseInt(b)<1000){return null}else{return a.message}}}else{return a.message}};WorkSecurityFieldEditor.showDialog=function(c,e){WorkSecurityFieldEditor.component=c;var b=JSV.getContextPath("/work/WorkSecurityFieldEditorDialog.jsp",e);var d="830px";var a="740px";var g="Width="+d+",Height="+a+",scroll=no,status=no,resizable=yes,help=no";window.open(b,"scrt",g)};WorkSecurityFieldEditor.getData=function(){return WorkSecurityFieldEditor.component.getSecurity()};WorkSecurityFieldEditor.onok=function(a){WorkSecurityFieldEditor.component.setSecurity(JSV.clone(a))};WorkSecurityFieldEditor.makeGroupXid=function(d,a){var c=new String(parseInt(d)+100000000);var b=new String(parseInt(a)+100000000);return WorkSecurityFieldEditor.GROUP_CODE+c.substring(1)+b.substring(1)};WorkSecurityFieldEditor.prototype.inputValueData=function(a,b){this.setSecurity(b.getValue())};WorkSecurityFieldEditor.prototype.userDelete=function(c,e){if(c=="allDelete"){this.setSecurity()}else{var d=e.getValue();var a=d.length;for(var b=0;b<a;b++){if(c.xid==d[b].xid){d.splice(b,1);break}}this.setSecurity(d)}};WorkSecurityFieldEditor.GROUP_CODE=6;WorkSecurityFieldEditor.checkTerm=2000;WorkSecurityFieldEditor.SECURE_NONE=0;WorkSecurityFieldEditor.SECURE_ACTOR=6000;WorkSecurityFieldEditor.SECURE_HELPER=4100;WorkSecurityFieldEditor.SECURE_RANGE=4200;function WorkSecurityGradeViewer(b,a){this.parent=b;this.style=a||{};this.className=this.style.className?this.style.className:"WorkSecurityGradeViewer";this.widget=$("<span>").addClass("textSpan").addClass(this.className).appendTo(b);this.options=ComboViewer.createOptions(this.style)}WorkSecurityGradeViewer.prototype.setValue=function(b){var d=b[0];this.value=b[1];var a=false;var c=(b[1]!=null)?parseInt(b[1]):null;if(c!=null){this.value=c;if(this.value>WorkSecurityFieldEditor.SECURE_ACTOR){this.value-=WorkSecurityFieldEditor.checkTerm}$(this.widget).text(this.options[this.value]).appendTo(this.anchor);if(this.options[this.value]!=undefined&&this.options[this.value]!=null){$(this.widget).bind("click",this,function(h){var f=h.data;var g="/jsl/"+f.style.actionUrl+".json?id="+b[0];WorkSecurityGradeViewer.popup(g,false);return false})}else{this.widget.addClass("hide").text(JSV.getLang("WorkSecurityGradeViewer","scrtHide"))}}};WorkSecurityGradeViewer.showDialog=function(e,a,d){var f=[e,a];var c=JSV.getContextPath("/sys/jsv/xid/securityGradeViewerDialog.jsp");var b="dialogWidth:350px;dialogHeight:420px;scroll:auto;status:no;resizable:no;";JSV.showModalDialog(c,f,b,d)};WorkSecurityGradeViewer.popup=function(c,a){var d="width=350px,height=420px,scrollbars=yes,status=no,toolbar=no,menubar=no,location=no,resizablse=yes";window.open("","WorkSecurityGradeViewer",d);JSV.setState("actionUrl",c);JSV.setState("directShow",a);var b="/sys/jsv/xid/securityGradeViewerDialog.jsp";JSV.doGET(b,"WorkSecurityGradeViewer")};function WorkStatusFieldEditor(b,a){this.style=a||{};this.style.className=this.style.className||"WorkStatusFieldEditor";this.attribute=this.style.attribute||"id";TaskStatusFieldEditor.call(this,b,this.style);$.data(WorkStatusFieldEditor,"component",this);this.observerRegister()}WorkStatusFieldEditor.prototype=$.extend({},TaskStatusFieldEditor.prototype,{init:function(){this.isWork=this.style.isWork?eval(this.style.isWork):true;this.completeDate=$("<p>").addClass("dueDate").appendTo(this.widget);this.statusViewer=$("<div>").addClass("TaskStatusBox").appendTo(this.widget);this.arrow=$('<a href="javascript:void(0);"></a>').addClass("btn").appendTo(this.widget).on("click",this,function(e){if(e.data.setDiv.css("display")=="none"){$(document).one("click.taskstatus",e.data,function(e){e.data.widget.removeClass("on");e.data.setDiv.hide()});e.data.widget.addClass("on");e.data.setDiv.show();e.stopPropagation()}});this.setDiv=$("<div>").addClass("layer").appendTo(this.arrow);this.ul=$("<ul>").appendTo(this.setDiv);$("<img>").attr("src",JSV.getContextPath("/img/btn_pulldown_arr.png")).appendTo(this.arrow);var options=WorkStatusFieldEditor.defaultStatus;var _this=this;$(options).each(function(i){_this.add(this)})},setCompleteDate:function(a){this.completeDate.prependTo(this.widget).text(JSV.getLang("TaskStatusFieldEditor","completeDate")+DateFormat.format(new Date(a),JSV.getLang("DateFormat","dateType1")))},setValue:function(c,b){if(c==WorkStatusFieldEditor.DELETED){return}this.value=c;if(JSV.isNotEmpty(b)){this.setId(b.getProperty(this.attribute));this.editable=this.style.editable||b.getProperty(this.style.editAttr);this.item=b}this.setEditable(false);this.statusViewer.text(this.statuses[this.value]).removeClass("status").addClass("status"+this.value);if(this.value==WorkStatusFieldEditor.APRVAL_COMPLETE){var a=b.getProperty(this.style.completeDate);this.setCompleteDate(a);this.setEditable(this.editable)}else{if(this.value==WorkStatusFieldEditor.APPROVAL){return}else{if(this.value==WorkStatusFieldEditor.REVIEW){return}else{if(this.value==WorkStatusFieldEditor.COMPLETE){var a=b.getProperty(this.style.completeDate);this.setCompleteDate(a);return}else{this.setEditable(this.editable)}}}}},observerRegister:function(){var a=$.data(ProcessStatusViewer,"component");if(a){JSV.register(a,this,"statuschange")}},onsuccess:function(a){this.statusViewer.text(this.statuses[this.value]).removeClass().addClass("TaskStatusBox status"+this.value);if(this.value==WorkStatusFieldEditor.COMPLETE){this.setCompleteDate(a.completeDate);this.setEditable(false)}else{this.completeDate.empty();this.setEditable(this.editable)}if(this.change){this.change(this.value)}JSV.notify(this.value,this,"notify")},setEditable:function(){var c=arguments[0]||false;if(c){this.arrow.show()}else{this.arrow.hide()}var a=WorkStatusFieldEditor.defaultStatus;if(this.isWork){if(c&&this.value){a=WorkStatusFieldEditor.editStatus[this.value]}}else{a=WorkStatusFieldEditor.noPrcsStatus}this.ul.empty();var d=this;for(var b=0;b<a.length;b++){$(a[b]).each(function(){d.add(a[b])})}},statuschange:function(a){this.value=a;if(this.value==WorkStatusFieldEditor.APPROVAL){this.setEditable(false)}else{if(this.value==WorkStatusFieldEditor.REVIEW){this.setEditable(false)}else{this.setEditable(this.editable)}}this.statusViewer.empty().append($(this.statuses[this.value].widget).clone());if(this.value==WorkStatusFieldEditor.COMPLETE){this.setCompleteDate(data.completeDate)}else{this.completeDate.empty()}if(this.change){this.change()}},doUpdate:function(){var b=this.id||JSV.getParameter(this.style.attribute);var a=this;if(this.editable){$.ajax({url:JSV.getModuleUrl(JSV.getContextPath(this.style.action||TaskStatusFieldEditor.action)),type:"POST",dataType:"json",data:{id:b,status:this.value},context:this,async:false,success:function(d,c){if(d.error!=undefined){if(d.error.indexOf("SubPlanException")>-1){JSV.alert(JSV.getLang("WorkStatusFieldEditor","subPlanException"))}else{JSV.alert(JSV.getLang("TaskEmpsViewer","permissionDenied"))}}else{this.onsuccess(d)}},error:function(c){this.onerror()}})}},Status:function(c){var a=c.color;var d=c.value;var b="";if(WorkStatusFieldEditor.WORKING==d){b="H24_orange"}else{if(WorkStatusFieldEditor.COMPLETE==d){b="H24colorb4b4b4"}else{if(WorkStatusFieldEditor.REPORTING==d){b="H24color27b6af"}else{if(WorkStatusFieldEditor.APPROVAL==d){b="H24color3498db"}else{if(WorkStatusFieldEditor.REVIEW==d){b="H24color27b6af"}else{if(WorkStatusFieldEditor.REVIEWCMPLT==d){b="H24color27b6af"}else{if(WorkStatusFieldEditor.NEEDSUPPLEMENT==d){b="H24color3498db"}else{if(WorkStatusFieldEditor.APRVAL_COMPLETE==d){b="H24colorb4b4b4"}}}}}}}}this.widget=$("<span>").appendTo("body").get(0);this.status=new KButton(this.widget,$.extend({className:b,css:{color:a}},{text:c.text}))}});WorkStatusFieldEditor.prototype.constructor=WorkStatusFieldEditor;WorkStatusFieldEditor.STAY=3400;WorkStatusFieldEditor.WORKING=3500;WorkStatusFieldEditor.STOP=3800;WorkStatusFieldEditor.REPORTING=4000;WorkStatusFieldEditor.APPROVAL=4500;WorkStatusFieldEditor.NEEDSUPPLEMENT=4510;WorkStatusFieldEditor.REVIEW=5000;WorkStatusFieldEditor.REVIEWCMPLT=5010;WorkStatusFieldEditor.APRVAL_COMPLETE=6000;WorkStatusFieldEditor.COMPLETE=7000;WorkStatusFieldEditor.DELETED=9000;WorkStatusFieldEditor.defaultStatus=[{text:JSV.getLang("WorkStatusFieldEditor","working"),value:WorkStatusFieldEditor.WORKING,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","approving"),value:WorkStatusFieldEditor.APPROVAL,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","reviewing"),value:WorkStatusFieldEditor.REVIEW,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","reviewCmplt"),value:WorkStatusFieldEditor.REVIEWCMPLT,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","needMore"),value:WorkStatusFieldEditor.NEEDSUPPLEMENT,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","aprvComplete"),value:WorkStatusFieldEditor.APRVAL_COMPLETE,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"#FFF"}];WorkStatusFieldEditor.allStatus=[{text:JSV.getLang("WorkStatusFieldEditor","working"),value:WorkStatusFieldEditor.WORKING,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","approving"),value:WorkStatusFieldEditor.APPROVAL,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","reviewing"),value:WorkStatusFieldEditor.REVIEW,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","reviewCmplt"),value:WorkStatusFieldEditor.REVIEWCMPLT,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","needMore"),value:WorkStatusFieldEditor.NEEDSUPPLEMENT,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","aprvComplete"),value:WorkStatusFieldEditor.APRVAL_COMPLETE,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"#FFF"}];WorkStatusFieldEditor.editStatus={4510:[{text:JSV.getLang("WorkStatusFieldEditor","working"),value:WorkStatusFieldEditor.WORKING,color:"0;#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"3;#FFF"}],5010:[{text:JSV.getLang("WorkStatusFieldEditor","working"),value:WorkStatusFieldEditor.WORKING,color:"0;#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"3;#FFF"}],3500:[{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"3;#FFF"}],6000:[{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"3;#FFF"}],7000:[]};WorkStatusFieldEditor.noPrcsStatus=[{text:JSV.getLang("WorkStatusFieldEditor","stay"),value:WorkStatusFieldEditor.STAY,color:"#ff3f80"},{text:JSV.getLang("WorkStatusFieldEditor","doing"),value:WorkStatusFieldEditor.WORKING,color:"#1ab6ac"},{text:JSV.getLang("WorkStatusFieldEditor","complete"),value:WorkStatusFieldEditor.COMPLETE,color:"#FFF"},{text:JSV.getLang("WorkStatusFieldEditor","stop"),value:WorkStatusFieldEditor.STOP,color:"#FFF"}];(function(a){a.fn.gantt=function(d){var h="jquery.fn.gantt";var g=["hours","days","weeks","months"];var e={source:[],itemsPerPage:7,months:["January","February","March","April","May","June","July","August","September","October","November","December"],dow:["S","M","T","W","T","F","S"],startPos:new Date(),navigate:"buttons",scale:"days",useCookie:false,maxScale:"months",minScale:"hours",waitText:"Please wait...",onItemClick:function(i){return},onAddClick:function(i){return},onRender:function(){return},onDataLoadFailed:function(i){return},scrollToToday:true,};if(d){a.extend(e,d)}e.useCookie=e.useCookie&&a.isFunction(a.cookie);a.extend(a.expr[":"],{findday:function(l,p,k){var q=new Date(parseInt(k[3],10));var r=a(l).attr("id");r=r?r:"";var o=r.indexOf("-")+1;var n=new Date(parseInt(r.substring(o,r.length),10));q=new Date(q.getFullYear(),q.getMonth(),q.getDate());n=new Date(n.getFullYear(),n.getMonth(),n.getDate());return q.getTime()===n.getTime()},});a.extend(a.expr[":"],{findweek:function(l,p,k){var q=new Date(parseInt(k[3],10));var r=a(l).attr("id");r=r?r:"";var o=r.indexOf("-")+1;q=q.getFullYear()+"-"+q.getDayForWeek().getWeekOfYear();var n=r.substring(o,r.length);return q===n},});a.extend(a.expr[":"],{findmonth:function(l,p,k){var q=new Date(parseInt(k[3],10));q=q.getFullYear()+"-"+q.getMonth();var r=a(l).attr("id");r=r?r:"";var o=r.indexOf("-")+1;var n=r.substring(o,r.length);return q===n},});Date.prototype.getWeekId=function(){var l=this.getFullYear();var k=this.getDayForWeek().getWeekOfYear();var i=this.getMonth();if(i===11&&k===1){l++}return"dh-"+l+"-"+k};Date.prototype.getRepDate=function(){switch(e.scale){case"hours":return this.getTime();case"weeks":return this.getDayForWeek().getTime();case"months":return new Date(this.getFullYear(),this.getMonth(),1).getTime();default:return this.getTime()}};Date.prototype.getDayOfYear=function(){var i=new Date(this.getFullYear(),0,0);var k=new Date(this.getFullYear(),this.getMonth(),this.getDate());return Math.ceil((k-i)/86400000)};Date.prototype.getWeekOfYear=function(){var i=new Date(this.getFullYear(),0,1);var k=new Date(this.getTime());k.setDate(k.getDate()+4-(k.getDay()||7));return Math.floor(Math.round((k-i)/86400000)/7)+1};Date.prototype.getDaysInMonth=function(){return 32-new Date(this.getFullYear(),this.getMonth(),32).getDate()};Date.prototype.hasWeek=function(){var k=new Date(this.valueOf());k.setDate(k.getDate()-k.getDay());var i=new Date(this.valueOf());i.setDate(i.getDate()+(6-i.getDay()));if(k.getMonth()===i.getMonth()){return true}else{return(k.getMonth()===this.getMonth()&&i.getDate()<4)||(k.getMonth()!==this.getMonth()&&i.getDate()>=4)}};Date.prototype.getDayForWeek=function(){var k=new Date(this.valueOf());k.setDate(k.getDate()-k.getDay());var i=new Date(this.valueOf());i.setDate(i.getDate()+(6-i.getDay()));if(k.getMonth()===i.getMonth()||(k.getMonth()!==i.getMonth()&&i.getDate()>=4)){return new Date(i.setDate(i.getDate()-3))}else{return new Date(k.setDate(k.getDate()+3))}};function b(k,l){for(var i=1;;i++){var m=new Date(k);m.setHours(k.getHours()+l*i);if(m.getTime()!==k.getTime()){return m}}}var c={elementFromPoint:function(i,k){if(!a.support.boxModel){i-=a(document).scrollLeft();k-=a(document).scrollTop()}else{i-=window.pageXOffset;k-=window.pageYOffset}return document.elementFromPoint(i,k)},create:function(i){if(typeof e.source!=="string"){i.data=e.source;c.init(i)}else{a.getJSON(e.source,function(k){i.data=k;c.init(i)})}},init:function(i){try{i.rowsNum=i.data.length;i.pageCount=Math.ceil(i.rowsNum/e.itemsPerPage);i.rowsOnLastPage=i.rowsNum-Math.floor(i.rowsNum/e.itemsPerPage)*e.itemsPerPage;i.dateStart=f.getMinDate(i);i.dateEnd=f.getMaxDate(i);c.waitToggle(i,true,function(){c.render(i)})}catch(k){if(i.data===null||(typeof i.data==="object"&&i.data.length===0)){e.onDataLoadFailed(a(this).data("dataObj"))}}},render:function(m){var n=a('<div class="fn-content"/>');var i=c.leftPanel(m);n.append(i);var l=c.rightPanel(m,i);var q,k;n.append(l);n.append(c.navigation(m));var p=l.find(".dataPanel");m.gantt=a('<div class="fn-gantt" />').append(n);a(m).html(m.gantt);m.scrollNavigation.panelMargin=parseInt(p.css("margin-left").replace("px",""),10);m.scrollNavigation.panelMaxPos=p.width()-l.width();m.scrollNavigation.canScroll=p.width()>l.width();c.markNow(m);c.fillData(m,p,i);if(e.useCookie){var o=a.cookie(this.cookieKey+"ScrollPos");if(o){m.hPosition=o}}if(e.scrollToToday){c.navigateTo(m,"now");c.scrollPanel(m,0)}else{if(m.hPosition!==0){if(m.scaleOldWidth){q=p.width()-l.width();k=(q*m.hPosition)/m.scaleOldWidth;k=k>0?0:k;p.css({"margin-left":k+"px"});m.scrollNavigation.panelMargin=k;m.hPosition=k;m.scaleOldWidth=null}else{p.css({"margin-left":m.hPosition+"px"});m.scrollNavigation.panelMargin=m.hPosition}c.repositionLabel(m)}}p.css({height:i.height()});c.waitToggle(m,false);e.onRender()},leftPanel:function(l){var k=a('<div class="leftPanel"/>').append(a('<div class="row spacer"/>').css("height",f.getCellSize()*l.headerRows+"px").css("width","100%"));var i=[];a.each(l.data,function(m,n){if(m>=l.pageNum*e.itemsPerPage&&m<l.pageNum*e.itemsPerPage+e.itemsPerPage){var o=n.depth?n.depth:0;i.push('<div class="row name row'+m+(n.desc?"":" fn-wide")+'" id="rowheader'+m+'" offset="'+(m%e.itemsPerPage)*f.getCellSize()+'">');i.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'" style="margin-left:'+20*o+'px">'+(n.name||"")+"</span>");i.push("</div>");if(n.desc){i.push('<div class="row desc row'+m+' " id="RowdId_'+m+'" data-id="'+n.id+'">');i.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'">'+n.desc+"</span>");i.push("</div>")}}});k.append(i.join(""));return k},dataPanel:function(l,m){var i=a('<div class="dataPanel" style="width: '+m+'px;"/>');var k=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";if(document.attachEvent){l.attachEvent("on"+k,function(n){c.wheelScroll(l,n)})}else{if(document.addEventListener){l.addEventListener(k,function(n){c.wheelScroll(l,n)},false)}}i.click(function(s){s.stopPropagation();var u,t;var q=a(l).find(".fn-gantt .leftPanel");var r=a(l).find(".fn-gantt .dataPanel");switch(e.scale){case"weeks":t=f.getCellSize()*2;break;case"months":t=f.getCellSize();break;case"hours":t=f.getCellSize()*4;break;case"days":t=f.getCellSize()*3;break;default:t=f.getCellSize()*2;break}var o=c.elementFromPoint(s.pageX,r.offset().top+t);if(o.className==="fn-label"){o=a(o.parentNode)}else{o=a(o)}var n=o.attr("repdate");var v=c.elementFromPoint(q.offset().left+q.width()-10,s.pageY);if(v.className.indexOf("fn-label")===0){v=a(v.parentNode)}else{v=a(v)}var p=v.data().id;e.onAddClick(n,p)});return i},rightPanel:function(l,I){var z=null;var C=["sn","wd","wd","wd","wd","wd","sa"];var B=['<div class="row"/>'];var M=0;var A=['<div class="row"/>'];var k=0;var v=[];var n=0;var G=[];var y=[];var K=new Date();K=new Date(K.getFullYear(),K.getMonth(),K.getDate());var m=e.holidays?e.holidays.join():"";switch(e.scale){case"hours":z=f.parseTimeRange(l.dateStart,l.dateEnd,l.scaleStep);var x=z[0].getFullYear();var L=z[0].getMonth();var F=z[0];for(var E=0,H=z.length;E<H;E++){var D=z[E];var q=D.getFullYear();if(q!==x){B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");x=q;M=0}M++;var w=D.getMonth();if(w!==L){A.push('<div class="row header month" style="width: '+f.getCellSize()*k+'px"><div class="fn-label">'+e.months[L]+"</div></div>");L=w;k=0}k++;var t=D.getDay();var r=F.getDay();var s=C[t];var J=F.getTime();if(m.indexOf(new Date(D.getFullYear(),D.getMonth(),D.getDate()).getTime())>-1){s="holiday"}if(t!==r){var p=K-F===0?" today":m.indexOf(J)>-1?"holiday":C[r];v.push('<div class="row date '+p+'"  style="width: '+f.getCellSize()*n+'px;">  <div class="fn-label">'+F.getDate()+"</div></div>");G.push('<div class="row day '+p+'"  style="width: '+f.getCellSize()*n+'px;">  <div class="fn-label">'+e.dow[r]+"</div></div>");F=D;n=0}n++;y.push('<div class="row day '+s+'" id="dh-'+D.getTime()+'"  offset="'+E*f.getCellSize()+'"  repdate="'+D.getRepDate()+'"><div class="fn-label">'+D.getHours()+"</div></div>")}B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");A.push('<div class="row header month" style="width: '+f.getCellSize()*k+'px"><div class="fn-label">'+e.months[L]+"</div></div>");var s=C[F.getDay()];if(m.indexOf(new Date(F.getFullYear(),F.getMonth(),F.getDate()).getTime())>-1){s="holiday"}v.push('<div class="row date '+s+'"  style="width: '+f.getCellSize()*n+'px;">  <div class="fn-label">'+F.getDate()+"</div></div>");G.push('<div class="row day '+s+'"  style="width: '+f.getCellSize()*n+'px;">  <div class="fn-label">'+e.dow[F.getDay()]+"</div></div>");var o=c.dataPanel(l,z.length*f.getCellSize());o.append(B.join(""));o.append(A.join(""));o.append(a('<div class="row"/>').html(v.join("")));o.append(a('<div class="row"/>').html(G.join("")));o.append(a('<div class="row"/>').html(y.join("")));break;case"weeks":z=f.parseWeeksRange(l.dateStart,l.dateEnd);B=['<div class="row"/>'];A=['<div class="row"/>'];var x=z[0].getFullYear();var L=z[0].getMonth();var F=z[0];for(var E=0,H=z.length;E<H;E++){var D=z[E];if(D.getFullYear()!==x){B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");x=D.getFullYear();M=0}M++;if(D.getMonth()!==L){A.push('<div class="row header month" style="width:'+f.getCellSize()*k+'px;"><div class="fn-label">'+e.months[L]+"</div></div>");L=D.getMonth();k=0}k++;v.push('<div class="row day wd"  id="'+D.getWeekId()+'" offset="'+E*f.getCellSize()+'" repdate="'+D.getRepDate()+'">  <div class="fn-label">'+D.getWeekOfYear()+"</div></div>")}B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");A.push('<div class="row header month" style="width: '+f.getCellSize()*k+'px"><div class="fn-label">'+e.months[L]+"</div></div>");var o=c.dataPanel(l,z.length*f.getCellSize());o.append(B.join("")+A.join("")+v.join("")+G.join(""));break;case"months":z=f.parseMonthsRange(l.dateStart,l.dateEnd);var x=z[0].getFullYear();var L=z[0].getMonth();var F=z[0];for(var E=0,H=z.length;E<H;E++){var D=z[E];if(D.getFullYear()!==x){B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");x=D.getFullYear();M=0}M++;A.push('<div class="row day wd" id="dh-'+f.genId(D.getTime())+'" offset="'+E*f.getCellSize()+'" repdate="'+D.getRepDate()+'">'+(1+D.getMonth())+"</div>")}B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");A.push('<div class="row header month" style="width: '+f.getCellSize()*k+'px"><div class="fn-label">'+e.months[L]+"</div></div>");var o=c.dataPanel(l,z.length*f.getCellSize());o.append(B.join(""));o.append(A.join(""));o.append(a('<div class="row"/>').html(v.join("")));o.append(a('<div class="row"/>').html(G.join("")));break;default:z=f.parseDateRange(l.dateStart,l.dateEnd);var u=b(z[0],-1);var x=u.getFullYear();var L=u.getMonth();var F=u;for(var E=0,H=z.length;E<H;E++){var D=z[E];if(D.getFullYear()!==x){B.push('<div class="row header year" style="width:'+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");x=D.getFullYear();M=0}M++;if(D.getMonth()!==L){A.push('<div class="row header month" style="width:'+f.getCellSize()*k+'px;"><div class="fn-label">'+e.months[L]+"</div></div>");L=D.getMonth();k=0}k++;var r=D.getDay();var s=C[r];if(m.indexOf(new Date(D.getFullYear(),D.getMonth(),D.getDate()).getTime())>-1){s="holiday"}v.push('<div class="row date '+s+'"  id="dh-'+f.genId(D.getTime())+'" offset="'+E*f.getCellSize()+'" repdate="'+D.getRepDate()+'">  <div class="fn-label">'+D.getDate()+"</div></div>");G.push('<div class="row day '+s+'"  id="dw-'+f.genId(D.getTime())+'"  repdate="'+D.getRepDate()+'">  <div class="fn-label">'+e.dow[r]+"</div></div>")}B.push('<div class="row header year" style="width: '+f.getCellSize()*M+'px;"><div class="fn-label">'+x+"</div></div>");A.push('<div class="row header month" style="width: '+f.getCellSize()*k+'px"><div class="fn-label">'+e.months[L]+"</div></div>");var o=c.dataPanel(l,z.length*f.getCellSize());o.append(B.join(""));o.append(A.join(""));o.append(a('<div class="row" style="margin-left: 0;" />').html(v.join("")));o.append(a('<div class="row" style="margin-left: 0;" />').html(G.join("")));break}return a('<div class="rightPanel"></div>').append(o)},navigation:function(i){var k=null;if(e.navigate==="scroll"){k=a('<div class="navigate" />').append(a('<div class="nav-slider" />').append(a('<div class="nav-slider-left" />').append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){c.navigateTo(i,"now")})).append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){if(e.scale==="hours"){c.navigateTo(i,f.getCellSize()*8)}else{if(e.scale==="days"){c.navigateTo(i,f.getCellSize()*30)}else{if(e.scale==="weeks"){c.navigateTo(i,f.getCellSize()*12)}else{if(e.scale==="months"){c.navigateTo(i,f.getCellSize()*6)}}}}})).append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){if(e.scale==="hours"){c.navigateTo(i,f.getCellSize()*4)}else{if(e.scale==="days"){c.navigateTo(i,f.getCellSize()*7)}else{if(e.scale==="weeks"){c.navigateTo(i,f.getCellSize()*4)}else{if(e.scale==="months"){c.navigateTo(i,f.getCellSize()*3)}}}}}))).append(a('<div class="nav-slider-content" />').append(a('<div class="nav-slider-bar" />').append(a('<a class="nav-slider-button" />')).mousedown(function(l){l.preventDefault();i.scrollNavigation.scrollerMouseDown=true;c.sliderScroll(i,l)}).mousemove(function(l){if(i.scrollNavigation.scrollerMouseDown){c.sliderScroll(i,l)}}))).append(a('<div class="nav-slider-right" />').append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){if(e.scale==="hours"){c.navigateTo(i,f.getCellSize()*-4)}else{if(e.scale==="days"){c.navigateTo(i,f.getCellSize()*-7)}else{if(e.scale==="weeks"){c.navigateTo(i,f.getCellSize()*-4)}else{if(e.scale==="months"){c.navigateTo(i,f.getCellSize()*-3)}}}}})).append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){if(e.scale==="hours"){c.navigateTo(i,f.getCellSize()*-8)}else{if(e.scale==="days"){c.navigateTo(i,f.getCellSize()*-30)}else{if(e.scale==="weeks"){c.navigateTo(i,f.getCellSize()*-12)}else{if(e.scale==="months"){c.navigateTo(i,f.getCellSize()*-6)}}}}})).append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){c.zoomInOut(i,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){c.zoomInOut(i,1)}))));a(document).mouseup(function(){i.scrollNavigation.scrollerMouseDown=false})}else{k=a('<div class="navigate" />').append(a('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){c.navigateTo(i,"begin")})).append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){c.navigateTo(i,f.getCellSize()*7)})).append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){c.navigateTo(i,f.getCellSize())})).append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){c.navigateTo(i,"now")})).append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){c.navigateTo(i,f.getCellSize()*-1)})).append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){c.navigateTo(i,f.getCellSize()*-7)})).append(a('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){c.navigateTo(i,"end")})).append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){c.zoomInOut(i,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){c.zoomInOut(i,1)}))}return a('<div class="bottom"/>').append(k)},createProgressBar:function(q,m,r,l,p,i){var k=f.getCellSize();var o=f.getProgressBarMargin()||0;var n=a('<div class="bar"><div class="fn-label">'+p+"</div></div>").addClass(r).css({width:k*q-o+2}).data("dataObj",i);if(l){n.mouseover(function(s){var t=a('<div class="fn-gantt-hint" />').html(l);a("body").append(t);t.css("left",s.pageX);t.css("top",s.pageY);t.show()}).mouseout(function(){a(".fn-gantt-hint").remove()}).mousemove(function(s){a(".fn-gantt-hint").css("left",s.pageX);a(".fn-gantt-hint").css("top",s.pageY+15)})}n.click(function(s){s.stopPropagation();e.onItemClick(a(this).data("dataObj"))});return n},markNow:function(i){switch(e.scale){case"weeks":var k=Date.parse(new Date());k=Math.floor(k/36400000)*36400000;a(i).find(':findweek("'+k+'")').removeClass("wd").addClass("today");break;case"months":a(i).find(':findmonth("'+new Date().getTime()+'")').removeClass("wd").addClass("today");break;default:var k=Date.parse(new Date());k=Math.floor(k/36400000)*36400000;a(i).find(':findday("'+k+'")').removeClass("wd").addClass("today");break}},fillData:function(k,l,m){var n=function(s){try{s=s.replace("rgb(","").replace(")","");var u=s.split(",");var q=parseInt(u[0],10);var p=parseInt(u[1],10);var t=parseInt(u[2],10);var o=Math.round((255-(0.299*q+0.587*p+0.114*t))*0.9);return"rgb("+o+", "+o+", "+o+")"}catch(r){return""}};var i=function(r){try{r=r.replace("rgb(","").replace(")","");var t=r.split(",");var p=parseInt(t[0]);var o=parseInt(t[1]);var s=parseInt(t[2]);p=p-Math.round(parseInt(p)/7);o=o-Math.round(parseInt(o)/7);s=s-Math.round(parseInt(s)/7);return"rgb("+p+", "+o+", "+s+")"}catch(q){return""}};a.each(k.data,function(o,p){if(o>=k.pageNum*e.itemsPerPage&&o<k.pageNum*e.itemsPerPage+e.itemsPerPage){a.each(p.values,function(r,z){var E=null;switch(e.scale){case"hours":var t=f.genId(f.dateDeserialize(z.from).getTime(),k.scaleStep);var C=a(k).find("#dh-"+t);var x=f.genId(f.dateDeserialize(z.to).getTime(),k.scaleStep);var D=a(k).find("#dh-"+x);var v=C.attr("offset");var s=D.attr("offset");var u=Math.floor((s-v)/f.getCellSize())+1;E=c.createProgressBar(u,z.id?z.id:"",z.customClass?z.customClass:"",z.desc?z.desc:"",z.label?z.label:"",z.dataObj?z.dataObj:null);var w=a(k).find("#rowheader"+o);var y=f.getCellSize()*5+2+parseInt(w.attr("offset"),10);E.css({top:y,left:Math.floor(v)});l.append(E);break;case"weeks":var B=f.dateDeserialize(z.from);var q=f.dateDeserialize(z.to);if(B.getDate()<=3&&B.getMonth()===0){B.setDate(B.getDate()+4)}if(B.getDate()<=3&&B.getMonth()===0){B.setDate(B.getDate()+4)}if(q.getDate()<=3&&q.getMonth()===0){q.setDate(q.getDate()+4)}var C=a(k).find("#"+B.getWeekId());var v=C.attr("offset");var D=a(k).find("#"+q.getWeekId());var s=D.attr("offset");var u=Math.round((s-v)/f.getCellSize())+1;E=c.createProgressBar(u,z.id?z.id:"",z.customClass?z.customClass:"",z.desc?z.desc:"",z.label?z.label:"",z.dataObj?z.dataObj:null);var w=a(k).find("#rowheader"+o);var y=f.getCellSize()*3+2+parseInt(w.attr("offset"),10);E.css({top:y,left:Math.floor(v)});l.append(E);break;case"months":var B=f.dateDeserialize(z.from);var q=f.dateDeserialize(z.to);if(B.getDate()<=3&&B.getMonth()===0){B.setDate(B.getDate()+4)}if(B.getDate()<=3&&B.getMonth()===0){B.setDate(B.getDate()+4)}if(q.getDate()<=3&&q.getMonth()===0){q.setDate(q.getDate()+4)}var C=a(k).find("#dh-"+f.genId(B.getTime()));var v=C.attr("offset");var D=a(k).find("#dh-"+f.genId(q.getTime()));var s=D.attr("offset");var u=Math.round((s-v)/f.getCellSize())+1;E=c.createProgressBar(u,z.id?z.id:"",z.customClass?z.customClass:"",z.desc?z.desc:"",z.label?z.label:"",z.dataObj?z.dataObj:null);var w=a(k).find("#rowheader"+o);var y=f.getCellSize()*2+2+parseInt(w.attr("offset"),10);E.css({top:y,left:Math.floor(v)});l.append(E);break;default:var t=f.genId(f.dateDeserialize(z.from).getTime());var x=f.genId(f.dateDeserialize(z.to).getTime());var C=a(k).find("#dh-"+t);var v=C.attr("offset");var u=Math.floor((x/1000-t/1000)/86400)+1;E=c.createProgressBar(u,z.id?z.id:"",z.customClass?z.customClass:"",z.desc?z.desc:"",z.label?z.label:"",z.dataObj?z.dataObj:null);var w=a(k).find("#rowheader"+o);var y=f.getCellSize()*4+2+parseInt(w.attr("offset"),10);E.css({top:y,left:Math.floor(v)});l.append(E);break}var A=E.find(".fn-label");if(A&&E.length){var F=n(E[0].style.backgroundColor);A.css("color",F)}else{if(A){A.css("color","")}}})}})},navigateTo:function(o,l){var m=a(o).find(".fn-gantt .rightPanel");var i=m.find(".dataPanel");i.click=function(){alert(arguments.join(""))};var p=m.width();var n=i.width();switch(l){case"begin":i.animate({"margin-left":"0px"},"fast",function(){c.repositionLabel(o)});o.scrollNavigation.panelMargin=0;break;case"end":var k=n-p;o.scrollNavigation.panelMargin=k*-1;i.animate({"margin-left":"-"+k+"px"},"fast",function(){c.repositionLabel(o)});break;case"now":if(!o.scrollNavigation.canScroll||!i.find(".today").length){return false}var q=(n-p)*-1;var r=i.css("margin-left").replace("px","");var l=i.find(".today").offset().left-i.offset().left;l*=-1;if(l>0){l=0}else{if(l<q){l=q}}i.animate({"margin-left":l+"px"},"fast",c.repositionLabel(o));o.scrollNavigation.panelMargin=l;break;default:var q=(n-p)*-1;var r=i.css("margin-left").replace("px","");var l=parseInt(r,10)+l;if(l<=0&&l>=q){i.animate({"margin-left":l+"px"},"fast",c.repositionLabel(o))}o.scrollNavigation.panelMargin=l;break}c.synchronizeScroller(o)},navigatePage:function(i,k){if(i.pageNum+k>=0&&i.pageNum+k<Math.ceil(i.rowsNum/e.itemsPerPage)){c.waitToggle(i,true,function(){i.pageNum+=k;i.hPosition=a(".fn-gantt .dataPanel").css("margin-left").replace("px","");i.scaleOldWidth=false;c.init(i)})}},zoomInOut:function(i,k){c.waitToggle(i,true,function(){var q=k<0;var o=i.scaleStep+k*3;o=o<=1?1:o===4?3:o;var n=e.scale;var l=i.headerRows;if(e.scale==="hours"&&o>=13){n="days";l=4;o=13}else{if(e.scale==="days"&&q){n="hours";l=5;o=12}else{if(e.scale==="days"&&!q){n="weeks";l=3;o=13}else{if(e.scale==="weeks"&&!q){n="months";l=2;o=14}else{if(e.scale==="weeks"&&q){n="days";l=4;o=13}else{if(e.scale==="months"&&q){n="weeks";l=3;o=13}}}}}}if((q&&a.inArray(n,g)<a.inArray(e.minScale,g))||(!q&&a.inArray(n,g)>a.inArray(e.maxScale,g))){c.init(i);return}i.scaleStep=o;e.scale=n;i.headerRows=l;var m=a(i).find(".fn-gantt .rightPanel");var p=m.find(".dataPanel");i.hPosition=p.css("margin-left").replace("px","");i.scaleOldWidth=p.width()-m.width();if(e.useCookie){a.cookie(this.cookieKey+"CurrentScale",e.scale);a.cookie(this.cookieKey+"ScrollPos",null)}c.init(i)})},mouseScroll:function(i,k){var o=a(i).find(".fn-gantt .dataPanel");o.css("cursor","move");var m=o.offset();var l=i.scrollNavigation.mouseX===null?k.pageX:i.scrollNavigation.mouseX;var n=k.pageX-l;i.scrollNavigation.mouseX=k.pageX;c.scrollPanel(i,n);clearTimeout(i.scrollNavigation.repositionDelay);i.scrollNavigation.repositionDelay=setTimeout(c.repositionLabel,50,i)},wheelScroll:function(i,k){k.preventDefault();var l=k.detail?k.detail*-50:(k.wheelDelta/120)*50;c.scrollPanel(i,l);clearTimeout(i.scrollNavigation.repositionDelay);i.scrollNavigation.repositionDelay=setTimeout(c.repositionLabel,50,i)},sliderScroll:function(o,q){var t=a(o).find(".nav-slider-bar");var s=t.find(".nav-slider-button");var n=a(o).find(".fn-gantt .rightPanel");var k=n.find(".dataPanel");var l=t.offset();var u=t.width();var m=s.width();var r,i;if(q.pageX>=l.left&&q.pageX<=l.left+u){r=q.pageX-l.left;r=r-m/2;s.css("left",r);i=k.width()-n.width();var p=((r*i)/u)*-1;if(p>=0){k.css("margin-left","0px");o.scrollNavigation.panelMargin=0}else{if(r>=u-m*1){k.css("margin-left",i*-1+"px");o.scrollNavigation.panelMargin=i*-1}else{k.css("margin-left",p+"px");o.scrollNavigation.panelMargin=p}}clearTimeout(o.scrollNavigation.repositionDelay);o.scrollNavigation.repositionDelay=setTimeout(c.repositionLabel,5,o)}},scrollPanel:function(i,l){if(!i.scrollNavigation.canScroll){return false}var k=parseInt(i.scrollNavigation.panelMargin,10)+l;if(k>0){i.scrollNavigation.panelMargin=0;a(i).find(".fn-gantt .dataPanel").css("margin-left",i.scrollNavigation.panelMargin+"px")}else{if(k<i.scrollNavigation.panelMaxPos*-1){i.scrollNavigation.panelMargin=i.scrollNavigation.panelMaxPos*-1;a(i).find(".fn-gantt .dataPanel").css("margin-left",i.scrollNavigation.panelMargin+"px")}else{i.scrollNavigation.panelMargin=k;a(i).find(".fn-gantt .dataPanel").css("margin-left",i.scrollNavigation.panelMargin+"px")}}c.synchronizeScroller(i)},synchronizeScroller:function(n){if(e.navigate==="scroll"){var m=a(n).find(".fn-gantt .rightPanel");var i=m.find(".dataPanel");var r=a(n).find(".nav-slider-bar");var o=r.find(".nav-slider-button");var s=r.width();var l=o.width();var k=i.width()-m.width();var p=0;if(i.css("margin-left")){p=i.css("margin-left").replace("px","")}var q=(p*s)/k-o.width()*0.25;q=q>0?0:q*-1>=s-l*0.75?(s-l*1.25)*-1:q;o.css("left",q*-1)}},repositionLabel:function(i){setTimeout(function(){var l;if(!i){l=a(".fn-gantt .rightPanel .dataPanel")}else{var k=a(i).find(".fn-gantt .rightPanel");l=k.find(".dataPanel")}if(e.useCookie){a.cookie(this.cookieKey+"ScrollPos",l.css("margin-left").replace("px",""))}},500)},waitToggle:function(l,i,n){if(i){var k=a(l).offset();var m=a(l).outerWidth();var o=a(l).outerHeight();if(!l.loader){l.loader=a('<div class="fn-gantt-loader"><div class="fn-gantt-loader-spinner"><span>'+e.waitText+"</span></div></div>")}a(l).append(l.loader);setTimeout(n,500)}else{if(l.loader){l.loader.detach()}}},};var f={getMaxDate:function(i){var m=null;a.each(i.data,function(n,o){a.each(o.values,function(q,p){m=m<f.dateDeserialize(p.to)?f.dateDeserialize(p.to):m})});m=m||new Date();switch(e.scale){case"hours":m.setHours(Math.ceil(m.getHours()/i.scaleStep)*i.scaleStep);m.setHours(m.getHours()+i.scaleStep*3);break;case"weeks":var l=new Date(m.getTime());var l=new Date(l.setDate(l.getDate()+3*7));var k=Math.floor(l.getDate()/7)*7;m=new Date(l.getFullYear(),l.getMonth(),k===0?4:k-3);break;case"months":var l=new Date(m.getFullYear(),m.getMonth(),1);l.setMonth(l.getMonth()+2);m=new Date(l.getFullYear(),l.getMonth(),1);break;default:m.setHours(0);m.setDate(m.getDate()+3);break}return m},getMinDate:function(i){var m=null;a.each(i.data,function(n,o){a.each(o.values,function(q,p){m=m>f.dateDeserialize(p.from)||m===null?f.dateDeserialize(p.from):m})});m=m||new Date();switch(e.scale){case"hours":m.setHours(Math.floor(m.getHours()/i.scaleStep)*i.scaleStep);m.setHours(m.getHours()-i.scaleStep*3);break;case"weeks":var l=new Date(m.getTime());var l=new Date(l.setDate(l.getDate()-3*7));var k=Math.floor(l.getDate()/7)*7;m=new Date(l.getFullYear(),l.getMonth(),k===0?4:k-3);break;case"months":var l=new Date(m.getFullYear(),m.getMonth(),1);l.setMonth(l.getMonth()-3);m=new Date(l.getFullYear(),l.getMonth(),1);break;default:m.setHours(0);m.setDate(m.getDate()-3);break}return m},parseDateRange:function(p,o){var n=new Date(p.getTime());var k=new Date(o.getTime());var l=[];var m=0;do{l[m++]=new Date(n.getTime());n.setDate(n.getDate()+1)}while(n.getTime()<=o.getTime());return l},parseTimeRange:function(r,q,m){var p=new Date(r);var l=new Date(q);p.setMilliseconds(0);p.setSeconds(0);p.setMinutes(0);p.setHours(0);l.setMilliseconds(0);l.setSeconds(0);if(l.getMinutes()>0||l.getHours()>0){l.setMinutes(0);l.setHours(0);l.setTime(l.getTime()+86400000)}var n=[];var o=0;for(;;){var k=new Date(p);k.setHours(Math.floor(p.getHours()/m)*m);if(n[o]&&k.getDay()!==n[o].getDay()){k.setHours(0)}n[o]=k;if(p.getTime()>q.getTime()){break}p=b(k,m);o++}return n},parseWeeksRange:function(p,o){var n=new Date(p);var k=new Date(o);var l=[];var m=0;do{if(n.getDay()===0){l[m++]=n.getDayForWeek()}n.setDate(n.getDate()+1)}while(n.getTime()<=o.getTime());return l},parseMonthsRange:function(p,o){var n=new Date(p);var k=new Date(o);var l=[];var m=0;do{l[m++]=new Date(n.getFullYear(),n.getMonth(),1);n.setMonth(n.getMonth()+1)}while(n.getTime()<=o.getTime());return l},dateDeserialize:function(i){if(typeof i==="string"){i=i.replace(/\/Date\((.*)\)\//,"$1");i=a.isNumeric(i)?parseInt(i,10):a.trim(i)}return new Date(i)},genId:function(o){var n=new Date(o);switch(e.scale){case"hours":var l=n.getHours();if(arguments.length>=2){l=Math.floor(n.getHours()/arguments[1])*arguments[1]}return new Date(n.getFullYear(),n.getMonth(),n.getDate(),l).getTime();case"weeks":var p=n.getFullYear();var k=n.getDayForWeek().getWeekOfYear();var i=n.getMonth();if(i===11&&k===1){p++}return p+"-"+k;case"months":return n.getFullYear()+"-"+n.getMonth();default:return new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()}},_datesToDays:function(o){var n={};for(var m=0,k=o.length,l;m<k;m++){l=f.dateDeserialize(o[m]);n[l.setHours(0,0,0,0)]=true}return n},isHoliday:(function(){if(!e.holidays){return function(){return false}}var i=false;return function(k){if(!i){i=f._datesToDays(e.holidays)}return !!i[a.isNumeric(k)?k:new Date(k.getFullYear(),k.getMonth(),k.getDate()).getTime()]}})(),_getCellSize:null,getCellSize:function(){if(!f._getCellSize){a("body").append(a('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="row"></div></div>'));f._getCellSize=a("#measureCellWidth .row").height();a("#measureCellWidth").empty().remove()}return f._getCellSize},getRightPanelSize:function(){a("body").append(a('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="rightPanel"></div></div>'));var i=a("#measureCellWidth .rightPanel").height();a("#measureCellWidth").empty().remove();return i},getPageHeight:function(i){return i.pageNum+1===i.pageCount?i.rowsOnLastPage*f.getCellSize():e.itemsPerPage*f.getCellSize()},_getProgressBarMargin:null,getProgressBarMargin:function(){if(!f._getProgressBarMargin&&f._getProgressBarMargin!==0){a("body").append(a('<div style="display: none; position: absolute;" id="measureBarWidth" ><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar" /></div></div></div></div></div>'));f._getProgressBarMargin=parseInt(a("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-left").replace("px",""),10);f._getProgressBarMargin+=parseInt(a("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-right").replace("px",""),10);a("#measureBarWidth").empty().remove()}return f._getProgressBarMargin},};this.each(function(){this.data=null;this.pageNum=0;this.pageCount=0;this.rowsOnLastPage=0;this.rowsNum=0;this.hPosition=0;this.dateStart=null;this.dateEnd=null;this.scrollClicked=false;this.scaleOldWidth=null;this.headerRows=null;if(e.useCookie){var i=a.cookie(this.cookieKey+"CurrentScale");if(i){e.scale=a.cookie(this.cookieKey+"CurrentScale")}else{a.cookie(this.cookieKey+"CurrentScale",e.scale)}}switch(e.scale){case"hours":this.headerRows=5;this.scaleStep=1;break;case"weeks":this.headerRows=3;this.scaleStep=13;break;case"months":this.headerRows=2;this.scaleStep=14;break;default:this.headerRows=4;this.scaleStep=13;break}this.scrollNavigation={panelMouseDown:false,scrollerMouseDown:false,mouseX:null,panelMargin:0,repositionDelay:0,panelMaxPos:0,canScroll:true};this.gantt=null;this.loader=null;c.create(this)})}})(jQuery);